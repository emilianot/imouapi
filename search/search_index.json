{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"imouapi \u00b6 This python library helps in interacting with Imou Life Open API for remote controlling programmatically your Imou devices , especially those settings such as motion detection, human detection, privacy, etc that can be changed by the Imou Life App only. Features \u00b6 Provide classes for both low level API interaction as well as device and sensors abastractions Exceptions and error handling Based on asyncio module Quickstart \u00b6 Install the library with pip install imouapi Register a developer account on Imou Life Open API and get your appId and appSecret Instantiate the Imou API client ( from imouapi.api import ImouAPIClient ) and initialize it (e.g. api_client = ImouAPIClient(app_id, app_secret, session) ) Discover registered devices by importing the Discover service ( from imouapi.device import ImouDiscoverService ), inializing it (e.g. discover_service = ImouDiscoverService(api_client) ) and running a discovery (e.g. discovered_devices = await discover_service.async_discover_devices() ) Either use the high level API by importing the Imou Device class ( from imouapi.device import ImouDevice ) and initializing it (e.g. device = ImouDevice(api_client, device_id) ) or using directly the low level API provided by ImouAPIClient to interact with the device Full details on the installation process, requirements, usage and classes and methods made available by the library are available at https://user2684.github.io/imouapi","title":"Home"},{"location":"#imouapi","text":"This python library helps in interacting with Imou Life Open API for remote controlling programmatically your Imou devices , especially those settings such as motion detection, human detection, privacy, etc that can be changed by the Imou Life App only.","title":"imouapi"},{"location":"#features","text":"Provide classes for both low level API interaction as well as device and sensors abastractions Exceptions and error handling Based on asyncio module","title":"Features"},{"location":"#quickstart","text":"Install the library with pip install imouapi Register a developer account on Imou Life Open API and get your appId and appSecret Instantiate the Imou API client ( from imouapi.api import ImouAPIClient ) and initialize it (e.g. api_client = ImouAPIClient(app_id, app_secret, session) ) Discover registered devices by importing the Discover service ( from imouapi.device import ImouDiscoverService ), inializing it (e.g. discover_service = ImouDiscoverService(api_client) ) and running a discovery (e.g. discovered_devices = await discover_service.async_discover_devices() ) Either use the high level API by importing the Imou Device class ( from imouapi.device import ImouDevice ) and initializing it (e.g. device = ImouDevice(api_client, device_id) ) or using directly the low level API provided by ImouAPIClient to interact with the device Full details on the installation process, requirements, usage and classes and methods made available by the library are available at https://user2684.github.io/imouapi","title":"Quickstart"},{"location":"changelog/","text":"Changelog \u00b6 [1.0.5] (2022-11-13) \u00b6 Added \u00b6 Support for restartDevice , deviceSdcardStatus Imou APIs through async_api_restartDevice() , async_api_deviceSdcardStatus() and CLI commands Support for \"Activate Siren\" switch ImouButton class and restartDevice , refreshData buttons Support for press_button to CLI Support for callbackUrl sensor set_device() function to ImouEntity Changed \u00b6 Reviewed switches' labels Fixed \u00b6 Storage used sensor now reporting None when SD card is not present [1.0.4] (2022-10-22) \u00b6 Added \u00b6 ImouSelect class and support for nightVisionMode select get_select and set_select commands to CLI pushNotifications switch Changed \u00b6 Sensors (not only switches) are now added based on the available capabilities [1.0.3] (2022-10-22) \u00b6 Added \u00b6 Support for not documented WLM capability Support for undocumented capabilities or capabilities inherited from other capabilities Support for deviceOpenList , deviceOpenBaseDetailList , listDeviceAbility , deviceStorage , getNightVisionMode , setNightVisionMode , getMessageCallback , setMessageCallback APIs through async_api_deviceOpenList() , async_api_deviceOpenBaseDetailList() , async_api_listDeviceAbility() , async_api_deviceStorage() , async_api_getNightVisionMode() , async_api_setNightVisionMode() , async_api_getMessageCallback() , async_api_getMessageCallbackOn() , async_api_setMessageCallbackOff() api_deviceBaseList , api_deviceOpenList , api_deviceBaseDetailList , api_deviceOpenDetailList , api_getDeviceCameraStatus , api_setDeviceCameraStatus , api_listDeviceAbility , api_getAlarmMessage , api_deviceStorage , api_getNightVisionMode , api_setNightVisionMode , api_getMessageCallback , api_getMessageCallbackOn , api_getMessageCallbackOff commands to CLI Changed \u00b6 async_api_getAlarmMessage() now returning the last 10 alarms of the month, not just the last one Removed \u00b6 get_device_class() from ImouSensor [1.0.2] (2022-10-19) \u00b6 Fixed \u00b6 Switches mapping to versioned capabilities are now created (e.g. audioEncodeControl for capability AudioEncodeControlV2) [1.0.1] (2022-10-16) \u00b6 Added \u00b6 get_diagnostics() method to ImouDevice class get_diagnostics command to CLI [1.0.0] (2022-10-15) \u00b6 Added \u00b6 --log-http-requests option to CLI Fixed \u00b6 Last Alarm sensor unable to retrieve most recent alarms Last Alarm sensor shifted ahead by the local timezone [0.2.2] (2022-10-07) \u00b6 Added \u00b6 Test cases for most of the classes [0.2.1] (2022-10-04) \u00b6 Added \u00b6 Test cases for ImouAPIClient Access Token expiration handling [0.2.0] (2022-10-03) \u00b6 Added \u00b6 get_sensor_by_name() and get_all_sensors() added to ImouDevice class Changed \u00b6 ImouDiscoverService and ImouDevice now take an instance of ImouAPIClient to initialize In ImouDiscoverService and ImouDevice , moved base_url and timeout from constructor to function set_base_url() and set_timeout() There is no more concept of supported switches, all of those discovered, are made available and can be controlled Sensors' icons moved out of the this library since not applicable in this context ImouDevice get_sensors() renamed in get_sensors_by_platform() If connection failes, multiple retries are done Partial refactoring of the code Removed \u00b6 async_connect() from both ImouDevice and ImouDiscoverService . Connection takes place at the first API call [0.1.5] (2022-09-28) \u00b6 Added \u00b6 ImouAPIClient.log_http_requests() for enabling http request/response logging (off by default) If http logging is enabled, log messages are redacted from sensitive information ImouAPIClient.redact_log_message() for enabling log redaction (on by default) Changed \u00b6 Moved info logs into debug level By default, with debug level, no more logging HTTP requests and responses [0.1.4] (2022-09-28) \u00b6 Added \u00b6 Github workflow to publish on PyPI Changed \u00b6 Updated documentation [0.1.3] (2022-09-27) \u00b6 Changed \u00b6 API base URL and API timeout are not optional parameters and can be provided by the user Updated CLI, added logging level Updated documentation [0.1.2] (2022-09-27) \u00b6 Changed \u00b6 Re-organized the file structure Updated documentation [0.1.1] (2022-09-27) \u00b6 Added \u00b6 First development release [0.1.0] (2022-09-26) \u00b6 Added \u00b6 First commit","title":"Changelog"},{"location":"changelog/#changelog","text":"","title":"Changelog"},{"location":"changelog/#105-2022-11-13","text":"","title":"[1.0.5] (2022-11-13)"},{"location":"changelog/#added","text":"Support for restartDevice , deviceSdcardStatus Imou APIs through async_api_restartDevice() , async_api_deviceSdcardStatus() and CLI commands Support for \"Activate Siren\" switch ImouButton class and restartDevice , refreshData buttons Support for press_button to CLI Support for callbackUrl sensor set_device() function to ImouEntity","title":"Added"},{"location":"changelog/#changed","text":"Reviewed switches' labels","title":"Changed"},{"location":"changelog/#fixed","text":"Storage used sensor now reporting None when SD card is not present","title":"Fixed"},{"location":"changelog/#104-2022-10-22","text":"","title":"[1.0.4] (2022-10-22)"},{"location":"changelog/#added_1","text":"ImouSelect class and support for nightVisionMode select get_select and set_select commands to CLI pushNotifications switch","title":"Added"},{"location":"changelog/#changed_1","text":"Sensors (not only switches) are now added based on the available capabilities","title":"Changed"},{"location":"changelog/#103-2022-10-22","text":"","title":"[1.0.3] (2022-10-22)"},{"location":"changelog/#added_2","text":"Support for not documented WLM capability Support for undocumented capabilities or capabilities inherited from other capabilities Support for deviceOpenList , deviceOpenBaseDetailList , listDeviceAbility , deviceStorage , getNightVisionMode , setNightVisionMode , getMessageCallback , setMessageCallback APIs through async_api_deviceOpenList() , async_api_deviceOpenBaseDetailList() , async_api_listDeviceAbility() , async_api_deviceStorage() , async_api_getNightVisionMode() , async_api_setNightVisionMode() , async_api_getMessageCallback() , async_api_getMessageCallbackOn() , async_api_setMessageCallbackOff() api_deviceBaseList , api_deviceOpenList , api_deviceBaseDetailList , api_deviceOpenDetailList , api_getDeviceCameraStatus , api_setDeviceCameraStatus , api_listDeviceAbility , api_getAlarmMessage , api_deviceStorage , api_getNightVisionMode , api_setNightVisionMode , api_getMessageCallback , api_getMessageCallbackOn , api_getMessageCallbackOff commands to CLI","title":"Added"},{"location":"changelog/#changed_2","text":"async_api_getAlarmMessage() now returning the last 10 alarms of the month, not just the last one","title":"Changed"},{"location":"changelog/#removed","text":"get_device_class() from ImouSensor","title":"Removed"},{"location":"changelog/#102-2022-10-19","text":"","title":"[1.0.2] (2022-10-19)"},{"location":"changelog/#fixed_1","text":"Switches mapping to versioned capabilities are now created (e.g. audioEncodeControl for capability AudioEncodeControlV2)","title":"Fixed"},{"location":"changelog/#101-2022-10-16","text":"","title":"[1.0.1] (2022-10-16)"},{"location":"changelog/#added_3","text":"get_diagnostics() method to ImouDevice class get_diagnostics command to CLI","title":"Added"},{"location":"changelog/#100-2022-10-15","text":"","title":"[1.0.0] (2022-10-15)"},{"location":"changelog/#added_4","text":"--log-http-requests option to CLI","title":"Added"},{"location":"changelog/#fixed_2","text":"Last Alarm sensor unable to retrieve most recent alarms Last Alarm sensor shifted ahead by the local timezone","title":"Fixed"},{"location":"changelog/#022-2022-10-07","text":"","title":"[0.2.2] (2022-10-07)"},{"location":"changelog/#added_5","text":"Test cases for most of the classes","title":"Added"},{"location":"changelog/#021-2022-10-04","text":"","title":"[0.2.1] (2022-10-04)"},{"location":"changelog/#added_6","text":"Test cases for ImouAPIClient Access Token expiration handling","title":"Added"},{"location":"changelog/#020-2022-10-03","text":"","title":"[0.2.0] (2022-10-03)"},{"location":"changelog/#added_7","text":"get_sensor_by_name() and get_all_sensors() added to ImouDevice class","title":"Added"},{"location":"changelog/#changed_3","text":"ImouDiscoverService and ImouDevice now take an instance of ImouAPIClient to initialize In ImouDiscoverService and ImouDevice , moved base_url and timeout from constructor to function set_base_url() and set_timeout() There is no more concept of supported switches, all of those discovered, are made available and can be controlled Sensors' icons moved out of the this library since not applicable in this context ImouDevice get_sensors() renamed in get_sensors_by_platform() If connection failes, multiple retries are done Partial refactoring of the code","title":"Changed"},{"location":"changelog/#removed_1","text":"async_connect() from both ImouDevice and ImouDiscoverService . Connection takes place at the first API call","title":"Removed"},{"location":"changelog/#015-2022-09-28","text":"","title":"[0.1.5] (2022-09-28)"},{"location":"changelog/#added_8","text":"ImouAPIClient.log_http_requests() for enabling http request/response logging (off by default) If http logging is enabled, log messages are redacted from sensitive information ImouAPIClient.redact_log_message() for enabling log redaction (on by default)","title":"Added"},{"location":"changelog/#changed_4","text":"Moved info logs into debug level By default, with debug level, no more logging HTTP requests and responses","title":"Changed"},{"location":"changelog/#014-2022-09-28","text":"","title":"[0.1.4] (2022-09-28)"},{"location":"changelog/#added_9","text":"Github workflow to publish on PyPI","title":"Added"},{"location":"changelog/#changed_5","text":"Updated documentation","title":"Changed"},{"location":"changelog/#013-2022-09-27","text":"","title":"[0.1.3] (2022-09-27)"},{"location":"changelog/#changed_6","text":"API base URL and API timeout are not optional parameters and can be provided by the user Updated CLI, added logging level Updated documentation","title":"Changed"},{"location":"changelog/#012-2022-09-27","text":"","title":"[0.1.2] (2022-09-27)"},{"location":"changelog/#changed_7","text":"Re-organized the file structure Updated documentation","title":"Changed"},{"location":"changelog/#011-2022-09-27","text":"","title":"[0.1.1] (2022-09-27)"},{"location":"changelog/#added_10","text":"First development release","title":"Added"},{"location":"changelog/#010-2022-09-26","text":"","title":"[0.1.0] (2022-09-26)"},{"location":"changelog/#added_11","text":"First commit","title":"Added"},{"location":"contributing/","text":"Contributing \u00b6 Contributions are welcome, and they are greatly appreciated! Every little bit helps, and credit will always be given. You can contribute in many ways: Types of Contributions \u00b6 Report Bugs \u00b6 Report bugs at https://github.com/user2684/imouapi/issues. If you are reporting a bug, please include: Your operating system name and version. Any details about your local setup that might be helpful in troubleshooting. Detailed steps to reproduce the bug. Fix Bugs \u00b6 Look through the GitHub issues for bugs. Anything tagged with \"bug\" and \"help wanted\" is open to whoever wants to implement it. Implement Features \u00b6 Look through the GitHub issues for features. Anything tagged with \"enhancement\" and \"help wanted\" is open to whoever wants to implement it. Write Documentation \u00b6 imouapi could always use more documentation, whether as part of the official imouapi docs, in docstrings, or even on the web in blog posts, articles, and such. Submit Feedback \u00b6 The best way to send feedback is to file an issue at https://github.com/user2684/imouapi/issues. If you are proposing a feature: Explain in detail how it would work. Keep the scope as narrow as possible, to make it easier to implement. Remember that this is a volunteer-driven project, and that contributions are welcome :) Get Started! \u00b6 Ready to contribute? Here's how to set up imouapi for local development. Fork the imouapi repo on GitHub. Clone your fork locally $ git clone git@github.com:your_name_here/imouapi.git Ensure poetry is installed. Install dependencies and start your virtualenv: $ poetry install -E test -E doc -E dev Create a branch for local development: $ git checkout -b name-of-your-bugfix-or-feature Now you can make your changes locally. When you're done making changes, check that your changes pass the tests, including testing other Python versions, with tox: $ poetry run tox Commit your changes and push your branch to GitHub: $ git add . $ git commit -m \"Your detailed description of your changes.\" $ git push origin name-of-your-bugfix-or-feature Submit a pull request through the GitHub website. Pull Request Guidelines \u00b6 Before you submit a pull request, check that it meets these guidelines: The pull request should include tests. If the pull request adds functionality, the docs should be updated. Put your new functionality into a function with a docstring, and add the feature to the list in README.md. The pull request should work for Python 3.6, 3.7, 3.8 and 3.9. Check https://github.com/user2684/imouapi/actions and make sure that the tests pass for all supported Python versions. Tips \u00b6 $ poetry run pytest tests/test_imouapi.py To run a subset of tests. Deploying \u00b6 A reminder for the maintainers on how to deploy. Make sure all your changes are committed (including an entry in CHANGELOG.md). Then run: $ poetry run bump2version patch # possible: major / minor / patch $ git push $ git push --tags GitHub Actions will then deploy to PyPI if tests pass.","title":"Contributing"},{"location":"contributing/#contributing","text":"Contributions are welcome, and they are greatly appreciated! Every little bit helps, and credit will always be given. You can contribute in many ways:","title":"Contributing"},{"location":"contributing/#types-of-contributions","text":"","title":"Types of Contributions"},{"location":"contributing/#report-bugs","text":"Report bugs at https://github.com/user2684/imouapi/issues. If you are reporting a bug, please include: Your operating system name and version. Any details about your local setup that might be helpful in troubleshooting. Detailed steps to reproduce the bug.","title":"Report Bugs"},{"location":"contributing/#fix-bugs","text":"Look through the GitHub issues for bugs. Anything tagged with \"bug\" and \"help wanted\" is open to whoever wants to implement it.","title":"Fix Bugs"},{"location":"contributing/#implement-features","text":"Look through the GitHub issues for features. Anything tagged with \"enhancement\" and \"help wanted\" is open to whoever wants to implement it.","title":"Implement Features"},{"location":"contributing/#write-documentation","text":"imouapi could always use more documentation, whether as part of the official imouapi docs, in docstrings, or even on the web in blog posts, articles, and such.","title":"Write Documentation"},{"location":"contributing/#submit-feedback","text":"The best way to send feedback is to file an issue at https://github.com/user2684/imouapi/issues. If you are proposing a feature: Explain in detail how it would work. Keep the scope as narrow as possible, to make it easier to implement. Remember that this is a volunteer-driven project, and that contributions are welcome :)","title":"Submit Feedback"},{"location":"contributing/#get-started","text":"Ready to contribute? Here's how to set up imouapi for local development. Fork the imouapi repo on GitHub. Clone your fork locally $ git clone git@github.com:your_name_here/imouapi.git Ensure poetry is installed. Install dependencies and start your virtualenv: $ poetry install -E test -E doc -E dev Create a branch for local development: $ git checkout -b name-of-your-bugfix-or-feature Now you can make your changes locally. When you're done making changes, check that your changes pass the tests, including testing other Python versions, with tox: $ poetry run tox Commit your changes and push your branch to GitHub: $ git add . $ git commit -m \"Your detailed description of your changes.\" $ git push origin name-of-your-bugfix-or-feature Submit a pull request through the GitHub website.","title":"Get Started!"},{"location":"contributing/#pull-request-guidelines","text":"Before you submit a pull request, check that it meets these guidelines: The pull request should include tests. If the pull request adds functionality, the docs should be updated. Put your new functionality into a function with a docstring, and add the feature to the list in README.md. The pull request should work for Python 3.6, 3.7, 3.8 and 3.9. Check https://github.com/user2684/imouapi/actions and make sure that the tests pass for all supported Python versions.","title":"Pull Request Guidelines"},{"location":"contributing/#tips","text":"$ poetry run pytest tests/test_imouapi.py To run a subset of tests.","title":"Tips"},{"location":"contributing/#deploying","text":"A reminder for the maintainers on how to deploy. Make sure all your changes are committed (including an entry in CHANGELOG.md). Then run: $ poetry run bump2version patch # possible: major / minor / patch $ git push $ git push --tags GitHub Actions will then deploy to PyPI if tests pass.","title":"Deploying"},{"location":"installation/","text":"Stable release \u00b6 To install imouapi, run this command in your terminal: $ pip install imouapi This is the preferred method to install imouapi, as it will always install the most recent stable release. If you don't have pip installed, this Python installation guide can guide you through the process. From source \u00b6 The source for imouapi can be downloaded from the Github repo . You can either clone the public repository: $ git clone git://github.com/user2684/imouapi Or download the tarball : $ curl -OJL https://github.com/user2684/imouapi/tarball/master Once you have a copy of the source, you can install it with: $ pip install .","title":"Installation"},{"location":"installation/#stable-release","text":"To install imouapi, run this command in your terminal: $ pip install imouapi This is the preferred method to install imouapi, as it will always install the most recent stable release. If you don't have pip installed, this Python installation guide can guide you through the process.","title":"Stable release"},{"location":"installation/#from-source","text":"The source for imouapi can be downloaded from the Github repo . You can either clone the public repository: $ git clone git://github.com/user2684/imouapi Or download the tarball : $ curl -OJL https://github.com/user2684/imouapi/tarball/master Once you have a copy of the source, you can install it with: $ pip install .","title":"From source"},{"location":"requirements/","text":"A valid Imou Open API App Id and App Secret are required to use the library. In order to get them: Register an account on Imou Life if not done already Register a developer account on https://open.imoulife.com Open the Imou Console at https://open.imoulife.com/consoleNew/myApp/appInfo Go to \"My App\", \"App Information\" and click on Edit Fill in the required information and copy your AppId and AppSecret","title":"Requirements"},{"location":"usage/","text":"You can use the library in three different ways: Option 1: high-level API (Recommended) \u00b6 An abstraction over the API has been built to provide representations of devices and sensors: imouapi.device provides ImouDevice to represent an Imou devices and all its sensors and ImouDiscoverService which can be used to discover devices registered with the account imouapi.device_entity provides ImouSensor , ImouBinarySensor and ImouSwitch , representing the sensors attached to the device. Upon loading, the library is capable of enumerating available capabilities of the device and instantiate only the switches that the device suports. The API of course allows to eventually control those switches. Supported switches: all the switches supported by the remote device Supported sensor: \"lastAlarm\" Supported binary_sensor: \"online\" Examples on how to interact with ImouDevice and ImouDiscoverService are provided in the CLI implementation. Option 2: low-level API \u00b6 With from imouapi.api import ImouAPIClient and calling the provided methods for connecting and calling API endpoints. The following Imou API are supported: deviceBaseList deviceBaseDetailList deviceOnline getDeviceCameraStatus setDeviceCameraStatus getAlarmMessage Examples on how to interact with ImouAPIClient is provided in the high-level API implementation. Option 3: CLI \u00b6 A command line interface is provided for testing and troubleshooting purposes. Usage: python -m imouapi.cli [OPTIONS] COMMAND <ARGUMENTS> Options: --app-id <app_id> Imou Cloud App ID (mandatory) --app-secret <app_secret> Imou Cloud App Secret (mandatory) --logging <info|debug> The logging level --base-url <base_url> Set a custom base url for the API --timeout <timeout> Set a custom timeout for API calls Commmands: discover Discover registered devices get_device <device_id> Get the details of the device id provided get_sensor <device_id> <sensor_name> Get the state of a sensor get_binary_sensor <device_id> <sensor_name> Get the state of a binary sensor get_switch <device_id> <sensor_name> Get the state of a switch set_switch <device_id> <sensor_name> [on|off|toggle] Set the state of a switch Exception Handling \u00b6 The library provides a simplified way for handling exceptions: from imouapi.exceptions import ImouException try: await device.async_initialize() except ImouException as exception: _LOGGER.error(exception.to_string()) raise ImouException() from exception The ImouException class provides a to_string() method which returns the name of the exception which was raised and the full stacktrace.","title":"Usage"},{"location":"usage/#option-1-high-level-api-recommended","text":"An abstraction over the API has been built to provide representations of devices and sensors: imouapi.device provides ImouDevice to represent an Imou devices and all its sensors and ImouDiscoverService which can be used to discover devices registered with the account imouapi.device_entity provides ImouSensor , ImouBinarySensor and ImouSwitch , representing the sensors attached to the device. Upon loading, the library is capable of enumerating available capabilities of the device and instantiate only the switches that the device suports. The API of course allows to eventually control those switches. Supported switches: all the switches supported by the remote device Supported sensor: \"lastAlarm\" Supported binary_sensor: \"online\" Examples on how to interact with ImouDevice and ImouDiscoverService are provided in the CLI implementation.","title":"Option 1: high-level API (Recommended)"},{"location":"usage/#option-2-low-level-api","text":"With from imouapi.api import ImouAPIClient and calling the provided methods for connecting and calling API endpoints. The following Imou API are supported: deviceBaseList deviceBaseDetailList deviceOnline getDeviceCameraStatus setDeviceCameraStatus getAlarmMessage Examples on how to interact with ImouAPIClient is provided in the high-level API implementation.","title":"Option 2: low-level API"},{"location":"usage/#option-3-cli","text":"A command line interface is provided for testing and troubleshooting purposes. Usage: python -m imouapi.cli [OPTIONS] COMMAND <ARGUMENTS> Options: --app-id <app_id> Imou Cloud App ID (mandatory) --app-secret <app_secret> Imou Cloud App Secret (mandatory) --logging <info|debug> The logging level --base-url <base_url> Set a custom base url for the API --timeout <timeout> Set a custom timeout for API calls Commmands: discover Discover registered devices get_device <device_id> Get the details of the device id provided get_sensor <device_id> <sensor_name> Get the state of a sensor get_binary_sensor <device_id> <sensor_name> Get the state of a binary sensor get_switch <device_id> <sensor_name> Get the state of a switch set_switch <device_id> <sensor_name> [on|off|toggle] Set the state of a switch","title":"Option 3: CLI"},{"location":"usage/#exception-handling","text":"The library provides a simplified way for handling exceptions: from imouapi.exceptions import ImouException try: await device.async_initialize() except ImouException as exception: _LOGGER.error(exception.to_string()) raise ImouException() from exception The ImouException class provides a to_string() method which returns the name of the exception which was raised and the full stacktrace.","title":"Exception Handling"},{"location":"modules/api/","text":"Low-level API for interacting with Imou devices. ImouAPIClient \u00b6 Interact with IMOU API. Source code in imouapi/api.py 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 398 399 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 419 420 421 422 423 424 425 426 427 428 429 430 431 432 433 434 435 436 437 438 439 440 441 442 443 444 445 446 447 448 449 450 451 452 453 454 455 456 457 458 459 460 461 462 class ImouAPIClient : \"\"\"Interact with IMOU API.\"\"\" def __init__ ( self , app_id : str , app_secret : str , session : ClientSession ) -> None : \"\"\" Initialize the instance. Parameters: app_id: appID from https://open.imoulife.com/consoleNew/myApp/appInfo app_secret: appID from https://open.imoulife.com/consoleNew/myApp/appInfo session: aiohttp client session \"\"\" self . _app_id = app_id self . _app_secret = app_secret self . _session = session self . _base_url = API_URL self . _timeout = DEFAULT_TIMEOUT self . _log_http_requests_enabled = False self . _redact_log_message_enabled = True self . _access_token = None self . _access_token_expire_time = None self . _connected = False self . _retries = 1 _LOGGER . debug ( \"Initialized. Endpoint URL: %s \" , self . _base_url ) def _redact_log_message ( self , data : str ) -> str : \"\"\"Redact log messages to remove sensitive information.\"\"\" if not self . _redact_log_message_enabled : return data for keyword in ( \"appId\" , \"sign\" , \"token\" , \"accessToken\" , \"playToken\" , \"thumbUrl\" , \"picUrl\" ): for tick in ( ' \\\" ' , \"'\" ): data = re . sub ( f \" { tick }{ keyword }{ tick } : \\\\ s* { tick } [^ { tick } ]+ { tick } \" , f \" { tick }{ keyword }{ tick } : { tick } XXXXXXXXX { tick } \" , data , ) return data def get_base_url ( self ) -> str : \"\"\"Get base url for the API.\"\"\" return self . _base_url def set_base_url ( self , value : str ) -> None : \"\"\"Set a custom base url for the API.\"\"\" self . _base_url = value _LOGGER . debug ( \"Set endpoint URL to %s \" , self . _base_url ) def get_timeout ( self ) -> int : \"\"\"Get timeout for the API.\"\"\" return self . _timeout def set_timeout ( self , value : int ) -> None : \"\"\"Set a custom timeout.\"\"\" self . _timeout = value _LOGGER . debug ( \"Set timeout to %s \" , self . _base_url ) def set_session ( self , value : ClientSession ) -> None : \"\"\"Set an aiohttp client session.\"\"\" self . _session = value def set_log_http_requests ( self , value : bool ) -> None : \"\"\"Set to true if you want in debug logs also HTTP requests and responses.\"\"\" self . _log_http_requests_enabled = value def set_redact_log_messages ( self , value : bool ) -> None : \"\"\"Set to true if you want debug logs redacted from sensitive data.\"\"\" self . _redact_log_message_enabled = value async def async_connect ( self ) -> bool : \"\"\"Authenticate against the API and retrieve an access token.\"\"\" # check if we already have an access token and if so assume already authenticated if self . is_connected (): return True # call the access token endpoint _LOGGER . debug ( \"Connecting\" ) data = await self . _async_call_api ( \"accessToken\" , {}, True ) if \"accessToken\" not in data or \"expireTime\" not in data : raise InvalidResponse ( f \"accessToken not found in { data } \" ) # store the access token self . _access_token = data [ \"accessToken\" ] self . _access_token_expire_time = data [ \"expireTime\" ] _LOGGER . debug ( \"Retrieved access token\" ) self . _connected = True return True async def async_disconnect ( self ) -> bool : \"\"\"Disconnect from the API.\"\"\" self . _access_token = None self . _access_token_expire_time = None self . _connected = False _LOGGER . debug ( \"Disconnected\" ) return True async def async_reconnect ( self ) -> bool : \"\"\"Reconnect to the API.\"\"\" await self . async_disconnect () return await self . async_connect () def is_connected ( self ) -> bool : \"\"\"Return true if already connected.\"\"\" return self . _connected async def _async_call_api ( self , api : str , payload : dict , is_connect_request : bool = False ) -> dict : # noqa: C901 \"\"\"Submit request to the HTTP API endpoint.\"\"\" # connect if not connected if not is_connect_request : while not self . is_connected (): _LOGGER . debug ( \"Connection attempt %d / %d \" , self . _retries , MAX_RETRIES ) # if noo many attempts, give up if self . _retries >= MAX_RETRIES : _LOGGER . error ( \"Too many unsuccesful connection attempts\" ) break try : await self . async_connect () except ImouException as exception : _LOGGER . error ( exception . to_string ()) self . _retries = self . _retries + 1 if not self . is_connected (): raise NotConnected () # calculate timestamp, nonce, sign and id as per https://open.imoulife.com/book/http/develop.html timestamp = round ( time . time ()) nonce = secrets . token_urlsafe () sign = hashlib . md5 ( f \"time: { timestamp } ,nonce: { nonce } ,appSecret: { self . _app_secret } \" . encode ( \"utf-8\" )) . hexdigest () request_id = str ( random . randint ( 1 , 10000 )) # add the access token to the payload if already available if self . _access_token is not None : payload [ \"token\" ] = self . _access_token # prepare the API request url = f \" { self . _base_url } / { api } \" body = { \"system\" : { \"ver\" : \"1.0\" , \"sign\" : sign , \"appId\" : self . _app_id , \"time\" : timestamp , \"nonce\" : nonce , }, \"params\" : payload , \"id\" : request_id , } if self . _log_http_requests_enabled : _LOGGER . debug ( \"[HTTP_REQUEST] %s : %s \" , url , self . _redact_log_message ( str ( body ))) # send the request to the API endpoint try : response = await self . _session . request ( \"POST\" , url , json = body , timeout = self . _timeout ) except Exception as exception : raise ConnectionFailed ( f \" { exception } \" ) from exception # parse the response and look for errors response_status = response . status if self . _log_http_requests_enabled : _LOGGER . debug ( \"[HTTP_RESPONSE] %s : %s \" , response_status , self . _redact_log_message ( str ( await response . text ())) ) if response_status != 200 : raise APIError ( f \"status code { response . status } \" ) try : response_body = json . loads ( await response . text ()) except Exception as exception : raise InvalidResponse ( f \"unable to parse response text { await response . text () } \" ) from exception if ( \"result\" not in response_body or \"code\" not in response_body [ \"result\" ] or \"msg\" not in response_body [ \"result\" ] ): raise InvalidResponse ( f \"cannot find result, code or msg in { response_body } \" ) result_code = response_body [ \"result\" ][ \"code\" ] result_message = response_body [ \"result\" ][ \"msg\" ] if result_code != \"0\" : error_message = result_code + \": \" + result_message if result_code in ( \"OP1008\" , \"SN1001\" ): raise InvalidConfiguration ( f \"Invalid appId or appSecret ( { error_message } )\" ) if result_code == \"OP1009\" : raise NotAuthorized ( f \" { error_message } \" ) # if the access token is invalid or expired, reconnect if result_code == \"TK1002\" : await self . async_reconnect () response_data = await self . _async_call_api ( api , payload , is_connect_request ) return response_data raise APIError ( error_message ) # return the payload of the reponse response_data = response_body [ \"result\" ][ \"data\" ] if \"data\" in response_body [ \"result\" ] else {} return response_data async def async_api_deviceBaseList ( self ) -> dict : # pylint: disable=invalid-name \"\"\"Return the list of registered devices \\ (https://open.imoulife.com/book/http/device/manage/query/deviceBaseList.html).\"\"\" # define the api endpoint api = \"deviceBaseList\" # prepare the payload payload = { \"bindId\" : - 1 , \"limit\" : 50 , \"type\" : \"bindAndShare\" , \"needApInfo\" : True , } # call the api return await self . _async_call_api ( api , payload ) async def async_api_deviceOpenList ( self ) -> dict : # pylint: disable=invalid-name \"\"\"Return the list of registered devices (Open) \\ (https://open.imoulife.com/book/http/device/manage/query/deviceOpenList.html).\"\"\" # define the api endpoint api = \"deviceOpenList\" # prepare the payload payload = { \"bindId\" : - 1 , \"limit\" : 50 , \"type\" : \"bindAndShare\" , \"needApInfo\" : True , } # call the api return await self . _async_call_api ( api , payload ) async def async_api_deviceBaseDetailList ( self , devices : list [ str ]) -> dict : # pylint: disable=invalid-name \"\"\"Return the details of the requested devices \\ (https://open.imoulife.com/book/http/device/manage/query/deviceBaseDetailList.html).\"\"\" # define the api endpoint api = \"deviceBaseDetailList\" # prepare the payload device_list = [] for device in devices : device_list . append ( { \"deviceId\" : device , \"channelList\" : \"0\" , } ) payload = { \"deviceList\" : device_list } # call the api return await self . _async_call_api ( api , payload ) async def async_api_deviceOpenDetailList ( self , devices : list [ str ]) -> dict : # pylint: disable=invalid-name \"\"\"Return the details of the requested devices (Open) \\ (https://open.imoulife.com/book/http/device/manage/query/deviceOpenDetailList.html).\"\"\" # define the api endpoint api = \"deviceOpenDetailList\" # prepare the payload device_list = [] for device in devices : device_list . append ( { \"deviceId\" : device , \"channelList\" : \"0\" , } ) payload = { \"deviceList\" : device_list } # call the api return await self . _async_call_api ( api , payload ) async def async_api_listDeviceAbility ( self , devices : list [ str ]) -> dict : # pylint: disable=invalid-name \"\"\"Ability to obtain multiple devices, channels, and accessories in batches \\ (https://open.imoulife.com/book/http/device/manage/query/listDeviceAbility.html).\"\"\" # define the api endpoint api = \"listDeviceAbility\" # prepare the payload device_list = [] for device in devices : device_list . append ( { \"deviceId\" : device , \"channelList\" : \"0\" , } ) payload = { \"deviceList\" : device_list } # call the api return await self . _async_call_api ( api , payload ) async def async_api_deviceOnline ( self , device_id : str ) -> dict : # pylint: disable=invalid-name \"\"\"Device online or offline \\ (https://open.imoulife.com/book/http/device/manage/query/deviceOnline.html).\"\"\" # define the api endpoint api = \"deviceOnline\" # prepare the payload payload = { \"deviceId\" : device_id , } # call the api return await self . _async_call_api ( api , payload ) async def async_api_deviceStorage ( self , device_id : str ) -> dict : # pylint: disable=invalid-name \"\"\"Obtain device storage medium capacity information. \\ (https://open.imoulife.com/book/http/device/config/storage/deviceStorage.html).\"\"\" # define the api endpoint api = \"deviceStorage\" # prepare the payload payload = { \"deviceId\" : device_id , } # call the api return await self . _async_call_api ( api , payload ) async def async_api_getDeviceCameraStatus ( # pylint: disable=invalid-name self , device_id : str , enable_type : str ) -> dict : \"\"\"Get the status of the device switch \\ (https://open.imoulife.com/book/http/device/config/ability/getDeviceCameraStatus.html).\"\"\" # define the api endpoint api = \"getDeviceCameraStatus\" # prepare the payload payload = { \"deviceId\" : device_id , \"enableType\" : enable_type , } # call the api return await self . _async_call_api ( api , payload ) async def async_api_setDeviceCameraStatus ( # pylint: disable=invalid-name self , device_id : str , enable_type : str , value : bool ) -> dict : \"\"\"Set a device switch \\ (https://open.imoulife.com/book/http/device/config/ability/setDeviceCameraStatus.html).\"\"\" # define the api endpoint api = \"setDeviceCameraStatus\" # prepare the payload payload = { \"deviceId\" : device_id , \"enableType\" : enable_type , \"enable\" : value , } # call the api return await self . _async_call_api ( api , payload ) async def async_api_getAlarmMessage ( self , device_id : str ) -> dict : # pylint: disable=invalid-name \"\"\"Get the device message list of the device channel in the specified time period \\ (https://open.imoulife.com/book/http/device/alarm/getAlarmMessage.html).\"\"\" # define the api endpoint api = \"getAlarmMessage\" # prepare the payload now_time = datetime . now () begin_time = now_time - timedelta ( days = 30 ) end_time = now_time + timedelta ( days = 1 ) payload = { \"deviceId\" : device_id , \"count\" : \"10\" , \"channelId\" : \"0\" , \"beginTime\" : begin_time . strftime ( \"%Y-%m- %d %H:%M:%S\" ), \"endTime\" : end_time . strftime ( \"%Y-%m- %d %H:%M:%S\" ), } # call the api return await self . _async_call_api ( api , payload ) async def async_api_getNightVisionMode ( self , device_id : str ) -> dict : # pylint: disable=invalid-name \"\"\"Query the night vision mode configuration of the device \\ (https://open.imoulife.com/book/http/device/config/video/getNightVisionMode.html).\"\"\" # define the api endpoint api = \"getNightVisionMode\" # prepare the payload payload = { \"deviceId\" : device_id , \"channelId\" : \"0\" , } # call the api return await self . _async_call_api ( api , payload ) async def async_api_setNightVisionMode ( self , device_id : str , mode : str ) -> dict : # pylint: disable=invalid-name \"\"\"Set the night vision mode of the device \\ (https://open.imoulife.com/book/http/device/config/video/setNightVisionMode.html).\"\"\" # define the api endpoint api = \"setNightVisionMode\" # prepare the payload payload = { \"deviceId\" : device_id , \"channelId\" : \"0\" , \"mode\" : mode , } # call the api return await self . _async_call_api ( api , payload ) async def async_api_getMessageCallback ( self ) -> dict : # pylint: disable=invalid-name \"\"\"Get the message callback address information currently set \\ (https://open.imoulife.com/book/http/push/getMessageCallback.html).\"\"\" # define the api endpoint api = \"getMessageCallback\" # prepare the payload payload : dict = {} # call the api return await self . _async_call_api ( api , payload ) async def async_api_setMessageCallbackOn ( self , callback_url : str ) -> dict : # pylint: disable=invalid-name \"\"\"Set the message callback address. \\ (https://open.imoulife.com/book/http/push/setMessageCallback.html).\"\"\" # define the api endpoint api = \"setMessageCallback\" # prepare the payload payload = { \"callbackFlag\" : \"alarm,deviceStatus\" , # \"basePush\": \"2\", \"callbackUrl\" : callback_url , \"status\" : \"on\" , } # call the api return await self . _async_call_api ( api , payload ) async def async_api_setMessageCallbackOff ( self ) -> dict : # pylint: disable=invalid-name \"\"\"Unset the message callback address. \\ (https://open.imoulife.com/book/http/push/setMessageCallback.html).\"\"\" # define the api endpoint api = \"setMessageCallback\" # prepare the payload payload = { \"status\" : \"off\" , } # call the api return await self . _async_call_api ( api , payload ) async def async_api_restartDevice ( self , device_id : str ) -> dict : # pylint: disable=invalid-name \"\"\"Restart the device. \\ (https://open.imoulife.com/book/en/http/device/operate/restartDevice.html).\"\"\" # define the api endpoint api = \"restartDevice\" # prepare the payload payload = { \"deviceId\" : device_id , } # call the api return await self . _async_call_api ( api , payload ) async def async_api_deviceSdcardStatus ( self , device_id : str ) -> dict : # pylint: disable=invalid-name \"\"\"Get the SD card status of the device.. \\ (https://open.imoulife.com/book/en/http/device/config/storage/deviceSdcardStatus.html).\"\"\" # define the api endpoint api = \"deviceSdcardStatus\" # prepare the payload payload = { \"deviceId\" : device_id , } # call the api return await self . _async_call_api ( api , payload ) __init__ ( app_id , app_secret , session ) \u00b6 Initialize the instance. Parameters: Name Type Description Default app_id str appID from https://open.imoulife.com/consoleNew/myApp/appInfo required app_secret str appID from https://open.imoulife.com/consoleNew/myApp/appInfo required session ClientSession aiohttp client session required Source code in imouapi/api.py 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 def __init__ ( self , app_id : str , app_secret : str , session : ClientSession ) -> None : \"\"\" Initialize the instance. Parameters: app_id: appID from https://open.imoulife.com/consoleNew/myApp/appInfo app_secret: appID from https://open.imoulife.com/consoleNew/myApp/appInfo session: aiohttp client session \"\"\" self . _app_id = app_id self . _app_secret = app_secret self . _session = session self . _base_url = API_URL self . _timeout = DEFAULT_TIMEOUT self . _log_http_requests_enabled = False self . _redact_log_message_enabled = True self . _access_token = None self . _access_token_expire_time = None self . _connected = False self . _retries = 1 _LOGGER . debug ( \"Initialized. Endpoint URL: %s \" , self . _base_url ) async_api_deviceBaseDetailList ( devices ) async \u00b6 Return the details of the requested devices (https://open.imoulife.com/book/http/device/manage/query/deviceBaseDetailList.html). Source code in imouapi/api.py 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 async def async_api_deviceBaseDetailList ( self , devices : list [ str ]) -> dict : # pylint: disable=invalid-name \"\"\"Return the details of the requested devices \\ (https://open.imoulife.com/book/http/device/manage/query/deviceBaseDetailList.html).\"\"\" # define the api endpoint api = \"deviceBaseDetailList\" # prepare the payload device_list = [] for device in devices : device_list . append ( { \"deviceId\" : device , \"channelList\" : \"0\" , } ) payload = { \"deviceList\" : device_list } # call the api return await self . _async_call_api ( api , payload ) async_api_deviceBaseList () async \u00b6 Return the list of registered devices (https://open.imoulife.com/book/http/device/manage/query/deviceBaseList.html). Source code in imouapi/api.py 218 219 220 221 222 223 224 225 226 227 228 229 230 231 async def async_api_deviceBaseList ( self ) -> dict : # pylint: disable=invalid-name \"\"\"Return the list of registered devices \\ (https://open.imoulife.com/book/http/device/manage/query/deviceBaseList.html).\"\"\" # define the api endpoint api = \"deviceBaseList\" # prepare the payload payload = { \"bindId\" : - 1 , \"limit\" : 50 , \"type\" : \"bindAndShare\" , \"needApInfo\" : True , } # call the api return await self . _async_call_api ( api , payload ) async_api_deviceOnline ( device_id ) async \u00b6 Device online or offline (https://open.imoulife.com/book/http/device/manage/query/deviceOnline.html). Source code in imouapi/api.py 302 303 304 305 306 307 308 309 310 311 312 async def async_api_deviceOnline ( self , device_id : str ) -> dict : # pylint: disable=invalid-name \"\"\"Device online or offline \\ (https://open.imoulife.com/book/http/device/manage/query/deviceOnline.html).\"\"\" # define the api endpoint api = \"deviceOnline\" # prepare the payload payload = { \"deviceId\" : device_id , } # call the api return await self . _async_call_api ( api , payload ) async_api_deviceOpenDetailList ( devices ) async \u00b6 Return the details of the requested devices (Open) (https://open.imoulife.com/book/http/device/manage/query/deviceOpenDetailList.html). Source code in imouapi/api.py 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 async def async_api_deviceOpenDetailList ( self , devices : list [ str ]) -> dict : # pylint: disable=invalid-name \"\"\"Return the details of the requested devices (Open) \\ (https://open.imoulife.com/book/http/device/manage/query/deviceOpenDetailList.html).\"\"\" # define the api endpoint api = \"deviceOpenDetailList\" # prepare the payload device_list = [] for device in devices : device_list . append ( { \"deviceId\" : device , \"channelList\" : \"0\" , } ) payload = { \"deviceList\" : device_list } # call the api return await self . _async_call_api ( api , payload ) async_api_deviceOpenList () async \u00b6 Return the list of registered devices (Open) (https://open.imoulife.com/book/http/device/manage/query/deviceOpenList.html). Source code in imouapi/api.py 233 234 235 236 237 238 239 240 241 242 243 244 245 246 async def async_api_deviceOpenList ( self ) -> dict : # pylint: disable=invalid-name \"\"\"Return the list of registered devices (Open) \\ (https://open.imoulife.com/book/http/device/manage/query/deviceOpenList.html).\"\"\" # define the api endpoint api = \"deviceOpenList\" # prepare the payload payload = { \"bindId\" : - 1 , \"limit\" : 50 , \"type\" : \"bindAndShare\" , \"needApInfo\" : True , } # call the api return await self . _async_call_api ( api , payload ) async_api_deviceSdcardStatus ( device_id ) async \u00b6 Get the SD card status of the device.. (https://open.imoulife.com/book/en/http/device/config/storage/deviceSdcardStatus.html). Source code in imouapi/api.py 452 453 454 455 456 457 458 459 460 461 462 async def async_api_deviceSdcardStatus ( self , device_id : str ) -> dict : # pylint: disable=invalid-name \"\"\"Get the SD card status of the device.. \\ (https://open.imoulife.com/book/en/http/device/config/storage/deviceSdcardStatus.html).\"\"\" # define the api endpoint api = \"deviceSdcardStatus\" # prepare the payload payload = { \"deviceId\" : device_id , } # call the api return await self . _async_call_api ( api , payload ) async_api_deviceStorage ( device_id ) async \u00b6 Obtain device storage medium capacity information. (https://open.imoulife.com/book/http/device/config/storage/deviceStorage.html). Source code in imouapi/api.py 314 315 316 317 318 319 320 321 322 323 324 async def async_api_deviceStorage ( self , device_id : str ) -> dict : # pylint: disable=invalid-name \"\"\"Obtain device storage medium capacity information. \\ (https://open.imoulife.com/book/http/device/config/storage/deviceStorage.html).\"\"\" # define the api endpoint api = \"deviceStorage\" # prepare the payload payload = { \"deviceId\" : device_id , } # call the api return await self . _async_call_api ( api , payload ) async_api_getAlarmMessage ( device_id ) async \u00b6 Get the device message list of the device channel in the specified time period (https://open.imoulife.com/book/http/device/alarm/getAlarmMessage.html). Source code in imouapi/api.py 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 async def async_api_getAlarmMessage ( self , device_id : str ) -> dict : # pylint: disable=invalid-name \"\"\"Get the device message list of the device channel in the specified time period \\ (https://open.imoulife.com/book/http/device/alarm/getAlarmMessage.html).\"\"\" # define the api endpoint api = \"getAlarmMessage\" # prepare the payload now_time = datetime . now () begin_time = now_time - timedelta ( days = 30 ) end_time = now_time + timedelta ( days = 1 ) payload = { \"deviceId\" : device_id , \"count\" : \"10\" , \"channelId\" : \"0\" , \"beginTime\" : begin_time . strftime ( \"%Y-%m- %d %H:%M:%S\" ), \"endTime\" : end_time . strftime ( \"%Y-%m- %d %H:%M:%S\" ), } # call the api return await self . _async_call_api ( api , payload ) async_api_getDeviceCameraStatus ( device_id , enable_type ) async \u00b6 Get the status of the device switch (https://open.imoulife.com/book/http/device/config/ability/getDeviceCameraStatus.html). Source code in imouapi/api.py 326 327 328 329 330 331 332 333 334 335 336 337 338 339 async def async_api_getDeviceCameraStatus ( # pylint: disable=invalid-name self , device_id : str , enable_type : str ) -> dict : \"\"\"Get the status of the device switch \\ (https://open.imoulife.com/book/http/device/config/ability/getDeviceCameraStatus.html).\"\"\" # define the api endpoint api = \"getDeviceCameraStatus\" # prepare the payload payload = { \"deviceId\" : device_id , \"enableType\" : enable_type , } # call the api return await self . _async_call_api ( api , payload ) async_api_getMessageCallback () async \u00b6 Get the message callback address information currently set (https://open.imoulife.com/book/http/push/getMessageCallback.html). Source code in imouapi/api.py 403 404 405 406 407 408 409 410 411 async def async_api_getMessageCallback ( self ) -> dict : # pylint: disable=invalid-name \"\"\"Get the message callback address information currently set \\ (https://open.imoulife.com/book/http/push/getMessageCallback.html).\"\"\" # define the api endpoint api = \"getMessageCallback\" # prepare the payload payload : dict = {} # call the api return await self . _async_call_api ( api , payload ) async_api_getNightVisionMode ( device_id ) async \u00b6 Query the night vision mode configuration of the device (https://open.imoulife.com/book/http/device/config/video/getNightVisionMode.html). Source code in imouapi/api.py 376 377 378 379 380 381 382 383 384 385 386 387 async def async_api_getNightVisionMode ( self , device_id : str ) -> dict : # pylint: disable=invalid-name \"\"\"Query the night vision mode configuration of the device \\ (https://open.imoulife.com/book/http/device/config/video/getNightVisionMode.html).\"\"\" # define the api endpoint api = \"getNightVisionMode\" # prepare the payload payload = { \"deviceId\" : device_id , \"channelId\" : \"0\" , } # call the api return await self . _async_call_api ( api , payload ) async_api_listDeviceAbility ( devices ) async \u00b6 Ability to obtain multiple devices, channels, and accessories in batches (https://open.imoulife.com/book/http/device/manage/query/listDeviceAbility.html). Source code in imouapi/api.py 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 async def async_api_listDeviceAbility ( self , devices : list [ str ]) -> dict : # pylint: disable=invalid-name \"\"\"Ability to obtain multiple devices, channels, and accessories in batches \\ (https://open.imoulife.com/book/http/device/manage/query/listDeviceAbility.html).\"\"\" # define the api endpoint api = \"listDeviceAbility\" # prepare the payload device_list = [] for device in devices : device_list . append ( { \"deviceId\" : device , \"channelList\" : \"0\" , } ) payload = { \"deviceList\" : device_list } # call the api return await self . _async_call_api ( api , payload ) async_api_restartDevice ( device_id ) async \u00b6 Restart the device. (https://open.imoulife.com/book/en/http/device/operate/restartDevice.html). Source code in imouapi/api.py 440 441 442 443 444 445 446 447 448 449 450 async def async_api_restartDevice ( self , device_id : str ) -> dict : # pylint: disable=invalid-name \"\"\"Restart the device. \\ (https://open.imoulife.com/book/en/http/device/operate/restartDevice.html).\"\"\" # define the api endpoint api = \"restartDevice\" # prepare the payload payload = { \"deviceId\" : device_id , } # call the api return await self . _async_call_api ( api , payload ) async_api_setDeviceCameraStatus ( device_id , enable_type , value ) async \u00b6 Set a device switch (https://open.imoulife.com/book/http/device/config/ability/setDeviceCameraStatus.html). Source code in imouapi/api.py 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 async def async_api_setDeviceCameraStatus ( # pylint: disable=invalid-name self , device_id : str , enable_type : str , value : bool ) -> dict : \"\"\"Set a device switch \\ (https://open.imoulife.com/book/http/device/config/ability/setDeviceCameraStatus.html).\"\"\" # define the api endpoint api = \"setDeviceCameraStatus\" # prepare the payload payload = { \"deviceId\" : device_id , \"enableType\" : enable_type , \"enable\" : value , } # call the api return await self . _async_call_api ( api , payload ) async_api_setMessageCallbackOff () async \u00b6 Unset the message callback address. (https://open.imoulife.com/book/http/push/setMessageCallback.html). Source code in imouapi/api.py 428 429 430 431 432 433 434 435 436 437 438 async def async_api_setMessageCallbackOff ( self ) -> dict : # pylint: disable=invalid-name \"\"\"Unset the message callback address. \\ (https://open.imoulife.com/book/http/push/setMessageCallback.html).\"\"\" # define the api endpoint api = \"setMessageCallback\" # prepare the payload payload = { \"status\" : \"off\" , } # call the api return await self . _async_call_api ( api , payload ) async_api_setMessageCallbackOn ( callback_url ) async \u00b6 Set the message callback address. (https://open.imoulife.com/book/http/push/setMessageCallback.html). Source code in imouapi/api.py 413 414 415 416 417 418 419 420 421 422 423 424 425 426 async def async_api_setMessageCallbackOn ( self , callback_url : str ) -> dict : # pylint: disable=invalid-name \"\"\"Set the message callback address. \\ (https://open.imoulife.com/book/http/push/setMessageCallback.html).\"\"\" # define the api endpoint api = \"setMessageCallback\" # prepare the payload payload = { \"callbackFlag\" : \"alarm,deviceStatus\" , # \"basePush\": \"2\", \"callbackUrl\" : callback_url , \"status\" : \"on\" , } # call the api return await self . _async_call_api ( api , payload ) async_api_setNightVisionMode ( device_id , mode ) async \u00b6 Set the night vision mode of the device (https://open.imoulife.com/book/http/device/config/video/setNightVisionMode.html). Source code in imouapi/api.py 389 390 391 392 393 394 395 396 397 398 399 400 401 async def async_api_setNightVisionMode ( self , device_id : str , mode : str ) -> dict : # pylint: disable=invalid-name \"\"\"Set the night vision mode of the device \\ (https://open.imoulife.com/book/http/device/config/video/setNightVisionMode.html).\"\"\" # define the api endpoint api = \"setNightVisionMode\" # prepare the payload payload = { \"deviceId\" : device_id , \"channelId\" : \"0\" , \"mode\" : mode , } # call the api return await self . _async_call_api ( api , payload ) async_connect () async \u00b6 Authenticate against the API and retrieve an access token. Source code in imouapi/api.py 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 async def async_connect ( self ) -> bool : \"\"\"Authenticate against the API and retrieve an access token.\"\"\" # check if we already have an access token and if so assume already authenticated if self . is_connected (): return True # call the access token endpoint _LOGGER . debug ( \"Connecting\" ) data = await self . _async_call_api ( \"accessToken\" , {}, True ) if \"accessToken\" not in data or \"expireTime\" not in data : raise InvalidResponse ( f \"accessToken not found in { data } \" ) # store the access token self . _access_token = data [ \"accessToken\" ] self . _access_token_expire_time = data [ \"expireTime\" ] _LOGGER . debug ( \"Retrieved access token\" ) self . _connected = True return True async_disconnect () async \u00b6 Disconnect from the API. Source code in imouapi/api.py 114 115 116 117 118 119 120 async def async_disconnect ( self ) -> bool : \"\"\"Disconnect from the API.\"\"\" self . _access_token = None self . _access_token_expire_time = None self . _connected = False _LOGGER . debug ( \"Disconnected\" ) return True async_reconnect () async \u00b6 Reconnect to the API. Source code in imouapi/api.py 122 123 124 125 async def async_reconnect ( self ) -> bool : \"\"\"Reconnect to the API.\"\"\" await self . async_disconnect () return await self . async_connect () get_base_url () \u00b6 Get base url for the API. Source code in imouapi/api.py 67 68 69 def get_base_url ( self ) -> str : \"\"\"Get base url for the API.\"\"\" return self . _base_url get_timeout () \u00b6 Get timeout for the API. Source code in imouapi/api.py 76 77 78 def get_timeout ( self ) -> int : \"\"\"Get timeout for the API.\"\"\" return self . _timeout is_connected () \u00b6 Return true if already connected. Source code in imouapi/api.py 127 128 129 def is_connected ( self ) -> bool : \"\"\"Return true if already connected.\"\"\" return self . _connected set_base_url ( value ) \u00b6 Set a custom base url for the API. Source code in imouapi/api.py 71 72 73 74 def set_base_url ( self , value : str ) -> None : \"\"\"Set a custom base url for the API.\"\"\" self . _base_url = value _LOGGER . debug ( \"Set endpoint URL to %s \" , self . _base_url ) set_log_http_requests ( value ) \u00b6 Set to true if you want in debug logs also HTTP requests and responses. Source code in imouapi/api.py 89 90 91 def set_log_http_requests ( self , value : bool ) -> None : \"\"\"Set to true if you want in debug logs also HTTP requests and responses.\"\"\" self . _log_http_requests_enabled = value set_redact_log_messages ( value ) \u00b6 Set to true if you want debug logs redacted from sensitive data. Source code in imouapi/api.py 93 94 95 def set_redact_log_messages ( self , value : bool ) -> None : \"\"\"Set to true if you want debug logs redacted from sensitive data.\"\"\" self . _redact_log_message_enabled = value set_session ( value ) \u00b6 Set an aiohttp client session. Source code in imouapi/api.py 85 86 87 def set_session ( self , value : ClientSession ) -> None : \"\"\"Set an aiohttp client session.\"\"\" self . _session = value set_timeout ( value ) \u00b6 Set a custom timeout. Source code in imouapi/api.py 80 81 82 83 def set_timeout ( self , value : int ) -> None : \"\"\"Set a custom timeout.\"\"\" self . _timeout = value _LOGGER . debug ( \"Set timeout to %s \" , self . _base_url )","title":"api"},{"location":"modules/api/#imouapi.api.ImouAPIClient","text":"Interact with IMOU API. Source code in imouapi/api.py 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 398 399 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 419 420 421 422 423 424 425 426 427 428 429 430 431 432 433 434 435 436 437 438 439 440 441 442 443 444 445 446 447 448 449 450 451 452 453 454 455 456 457 458 459 460 461 462 class ImouAPIClient : \"\"\"Interact with IMOU API.\"\"\" def __init__ ( self , app_id : str , app_secret : str , session : ClientSession ) -> None : \"\"\" Initialize the instance. Parameters: app_id: appID from https://open.imoulife.com/consoleNew/myApp/appInfo app_secret: appID from https://open.imoulife.com/consoleNew/myApp/appInfo session: aiohttp client session \"\"\" self . _app_id = app_id self . _app_secret = app_secret self . _session = session self . _base_url = API_URL self . _timeout = DEFAULT_TIMEOUT self . _log_http_requests_enabled = False self . _redact_log_message_enabled = True self . _access_token = None self . _access_token_expire_time = None self . _connected = False self . _retries = 1 _LOGGER . debug ( \"Initialized. Endpoint URL: %s \" , self . _base_url ) def _redact_log_message ( self , data : str ) -> str : \"\"\"Redact log messages to remove sensitive information.\"\"\" if not self . _redact_log_message_enabled : return data for keyword in ( \"appId\" , \"sign\" , \"token\" , \"accessToken\" , \"playToken\" , \"thumbUrl\" , \"picUrl\" ): for tick in ( ' \\\" ' , \"'\" ): data = re . sub ( f \" { tick }{ keyword }{ tick } : \\\\ s* { tick } [^ { tick } ]+ { tick } \" , f \" { tick }{ keyword }{ tick } : { tick } XXXXXXXXX { tick } \" , data , ) return data def get_base_url ( self ) -> str : \"\"\"Get base url for the API.\"\"\" return self . _base_url def set_base_url ( self , value : str ) -> None : \"\"\"Set a custom base url for the API.\"\"\" self . _base_url = value _LOGGER . debug ( \"Set endpoint URL to %s \" , self . _base_url ) def get_timeout ( self ) -> int : \"\"\"Get timeout for the API.\"\"\" return self . _timeout def set_timeout ( self , value : int ) -> None : \"\"\"Set a custom timeout.\"\"\" self . _timeout = value _LOGGER . debug ( \"Set timeout to %s \" , self . _base_url ) def set_session ( self , value : ClientSession ) -> None : \"\"\"Set an aiohttp client session.\"\"\" self . _session = value def set_log_http_requests ( self , value : bool ) -> None : \"\"\"Set to true if you want in debug logs also HTTP requests and responses.\"\"\" self . _log_http_requests_enabled = value def set_redact_log_messages ( self , value : bool ) -> None : \"\"\"Set to true if you want debug logs redacted from sensitive data.\"\"\" self . _redact_log_message_enabled = value async def async_connect ( self ) -> bool : \"\"\"Authenticate against the API and retrieve an access token.\"\"\" # check if we already have an access token and if so assume already authenticated if self . is_connected (): return True # call the access token endpoint _LOGGER . debug ( \"Connecting\" ) data = await self . _async_call_api ( \"accessToken\" , {}, True ) if \"accessToken\" not in data or \"expireTime\" not in data : raise InvalidResponse ( f \"accessToken not found in { data } \" ) # store the access token self . _access_token = data [ \"accessToken\" ] self . _access_token_expire_time = data [ \"expireTime\" ] _LOGGER . debug ( \"Retrieved access token\" ) self . _connected = True return True async def async_disconnect ( self ) -> bool : \"\"\"Disconnect from the API.\"\"\" self . _access_token = None self . _access_token_expire_time = None self . _connected = False _LOGGER . debug ( \"Disconnected\" ) return True async def async_reconnect ( self ) -> bool : \"\"\"Reconnect to the API.\"\"\" await self . async_disconnect () return await self . async_connect () def is_connected ( self ) -> bool : \"\"\"Return true if already connected.\"\"\" return self . _connected async def _async_call_api ( self , api : str , payload : dict , is_connect_request : bool = False ) -> dict : # noqa: C901 \"\"\"Submit request to the HTTP API endpoint.\"\"\" # connect if not connected if not is_connect_request : while not self . is_connected (): _LOGGER . debug ( \"Connection attempt %d / %d \" , self . _retries , MAX_RETRIES ) # if noo many attempts, give up if self . _retries >= MAX_RETRIES : _LOGGER . error ( \"Too many unsuccesful connection attempts\" ) break try : await self . async_connect () except ImouException as exception : _LOGGER . error ( exception . to_string ()) self . _retries = self . _retries + 1 if not self . is_connected (): raise NotConnected () # calculate timestamp, nonce, sign and id as per https://open.imoulife.com/book/http/develop.html timestamp = round ( time . time ()) nonce = secrets . token_urlsafe () sign = hashlib . md5 ( f \"time: { timestamp } ,nonce: { nonce } ,appSecret: { self . _app_secret } \" . encode ( \"utf-8\" )) . hexdigest () request_id = str ( random . randint ( 1 , 10000 )) # add the access token to the payload if already available if self . _access_token is not None : payload [ \"token\" ] = self . _access_token # prepare the API request url = f \" { self . _base_url } / { api } \" body = { \"system\" : { \"ver\" : \"1.0\" , \"sign\" : sign , \"appId\" : self . _app_id , \"time\" : timestamp , \"nonce\" : nonce , }, \"params\" : payload , \"id\" : request_id , } if self . _log_http_requests_enabled : _LOGGER . debug ( \"[HTTP_REQUEST] %s : %s \" , url , self . _redact_log_message ( str ( body ))) # send the request to the API endpoint try : response = await self . _session . request ( \"POST\" , url , json = body , timeout = self . _timeout ) except Exception as exception : raise ConnectionFailed ( f \" { exception } \" ) from exception # parse the response and look for errors response_status = response . status if self . _log_http_requests_enabled : _LOGGER . debug ( \"[HTTP_RESPONSE] %s : %s \" , response_status , self . _redact_log_message ( str ( await response . text ())) ) if response_status != 200 : raise APIError ( f \"status code { response . status } \" ) try : response_body = json . loads ( await response . text ()) except Exception as exception : raise InvalidResponse ( f \"unable to parse response text { await response . text () } \" ) from exception if ( \"result\" not in response_body or \"code\" not in response_body [ \"result\" ] or \"msg\" not in response_body [ \"result\" ] ): raise InvalidResponse ( f \"cannot find result, code or msg in { response_body } \" ) result_code = response_body [ \"result\" ][ \"code\" ] result_message = response_body [ \"result\" ][ \"msg\" ] if result_code != \"0\" : error_message = result_code + \": \" + result_message if result_code in ( \"OP1008\" , \"SN1001\" ): raise InvalidConfiguration ( f \"Invalid appId or appSecret ( { error_message } )\" ) if result_code == \"OP1009\" : raise NotAuthorized ( f \" { error_message } \" ) # if the access token is invalid or expired, reconnect if result_code == \"TK1002\" : await self . async_reconnect () response_data = await self . _async_call_api ( api , payload , is_connect_request ) return response_data raise APIError ( error_message ) # return the payload of the reponse response_data = response_body [ \"result\" ][ \"data\" ] if \"data\" in response_body [ \"result\" ] else {} return response_data async def async_api_deviceBaseList ( self ) -> dict : # pylint: disable=invalid-name \"\"\"Return the list of registered devices \\ (https://open.imoulife.com/book/http/device/manage/query/deviceBaseList.html).\"\"\" # define the api endpoint api = \"deviceBaseList\" # prepare the payload payload = { \"bindId\" : - 1 , \"limit\" : 50 , \"type\" : \"bindAndShare\" , \"needApInfo\" : True , } # call the api return await self . _async_call_api ( api , payload ) async def async_api_deviceOpenList ( self ) -> dict : # pylint: disable=invalid-name \"\"\"Return the list of registered devices (Open) \\ (https://open.imoulife.com/book/http/device/manage/query/deviceOpenList.html).\"\"\" # define the api endpoint api = \"deviceOpenList\" # prepare the payload payload = { \"bindId\" : - 1 , \"limit\" : 50 , \"type\" : \"bindAndShare\" , \"needApInfo\" : True , } # call the api return await self . _async_call_api ( api , payload ) async def async_api_deviceBaseDetailList ( self , devices : list [ str ]) -> dict : # pylint: disable=invalid-name \"\"\"Return the details of the requested devices \\ (https://open.imoulife.com/book/http/device/manage/query/deviceBaseDetailList.html).\"\"\" # define the api endpoint api = \"deviceBaseDetailList\" # prepare the payload device_list = [] for device in devices : device_list . append ( { \"deviceId\" : device , \"channelList\" : \"0\" , } ) payload = { \"deviceList\" : device_list } # call the api return await self . _async_call_api ( api , payload ) async def async_api_deviceOpenDetailList ( self , devices : list [ str ]) -> dict : # pylint: disable=invalid-name \"\"\"Return the details of the requested devices (Open) \\ (https://open.imoulife.com/book/http/device/manage/query/deviceOpenDetailList.html).\"\"\" # define the api endpoint api = \"deviceOpenDetailList\" # prepare the payload device_list = [] for device in devices : device_list . append ( { \"deviceId\" : device , \"channelList\" : \"0\" , } ) payload = { \"deviceList\" : device_list } # call the api return await self . _async_call_api ( api , payload ) async def async_api_listDeviceAbility ( self , devices : list [ str ]) -> dict : # pylint: disable=invalid-name \"\"\"Ability to obtain multiple devices, channels, and accessories in batches \\ (https://open.imoulife.com/book/http/device/manage/query/listDeviceAbility.html).\"\"\" # define the api endpoint api = \"listDeviceAbility\" # prepare the payload device_list = [] for device in devices : device_list . append ( { \"deviceId\" : device , \"channelList\" : \"0\" , } ) payload = { \"deviceList\" : device_list } # call the api return await self . _async_call_api ( api , payload ) async def async_api_deviceOnline ( self , device_id : str ) -> dict : # pylint: disable=invalid-name \"\"\"Device online or offline \\ (https://open.imoulife.com/book/http/device/manage/query/deviceOnline.html).\"\"\" # define the api endpoint api = \"deviceOnline\" # prepare the payload payload = { \"deviceId\" : device_id , } # call the api return await self . _async_call_api ( api , payload ) async def async_api_deviceStorage ( self , device_id : str ) -> dict : # pylint: disable=invalid-name \"\"\"Obtain device storage medium capacity information. \\ (https://open.imoulife.com/book/http/device/config/storage/deviceStorage.html).\"\"\" # define the api endpoint api = \"deviceStorage\" # prepare the payload payload = { \"deviceId\" : device_id , } # call the api return await self . _async_call_api ( api , payload ) async def async_api_getDeviceCameraStatus ( # pylint: disable=invalid-name self , device_id : str , enable_type : str ) -> dict : \"\"\"Get the status of the device switch \\ (https://open.imoulife.com/book/http/device/config/ability/getDeviceCameraStatus.html).\"\"\" # define the api endpoint api = \"getDeviceCameraStatus\" # prepare the payload payload = { \"deviceId\" : device_id , \"enableType\" : enable_type , } # call the api return await self . _async_call_api ( api , payload ) async def async_api_setDeviceCameraStatus ( # pylint: disable=invalid-name self , device_id : str , enable_type : str , value : bool ) -> dict : \"\"\"Set a device switch \\ (https://open.imoulife.com/book/http/device/config/ability/setDeviceCameraStatus.html).\"\"\" # define the api endpoint api = \"setDeviceCameraStatus\" # prepare the payload payload = { \"deviceId\" : device_id , \"enableType\" : enable_type , \"enable\" : value , } # call the api return await self . _async_call_api ( api , payload ) async def async_api_getAlarmMessage ( self , device_id : str ) -> dict : # pylint: disable=invalid-name \"\"\"Get the device message list of the device channel in the specified time period \\ (https://open.imoulife.com/book/http/device/alarm/getAlarmMessage.html).\"\"\" # define the api endpoint api = \"getAlarmMessage\" # prepare the payload now_time = datetime . now () begin_time = now_time - timedelta ( days = 30 ) end_time = now_time + timedelta ( days = 1 ) payload = { \"deviceId\" : device_id , \"count\" : \"10\" , \"channelId\" : \"0\" , \"beginTime\" : begin_time . strftime ( \"%Y-%m- %d %H:%M:%S\" ), \"endTime\" : end_time . strftime ( \"%Y-%m- %d %H:%M:%S\" ), } # call the api return await self . _async_call_api ( api , payload ) async def async_api_getNightVisionMode ( self , device_id : str ) -> dict : # pylint: disable=invalid-name \"\"\"Query the night vision mode configuration of the device \\ (https://open.imoulife.com/book/http/device/config/video/getNightVisionMode.html).\"\"\" # define the api endpoint api = \"getNightVisionMode\" # prepare the payload payload = { \"deviceId\" : device_id , \"channelId\" : \"0\" , } # call the api return await self . _async_call_api ( api , payload ) async def async_api_setNightVisionMode ( self , device_id : str , mode : str ) -> dict : # pylint: disable=invalid-name \"\"\"Set the night vision mode of the device \\ (https://open.imoulife.com/book/http/device/config/video/setNightVisionMode.html).\"\"\" # define the api endpoint api = \"setNightVisionMode\" # prepare the payload payload = { \"deviceId\" : device_id , \"channelId\" : \"0\" , \"mode\" : mode , } # call the api return await self . _async_call_api ( api , payload ) async def async_api_getMessageCallback ( self ) -> dict : # pylint: disable=invalid-name \"\"\"Get the message callback address information currently set \\ (https://open.imoulife.com/book/http/push/getMessageCallback.html).\"\"\" # define the api endpoint api = \"getMessageCallback\" # prepare the payload payload : dict = {} # call the api return await self . _async_call_api ( api , payload ) async def async_api_setMessageCallbackOn ( self , callback_url : str ) -> dict : # pylint: disable=invalid-name \"\"\"Set the message callback address. \\ (https://open.imoulife.com/book/http/push/setMessageCallback.html).\"\"\" # define the api endpoint api = \"setMessageCallback\" # prepare the payload payload = { \"callbackFlag\" : \"alarm,deviceStatus\" , # \"basePush\": \"2\", \"callbackUrl\" : callback_url , \"status\" : \"on\" , } # call the api return await self . _async_call_api ( api , payload ) async def async_api_setMessageCallbackOff ( self ) -> dict : # pylint: disable=invalid-name \"\"\"Unset the message callback address. \\ (https://open.imoulife.com/book/http/push/setMessageCallback.html).\"\"\" # define the api endpoint api = \"setMessageCallback\" # prepare the payload payload = { \"status\" : \"off\" , } # call the api return await self . _async_call_api ( api , payload ) async def async_api_restartDevice ( self , device_id : str ) -> dict : # pylint: disable=invalid-name \"\"\"Restart the device. \\ (https://open.imoulife.com/book/en/http/device/operate/restartDevice.html).\"\"\" # define the api endpoint api = \"restartDevice\" # prepare the payload payload = { \"deviceId\" : device_id , } # call the api return await self . _async_call_api ( api , payload ) async def async_api_deviceSdcardStatus ( self , device_id : str ) -> dict : # pylint: disable=invalid-name \"\"\"Get the SD card status of the device.. \\ (https://open.imoulife.com/book/en/http/device/config/storage/deviceSdcardStatus.html).\"\"\" # define the api endpoint api = \"deviceSdcardStatus\" # prepare the payload payload = { \"deviceId\" : device_id , } # call the api return await self . _async_call_api ( api , payload )","title":"ImouAPIClient"},{"location":"modules/api/#imouapi.api.ImouAPIClient.__init__","text":"Initialize the instance. Parameters: Name Type Description Default app_id str appID from https://open.imoulife.com/consoleNew/myApp/appInfo required app_secret str appID from https://open.imoulife.com/consoleNew/myApp/appInfo required session ClientSession aiohttp client session required Source code in imouapi/api.py 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 def __init__ ( self , app_id : str , app_secret : str , session : ClientSession ) -> None : \"\"\" Initialize the instance. Parameters: app_id: appID from https://open.imoulife.com/consoleNew/myApp/appInfo app_secret: appID from https://open.imoulife.com/consoleNew/myApp/appInfo session: aiohttp client session \"\"\" self . _app_id = app_id self . _app_secret = app_secret self . _session = session self . _base_url = API_URL self . _timeout = DEFAULT_TIMEOUT self . _log_http_requests_enabled = False self . _redact_log_message_enabled = True self . _access_token = None self . _access_token_expire_time = None self . _connected = False self . _retries = 1 _LOGGER . debug ( \"Initialized. Endpoint URL: %s \" , self . _base_url )","title":"__init__()"},{"location":"modules/api/#imouapi.api.ImouAPIClient.async_api_deviceBaseDetailList","text":"Return the details of the requested devices (https://open.imoulife.com/book/http/device/manage/query/deviceBaseDetailList.html). Source code in imouapi/api.py 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 async def async_api_deviceBaseDetailList ( self , devices : list [ str ]) -> dict : # pylint: disable=invalid-name \"\"\"Return the details of the requested devices \\ (https://open.imoulife.com/book/http/device/manage/query/deviceBaseDetailList.html).\"\"\" # define the api endpoint api = \"deviceBaseDetailList\" # prepare the payload device_list = [] for device in devices : device_list . append ( { \"deviceId\" : device , \"channelList\" : \"0\" , } ) payload = { \"deviceList\" : device_list } # call the api return await self . _async_call_api ( api , payload )","title":"async_api_deviceBaseDetailList()"},{"location":"modules/api/#imouapi.api.ImouAPIClient.async_api_deviceBaseList","text":"Return the list of registered devices (https://open.imoulife.com/book/http/device/manage/query/deviceBaseList.html). Source code in imouapi/api.py 218 219 220 221 222 223 224 225 226 227 228 229 230 231 async def async_api_deviceBaseList ( self ) -> dict : # pylint: disable=invalid-name \"\"\"Return the list of registered devices \\ (https://open.imoulife.com/book/http/device/manage/query/deviceBaseList.html).\"\"\" # define the api endpoint api = \"deviceBaseList\" # prepare the payload payload = { \"bindId\" : - 1 , \"limit\" : 50 , \"type\" : \"bindAndShare\" , \"needApInfo\" : True , } # call the api return await self . _async_call_api ( api , payload )","title":"async_api_deviceBaseList()"},{"location":"modules/api/#imouapi.api.ImouAPIClient.async_api_deviceOnline","text":"Device online or offline (https://open.imoulife.com/book/http/device/manage/query/deviceOnline.html). Source code in imouapi/api.py 302 303 304 305 306 307 308 309 310 311 312 async def async_api_deviceOnline ( self , device_id : str ) -> dict : # pylint: disable=invalid-name \"\"\"Device online or offline \\ (https://open.imoulife.com/book/http/device/manage/query/deviceOnline.html).\"\"\" # define the api endpoint api = \"deviceOnline\" # prepare the payload payload = { \"deviceId\" : device_id , } # call the api return await self . _async_call_api ( api , payload )","title":"async_api_deviceOnline()"},{"location":"modules/api/#imouapi.api.ImouAPIClient.async_api_deviceOpenDetailList","text":"Return the details of the requested devices (Open) (https://open.imoulife.com/book/http/device/manage/query/deviceOpenDetailList.html). Source code in imouapi/api.py 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 async def async_api_deviceOpenDetailList ( self , devices : list [ str ]) -> dict : # pylint: disable=invalid-name \"\"\"Return the details of the requested devices (Open) \\ (https://open.imoulife.com/book/http/device/manage/query/deviceOpenDetailList.html).\"\"\" # define the api endpoint api = \"deviceOpenDetailList\" # prepare the payload device_list = [] for device in devices : device_list . append ( { \"deviceId\" : device , \"channelList\" : \"0\" , } ) payload = { \"deviceList\" : device_list } # call the api return await self . _async_call_api ( api , payload )","title":"async_api_deviceOpenDetailList()"},{"location":"modules/api/#imouapi.api.ImouAPIClient.async_api_deviceOpenList","text":"Return the list of registered devices (Open) (https://open.imoulife.com/book/http/device/manage/query/deviceOpenList.html). Source code in imouapi/api.py 233 234 235 236 237 238 239 240 241 242 243 244 245 246 async def async_api_deviceOpenList ( self ) -> dict : # pylint: disable=invalid-name \"\"\"Return the list of registered devices (Open) \\ (https://open.imoulife.com/book/http/device/manage/query/deviceOpenList.html).\"\"\" # define the api endpoint api = \"deviceOpenList\" # prepare the payload payload = { \"bindId\" : - 1 , \"limit\" : 50 , \"type\" : \"bindAndShare\" , \"needApInfo\" : True , } # call the api return await self . _async_call_api ( api , payload )","title":"async_api_deviceOpenList()"},{"location":"modules/api/#imouapi.api.ImouAPIClient.async_api_deviceSdcardStatus","text":"Get the SD card status of the device.. (https://open.imoulife.com/book/en/http/device/config/storage/deviceSdcardStatus.html). Source code in imouapi/api.py 452 453 454 455 456 457 458 459 460 461 462 async def async_api_deviceSdcardStatus ( self , device_id : str ) -> dict : # pylint: disable=invalid-name \"\"\"Get the SD card status of the device.. \\ (https://open.imoulife.com/book/en/http/device/config/storage/deviceSdcardStatus.html).\"\"\" # define the api endpoint api = \"deviceSdcardStatus\" # prepare the payload payload = { \"deviceId\" : device_id , } # call the api return await self . _async_call_api ( api , payload )","title":"async_api_deviceSdcardStatus()"},{"location":"modules/api/#imouapi.api.ImouAPIClient.async_api_deviceStorage","text":"Obtain device storage medium capacity information. (https://open.imoulife.com/book/http/device/config/storage/deviceStorage.html). Source code in imouapi/api.py 314 315 316 317 318 319 320 321 322 323 324 async def async_api_deviceStorage ( self , device_id : str ) -> dict : # pylint: disable=invalid-name \"\"\"Obtain device storage medium capacity information. \\ (https://open.imoulife.com/book/http/device/config/storage/deviceStorage.html).\"\"\" # define the api endpoint api = \"deviceStorage\" # prepare the payload payload = { \"deviceId\" : device_id , } # call the api return await self . _async_call_api ( api , payload )","title":"async_api_deviceStorage()"},{"location":"modules/api/#imouapi.api.ImouAPIClient.async_api_getAlarmMessage","text":"Get the device message list of the device channel in the specified time period (https://open.imoulife.com/book/http/device/alarm/getAlarmMessage.html). Source code in imouapi/api.py 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 async def async_api_getAlarmMessage ( self , device_id : str ) -> dict : # pylint: disable=invalid-name \"\"\"Get the device message list of the device channel in the specified time period \\ (https://open.imoulife.com/book/http/device/alarm/getAlarmMessage.html).\"\"\" # define the api endpoint api = \"getAlarmMessage\" # prepare the payload now_time = datetime . now () begin_time = now_time - timedelta ( days = 30 ) end_time = now_time + timedelta ( days = 1 ) payload = { \"deviceId\" : device_id , \"count\" : \"10\" , \"channelId\" : \"0\" , \"beginTime\" : begin_time . strftime ( \"%Y-%m- %d %H:%M:%S\" ), \"endTime\" : end_time . strftime ( \"%Y-%m- %d %H:%M:%S\" ), } # call the api return await self . _async_call_api ( api , payload )","title":"async_api_getAlarmMessage()"},{"location":"modules/api/#imouapi.api.ImouAPIClient.async_api_getDeviceCameraStatus","text":"Get the status of the device switch (https://open.imoulife.com/book/http/device/config/ability/getDeviceCameraStatus.html). Source code in imouapi/api.py 326 327 328 329 330 331 332 333 334 335 336 337 338 339 async def async_api_getDeviceCameraStatus ( # pylint: disable=invalid-name self , device_id : str , enable_type : str ) -> dict : \"\"\"Get the status of the device switch \\ (https://open.imoulife.com/book/http/device/config/ability/getDeviceCameraStatus.html).\"\"\" # define the api endpoint api = \"getDeviceCameraStatus\" # prepare the payload payload = { \"deviceId\" : device_id , \"enableType\" : enable_type , } # call the api return await self . _async_call_api ( api , payload )","title":"async_api_getDeviceCameraStatus()"},{"location":"modules/api/#imouapi.api.ImouAPIClient.async_api_getMessageCallback","text":"Get the message callback address information currently set (https://open.imoulife.com/book/http/push/getMessageCallback.html). Source code in imouapi/api.py 403 404 405 406 407 408 409 410 411 async def async_api_getMessageCallback ( self ) -> dict : # pylint: disable=invalid-name \"\"\"Get the message callback address information currently set \\ (https://open.imoulife.com/book/http/push/getMessageCallback.html).\"\"\" # define the api endpoint api = \"getMessageCallback\" # prepare the payload payload : dict = {} # call the api return await self . _async_call_api ( api , payload )","title":"async_api_getMessageCallback()"},{"location":"modules/api/#imouapi.api.ImouAPIClient.async_api_getNightVisionMode","text":"Query the night vision mode configuration of the device (https://open.imoulife.com/book/http/device/config/video/getNightVisionMode.html). Source code in imouapi/api.py 376 377 378 379 380 381 382 383 384 385 386 387 async def async_api_getNightVisionMode ( self , device_id : str ) -> dict : # pylint: disable=invalid-name \"\"\"Query the night vision mode configuration of the device \\ (https://open.imoulife.com/book/http/device/config/video/getNightVisionMode.html).\"\"\" # define the api endpoint api = \"getNightVisionMode\" # prepare the payload payload = { \"deviceId\" : device_id , \"channelId\" : \"0\" , } # call the api return await self . _async_call_api ( api , payload )","title":"async_api_getNightVisionMode()"},{"location":"modules/api/#imouapi.api.ImouAPIClient.async_api_listDeviceAbility","text":"Ability to obtain multiple devices, channels, and accessories in batches (https://open.imoulife.com/book/http/device/manage/query/listDeviceAbility.html). Source code in imouapi/api.py 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 async def async_api_listDeviceAbility ( self , devices : list [ str ]) -> dict : # pylint: disable=invalid-name \"\"\"Ability to obtain multiple devices, channels, and accessories in batches \\ (https://open.imoulife.com/book/http/device/manage/query/listDeviceAbility.html).\"\"\" # define the api endpoint api = \"listDeviceAbility\" # prepare the payload device_list = [] for device in devices : device_list . append ( { \"deviceId\" : device , \"channelList\" : \"0\" , } ) payload = { \"deviceList\" : device_list } # call the api return await self . _async_call_api ( api , payload )","title":"async_api_listDeviceAbility()"},{"location":"modules/api/#imouapi.api.ImouAPIClient.async_api_restartDevice","text":"Restart the device. (https://open.imoulife.com/book/en/http/device/operate/restartDevice.html). Source code in imouapi/api.py 440 441 442 443 444 445 446 447 448 449 450 async def async_api_restartDevice ( self , device_id : str ) -> dict : # pylint: disable=invalid-name \"\"\"Restart the device. \\ (https://open.imoulife.com/book/en/http/device/operate/restartDevice.html).\"\"\" # define the api endpoint api = \"restartDevice\" # prepare the payload payload = { \"deviceId\" : device_id , } # call the api return await self . _async_call_api ( api , payload )","title":"async_api_restartDevice()"},{"location":"modules/api/#imouapi.api.ImouAPIClient.async_api_setDeviceCameraStatus","text":"Set a device switch (https://open.imoulife.com/book/http/device/config/ability/setDeviceCameraStatus.html). Source code in imouapi/api.py 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 async def async_api_setDeviceCameraStatus ( # pylint: disable=invalid-name self , device_id : str , enable_type : str , value : bool ) -> dict : \"\"\"Set a device switch \\ (https://open.imoulife.com/book/http/device/config/ability/setDeviceCameraStatus.html).\"\"\" # define the api endpoint api = \"setDeviceCameraStatus\" # prepare the payload payload = { \"deviceId\" : device_id , \"enableType\" : enable_type , \"enable\" : value , } # call the api return await self . _async_call_api ( api , payload )","title":"async_api_setDeviceCameraStatus()"},{"location":"modules/api/#imouapi.api.ImouAPIClient.async_api_setMessageCallbackOff","text":"Unset the message callback address. (https://open.imoulife.com/book/http/push/setMessageCallback.html). Source code in imouapi/api.py 428 429 430 431 432 433 434 435 436 437 438 async def async_api_setMessageCallbackOff ( self ) -> dict : # pylint: disable=invalid-name \"\"\"Unset the message callback address. \\ (https://open.imoulife.com/book/http/push/setMessageCallback.html).\"\"\" # define the api endpoint api = \"setMessageCallback\" # prepare the payload payload = { \"status\" : \"off\" , } # call the api return await self . _async_call_api ( api , payload )","title":"async_api_setMessageCallbackOff()"},{"location":"modules/api/#imouapi.api.ImouAPIClient.async_api_setMessageCallbackOn","text":"Set the message callback address. (https://open.imoulife.com/book/http/push/setMessageCallback.html). Source code in imouapi/api.py 413 414 415 416 417 418 419 420 421 422 423 424 425 426 async def async_api_setMessageCallbackOn ( self , callback_url : str ) -> dict : # pylint: disable=invalid-name \"\"\"Set the message callback address. \\ (https://open.imoulife.com/book/http/push/setMessageCallback.html).\"\"\" # define the api endpoint api = \"setMessageCallback\" # prepare the payload payload = { \"callbackFlag\" : \"alarm,deviceStatus\" , # \"basePush\": \"2\", \"callbackUrl\" : callback_url , \"status\" : \"on\" , } # call the api return await self . _async_call_api ( api , payload )","title":"async_api_setMessageCallbackOn()"},{"location":"modules/api/#imouapi.api.ImouAPIClient.async_api_setNightVisionMode","text":"Set the night vision mode of the device (https://open.imoulife.com/book/http/device/config/video/setNightVisionMode.html). Source code in imouapi/api.py 389 390 391 392 393 394 395 396 397 398 399 400 401 async def async_api_setNightVisionMode ( self , device_id : str , mode : str ) -> dict : # pylint: disable=invalid-name \"\"\"Set the night vision mode of the device \\ (https://open.imoulife.com/book/http/device/config/video/setNightVisionMode.html).\"\"\" # define the api endpoint api = \"setNightVisionMode\" # prepare the payload payload = { \"deviceId\" : device_id , \"channelId\" : \"0\" , \"mode\" : mode , } # call the api return await self . _async_call_api ( api , payload )","title":"async_api_setNightVisionMode()"},{"location":"modules/api/#imouapi.api.ImouAPIClient.async_connect","text":"Authenticate against the API and retrieve an access token. Source code in imouapi/api.py 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 async def async_connect ( self ) -> bool : \"\"\"Authenticate against the API and retrieve an access token.\"\"\" # check if we already have an access token and if so assume already authenticated if self . is_connected (): return True # call the access token endpoint _LOGGER . debug ( \"Connecting\" ) data = await self . _async_call_api ( \"accessToken\" , {}, True ) if \"accessToken\" not in data or \"expireTime\" not in data : raise InvalidResponse ( f \"accessToken not found in { data } \" ) # store the access token self . _access_token = data [ \"accessToken\" ] self . _access_token_expire_time = data [ \"expireTime\" ] _LOGGER . debug ( \"Retrieved access token\" ) self . _connected = True return True","title":"async_connect()"},{"location":"modules/api/#imouapi.api.ImouAPIClient.async_disconnect","text":"Disconnect from the API. Source code in imouapi/api.py 114 115 116 117 118 119 120 async def async_disconnect ( self ) -> bool : \"\"\"Disconnect from the API.\"\"\" self . _access_token = None self . _access_token_expire_time = None self . _connected = False _LOGGER . debug ( \"Disconnected\" ) return True","title":"async_disconnect()"},{"location":"modules/api/#imouapi.api.ImouAPIClient.async_reconnect","text":"Reconnect to the API. Source code in imouapi/api.py 122 123 124 125 async def async_reconnect ( self ) -> bool : \"\"\"Reconnect to the API.\"\"\" await self . async_disconnect () return await self . async_connect ()","title":"async_reconnect()"},{"location":"modules/api/#imouapi.api.ImouAPIClient.get_base_url","text":"Get base url for the API. Source code in imouapi/api.py 67 68 69 def get_base_url ( self ) -> str : \"\"\"Get base url for the API.\"\"\" return self . _base_url","title":"get_base_url()"},{"location":"modules/api/#imouapi.api.ImouAPIClient.get_timeout","text":"Get timeout for the API. Source code in imouapi/api.py 76 77 78 def get_timeout ( self ) -> int : \"\"\"Get timeout for the API.\"\"\" return self . _timeout","title":"get_timeout()"},{"location":"modules/api/#imouapi.api.ImouAPIClient.is_connected","text":"Return true if already connected. Source code in imouapi/api.py 127 128 129 def is_connected ( self ) -> bool : \"\"\"Return true if already connected.\"\"\" return self . _connected","title":"is_connected()"},{"location":"modules/api/#imouapi.api.ImouAPIClient.set_base_url","text":"Set a custom base url for the API. Source code in imouapi/api.py 71 72 73 74 def set_base_url ( self , value : str ) -> None : \"\"\"Set a custom base url for the API.\"\"\" self . _base_url = value _LOGGER . debug ( \"Set endpoint URL to %s \" , self . _base_url )","title":"set_base_url()"},{"location":"modules/api/#imouapi.api.ImouAPIClient.set_log_http_requests","text":"Set to true if you want in debug logs also HTTP requests and responses. Source code in imouapi/api.py 89 90 91 def set_log_http_requests ( self , value : bool ) -> None : \"\"\"Set to true if you want in debug logs also HTTP requests and responses.\"\"\" self . _log_http_requests_enabled = value","title":"set_log_http_requests()"},{"location":"modules/api/#imouapi.api.ImouAPIClient.set_redact_log_messages","text":"Set to true if you want debug logs redacted from sensitive data. Source code in imouapi/api.py 93 94 95 def set_redact_log_messages ( self , value : bool ) -> None : \"\"\"Set to true if you want debug logs redacted from sensitive data.\"\"\" self . _redact_log_message_enabled = value","title":"set_redact_log_messages()"},{"location":"modules/api/#imouapi.api.ImouAPIClient.set_session","text":"Set an aiohttp client session. Source code in imouapi/api.py 85 86 87 def set_session ( self , value : ClientSession ) -> None : \"\"\"Set an aiohttp client session.\"\"\" self . _session = value","title":"set_session()"},{"location":"modules/api/#imouapi.api.ImouAPIClient.set_timeout","text":"Set a custom timeout. Source code in imouapi/api.py 80 81 82 83 def set_timeout ( self , value : int ) -> None : \"\"\"Set a custom timeout.\"\"\" self . _timeout = value _LOGGER . debug ( \"Set timeout to %s \" , self . _base_url )","title":"set_timeout()"},{"location":"modules/device/","text":"High level API to discover and interacting with Imou devices and their sensors. ImouDevice \u00b6 A representation of an IMOU Device. Source code in imouapi/device.py 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 class ImouDevice : \"\"\"A representation of an IMOU Device.\"\"\" def __init__ ( self , api_client : ImouAPIClient , device_id : str , ) -> None : \"\"\" Initialize the instance. Parameters: api_client: an ImouAPIClient instance device_id: device id \"\"\" self . _api_client = api_client self . _device_id = device_id self . _catalog = \"N.A.\" self . _firmware = \"N.A.\" self . _name = \"N.A.\" self . _given_name = \"\" self . _device_model = \"N.A.\" self . _manufacturer = \"Imou\" self . _online = False self . _capabilities : list [ str ] = [] self . _switches : list [ str ] = [] self . _sensor_instances : dict [ str , list ] = { \"switch\" : [], \"sensor\" : [], \"binary_sensor\" : [], \"select\" : [], \"button\" : [], } self . _initialized = False self . _enabled = True def get_device_id ( self ) -> str : \"\"\"Get device id.\"\"\" return self . _device_id def get_name ( self ) -> str : \"\"\"Get device name.\"\"\" if self . _given_name != \"\" : return self . _given_name return self . _name def set_name ( self , given_name : str ) -> None : \"\"\"Set device name.\"\"\" self . _given_name = given_name def get_model ( self ) -> str : \"\"\"Get model.\"\"\" return self . _device_model def get_manufacturer ( self ) -> str : \"\"\"Get manufacturer.\"\"\" return self . _manufacturer def get_firmware ( self ) -> str : \"\"\"Get firmware.\"\"\" return self . _firmware def is_online ( self ) -> bool : \"\"\"Get online.\"\"\" return self . _online def get_all_sensors ( self ) -> list [ ImouEntity ]: \"\"\"Get all the sensor instances.\"\"\" sensors = [] for ( platform , # pylint: disable=unused-variable sensor_instances_array , ) in self . _sensor_instances . items (): for sensor_instance in sensor_instances_array : sensors . append ( sensor_instance ) return sensors def get_sensors_by_platform ( self , platform : str ) -> list [ ImouEntity ]: \"\"\"Get sensor instances associated to a given platform.\"\"\" if platform not in self . _sensor_instances : return [] return self . _sensor_instances [ platform ] def get_sensor_by_name ( self , name : str ) -> Union [ ImouSensor , ImouBinarySensor , ImouSwitch , ImouSelect , ImouButton , None ]: \"\"\"Get sensor instance with a given name.\"\"\" for ( platform , # pylint: disable=unused-variable sensor_instances_array , ) in self . _sensor_instances . items (): for sensor_instance in sensor_instances_array : if sensor_instance . get_name () == name : return sensor_instance return None def set_enabled ( self , value : bool ) -> None : \"\"\"Set enable.\"\"\" self . _enabled = value def is_enabled ( self ) -> bool : \"\"\"Is enabled.\"\"\" return self . _enabled async def async_initialize ( self ) -> None : \"\"\"Initialize the instance by retrieving the device details and associated sensors.\"\"\" # get the details for this device from the API device_array = await self . _api_client . async_api_deviceBaseDetailList ([ self . _device_id ]) if \"deviceList\" not in device_array or len ( device_array [ \"deviceList\" ]) != 1 : raise InvalidResponse ( f \"deviceList not found in { str ( device_array ) } \" ) # reponse is an array, our data is in the first element device_data = device_array [ \"deviceList\" ][ 0 ] try : # get device details self . _catalog = device_data [ \"catalog\" ] self . _firmware = device_data [ \"version\" ] self . _name = device_data [ \"name\" ] self . _device_model = device_data [ \"deviceModel\" ] self . _online = device_data [ \"status\" ] == \"online\" # get device capabilities self . _capabilities = device_data [ \"ability\" ] . split ( \",\" ) # Add undocumented capabilities or capabilities inherited from other capabilities if \"AlarmMD\" in self . _capabilities : self . _capabilities . append ( \"MotionDetect\" ) if \"WLM\" in self . _capabilities : self . _capabilities . append ( \"Linkagewhitelight\" ) if \"WLAN\" in self . _capabilities : self . _capabilities . append ( \"pushNotifications\" ) switches_keys = IMOU_SWITCHES . keys () # add switches. For each possible switch, check if there is a capability with the same name \\ # (ref. https://open.imoulife.com/book/en/faq/feature.html) for switch_type in switches_keys : for capability in self . _capabilities : capability = capability . lower () capability = re . sub ( \"v \\\\ d$\" , '' , capability ) if switch_type . lower () == capability and switch_type . lower () not in self . _switches : self . _switches . append ( switch_type ) # create an instance and save it switch_instance = ImouSwitch ( self . _api_client , self . _device_id , self . get_name (), switch_type , ) self . _sensor_instances [ \"switch\" ] . append ( switch_instance ) break # add lastAlarm sensor if \"AlarmMD\" in self . _capabilities : self . _sensor_instances [ \"sensor\" ] . append ( ImouSensor ( self . _api_client , self . _device_id , self . get_name (), \"lastAlarm\" , ) ) # add storageUsed sensor if \"LocalStorage\" in self . _capabilities : self . _sensor_instances [ \"sensor\" ] . append ( ImouSensor ( self . _api_client , self . _device_id , self . get_name (), \"storageUsed\" , ) ) # add callbackUrl sensor self . _sensor_instances [ \"sensor\" ] . append ( ImouSensor ( self . _api_client , self . _device_id , self . get_name (), \"callbackUrl\" , ) ) # add online binary sensor if \"WLAN\" in self . _capabilities : self . _sensor_instances [ \"binary_sensor\" ] . append ( ImouBinarySensor ( self . _api_client , self . _device_id , self . get_name (), \"online\" , ) ) # add nightVisionMode select if \"NVM\" in self . _capabilities : self . _sensor_instances [ \"select\" ] . append ( ImouSelect ( self . _api_client , self . _device_id , self . get_name (), \"nightVisionMode\" , ) ) # add restartDevice button self . _sensor_instances [ \"button\" ] . append ( ImouButton ( self . _api_client , self . _device_id , self . get_name (), \"restartDevice\" , ) ) # add refreshData button self . _sensor_instances [ \"button\" ] . append ( ImouButton ( self . _api_client , self . _device_id , self . get_name (), \"refreshData\" , ) ) except Exception as exception : raise InvalidResponse ( f \" missing parameter or error parsing in { device_data } \" ) from exception _LOGGER . debug ( \"Retrieved device %s \" , self . to_string ()) _LOGGER . debug ( \"Device details: \\n %s \" , self . dump ()) # keep track that we have already asked for the device details self . _initialized = True async def async_get_data ( self ) -> bool : \"\"\"Update device properties and its sensors.\"\"\" if not self . _enabled : return False if not self . _initialized : # get the details of the device first await self . async_initialize () # check if the device is online _LOGGER . debug ( \"[ %s ] update requested\" , self . get_name ()) data = await self . _api_client . async_api_deviceOnline ( self . _device_id ) if \"onLine\" not in data : raise InvalidResponse ( f \"onLine not found in { data } \" ) self . _online = data [ \"onLine\" ] == \"1\" # update the status of all the sensors (if the device is online) if self . _online : for ( platform , # pylint: disable=unused-variable sensor_instances_array , ) in self . _sensor_instances . items (): for sensor_instance in sensor_instances_array : await sensor_instance . async_update () return True def to_string ( self ) -> str : \"\"\"Return the object as a string.\"\"\" return f \" { self . _name } ( { self . _device_model } , serial { self . _device_id } )\" def get_diagnostics ( self ) -> dict [ str , Any ]: \"\"\"Return diagnostics for the device.\"\"\" online = \"yes\" if self . _online else \"no\" # prepare capabilities capabilities = [] for capability_name in self . _capabilities : capability = {} description = ( f \" { IMOU_CAPABILITIES [ capability_name ] } ( { capability_name } )\" if capability_name in IMOU_CAPABILITIES else capability_name ) capability [ \"name\" ] = capability_name capability [ \"description\" ] = description capabilities . append ( capability ) # prepare switches switches = [] for sensor_instance in self . _sensor_instances [ \"switch\" ]: sensor = {} sensor_name = sensor_instance . get_name () description = ( f \" { IMOU_SWITCHES [ sensor_name ] } ( { sensor_name } )\" if sensor_name in IMOU_SWITCHES else sensor_name ) sensor [ \"name\" ] = sensor_name sensor [ \"description\" ] = description sensor [ \"state\" ] = sensor_instance . is_on () sensor [ \"is_enabled\" ] = sensor_instance . is_enabled () sensor [ \"is_updated\" ] = sensor_instance . is_updated () switches . append ( sensor ) # prepare sensors sensors = [] for sensor_instance in self . _sensor_instances [ \"sensor\" ]: sensor = {} sensor_name = sensor_instance . get_name () description = f \" { SENSORS [ sensor_name ] } ( { sensor_name } )\" sensor [ \"name\" ] = sensor_name sensor [ \"description\" ] = description sensor [ \"state\" ] = sensor_instance . get_state () sensor [ \"is_enabled\" ] = sensor_instance . is_enabled () sensor [ \"is_updated\" ] = sensor_instance . is_updated () sensors . append ( sensor ) # prepare binary sensors binary_sensors = [] for sensor_instance in self . _sensor_instances [ \"binary_sensor\" ]: sensor = {} sensor_name = sensor_instance . get_name () description = f \" { BINARY_SENSORS [ sensor_name ] } ( { sensor_name } )\" sensor [ \"name\" ] = sensor_name sensor [ \"description\" ] = description sensor [ \"state\" ] = sensor_instance . is_on () sensor [ \"is_enabled\" ] = sensor_instance . is_enabled () sensor [ \"is_updated\" ] = sensor_instance . is_updated () binary_sensors . append ( sensor ) # prepare select selects = [] for sensor_instance in self . _sensor_instances [ \"select\" ]: sensor = {} sensor_name = sensor_instance . get_name () description = f \" { SELECT [ sensor_name ] } ( { sensor_name } )\" sensor [ \"name\" ] = sensor_name sensor [ \"description\" ] = description sensor [ \"current_option\" ] = sensor_instance . get_current_option () sensor [ \"available_options\" ] = sensor_instance . get_available_options () sensor [ \"is_enabled\" ] = sensor_instance . is_enabled () sensor [ \"is_updated\" ] = sensor_instance . is_updated () selects . append ( sensor ) # prepare button buttons = [] for sensor_instance in self . _sensor_instances [ \"button\" ]: sensor = {} sensor_name = sensor_instance . get_name () description = f \" { BUTTONS [ sensor_name ] } ( { sensor_name } )\" sensor [ \"name\" ] = sensor_name sensor [ \"description\" ] = description sensor [ \"is_enabled\" ] = sensor_instance . is_enabled () sensor [ \"is_updated\" ] = sensor_instance . is_updated () buttons . append ( sensor ) # prepare data structure to return data : dict [ str , Any ] = { \"api\" : { \"base_url\" : self . _api_client . get_base_url (), \"timeout\" : self . _api_client . get_timeout (), \"is_connected\" : self . _api_client . is_connected (), }, \"device\" : { \"device_id\" : self . _device_id , \"name\" : self . _name , \"catalog\" : self . _catalog , \"given_name\" : self . _given_name , \"model\" : self . _device_model , \"firmware\" : self . _firmware , \"manufacturer\" : self . _manufacturer , \"online\" : online , }, \"capabilities\" : capabilities , \"switches\" : switches , \"sensors\" : sensors , \"binary_sensors\" : binary_sensors , \"selects\" : selects , \"buttons\" : buttons , } return data def dump ( self ) -> str : \"\"\"Return the full description of the object and its attributes.\"\"\" data = self . get_diagnostics () dump = ( f \"- Device ID: { data [ 'device' ][ 'device_id' ] } \\n \" + f \" Name: { data [ 'device' ][ 'name' ] } \\n \" + f \" Catalog: { data [ 'device' ][ 'catalog' ] } \\n \" + f \" Model: { data [ 'device' ][ 'model' ] } \\n \" + f \" Firmware: { data [ 'device' ][ 'firmware' ] } \\n \" + f \" Online: { data [ 'device' ][ 'online' ] } \\n \" ) dump = dump + \" Capabilities: \\n \" for capability in data [ 'capabilities' ]: dump = dump + f \" - { capability [ 'description' ] } \\n \" dump = dump + \" Switches: \\n \" for switch in data [ 'switches' ]: dump = dump + f \" - { switch [ 'description' ] } : { switch [ 'state' ] } \\n \" dump = dump + \" Sensors: \\n \" for sensor in data [ 'sensors' ]: dump = dump + f \" - { sensor [ 'description' ] } : { sensor [ 'state' ] } \\n \" dump = dump + \" Binary Sensors: \\n \" for binary_sensor in data [ 'binary_sensors' ]: dump = dump + f \" - { binary_sensor [ 'description' ] } : { binary_sensor [ 'state' ] } \\n \" dump = dump + \" Select: \\n \" for select in data [ 'selects' ]: dump = dump + f \" - { select [ 'description' ] } : { select [ 'current_option' ] } \\n \" dump = dump + \" Buttons: \\n \" for button in data [ 'buttons' ]: dump = dump + f \" - { button [ 'description' ] } \\n \" return dump __init__ ( api_client , device_id ) \u00b6 Initialize the instance. Parameters: Name Type Description Default api_client ImouAPIClient an ImouAPIClient instance required device_id str device id required Source code in imouapi/device.py 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 def __init__ ( self , api_client : ImouAPIClient , device_id : str , ) -> None : \"\"\" Initialize the instance. Parameters: api_client: an ImouAPIClient instance device_id: device id \"\"\" self . _api_client = api_client self . _device_id = device_id self . _catalog = \"N.A.\" self . _firmware = \"N.A.\" self . _name = \"N.A.\" self . _given_name = \"\" self . _device_model = \"N.A.\" self . _manufacturer = \"Imou\" self . _online = False self . _capabilities : list [ str ] = [] self . _switches : list [ str ] = [] self . _sensor_instances : dict [ str , list ] = { \"switch\" : [], \"sensor\" : [], \"binary_sensor\" : [], \"select\" : [], \"button\" : [], } self . _initialized = False self . _enabled = True async_get_data () async \u00b6 Update device properties and its sensors. Source code in imouapi/device.py 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 async def async_get_data ( self ) -> bool : \"\"\"Update device properties and its sensors.\"\"\" if not self . _enabled : return False if not self . _initialized : # get the details of the device first await self . async_initialize () # check if the device is online _LOGGER . debug ( \"[ %s ] update requested\" , self . get_name ()) data = await self . _api_client . async_api_deviceOnline ( self . _device_id ) if \"onLine\" not in data : raise InvalidResponse ( f \"onLine not found in { data } \" ) self . _online = data [ \"onLine\" ] == \"1\" # update the status of all the sensors (if the device is online) if self . _online : for ( platform , # pylint: disable=unused-variable sensor_instances_array , ) in self . _sensor_instances . items (): for sensor_instance in sensor_instances_array : await sensor_instance . async_update () return True async_initialize () async \u00b6 Initialize the instance by retrieving the device details and associated sensors. Source code in imouapi/device.py 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 async def async_initialize ( self ) -> None : \"\"\"Initialize the instance by retrieving the device details and associated sensors.\"\"\" # get the details for this device from the API device_array = await self . _api_client . async_api_deviceBaseDetailList ([ self . _device_id ]) if \"deviceList\" not in device_array or len ( device_array [ \"deviceList\" ]) != 1 : raise InvalidResponse ( f \"deviceList not found in { str ( device_array ) } \" ) # reponse is an array, our data is in the first element device_data = device_array [ \"deviceList\" ][ 0 ] try : # get device details self . _catalog = device_data [ \"catalog\" ] self . _firmware = device_data [ \"version\" ] self . _name = device_data [ \"name\" ] self . _device_model = device_data [ \"deviceModel\" ] self . _online = device_data [ \"status\" ] == \"online\" # get device capabilities self . _capabilities = device_data [ \"ability\" ] . split ( \",\" ) # Add undocumented capabilities or capabilities inherited from other capabilities if \"AlarmMD\" in self . _capabilities : self . _capabilities . append ( \"MotionDetect\" ) if \"WLM\" in self . _capabilities : self . _capabilities . append ( \"Linkagewhitelight\" ) if \"WLAN\" in self . _capabilities : self . _capabilities . append ( \"pushNotifications\" ) switches_keys = IMOU_SWITCHES . keys () # add switches. For each possible switch, check if there is a capability with the same name \\ # (ref. https://open.imoulife.com/book/en/faq/feature.html) for switch_type in switches_keys : for capability in self . _capabilities : capability = capability . lower () capability = re . sub ( \"v \\\\ d$\" , '' , capability ) if switch_type . lower () == capability and switch_type . lower () not in self . _switches : self . _switches . append ( switch_type ) # create an instance and save it switch_instance = ImouSwitch ( self . _api_client , self . _device_id , self . get_name (), switch_type , ) self . _sensor_instances [ \"switch\" ] . append ( switch_instance ) break # add lastAlarm sensor if \"AlarmMD\" in self . _capabilities : self . _sensor_instances [ \"sensor\" ] . append ( ImouSensor ( self . _api_client , self . _device_id , self . get_name (), \"lastAlarm\" , ) ) # add storageUsed sensor if \"LocalStorage\" in self . _capabilities : self . _sensor_instances [ \"sensor\" ] . append ( ImouSensor ( self . _api_client , self . _device_id , self . get_name (), \"storageUsed\" , ) ) # add callbackUrl sensor self . _sensor_instances [ \"sensor\" ] . append ( ImouSensor ( self . _api_client , self . _device_id , self . get_name (), \"callbackUrl\" , ) ) # add online binary sensor if \"WLAN\" in self . _capabilities : self . _sensor_instances [ \"binary_sensor\" ] . append ( ImouBinarySensor ( self . _api_client , self . _device_id , self . get_name (), \"online\" , ) ) # add nightVisionMode select if \"NVM\" in self . _capabilities : self . _sensor_instances [ \"select\" ] . append ( ImouSelect ( self . _api_client , self . _device_id , self . get_name (), \"nightVisionMode\" , ) ) # add restartDevice button self . _sensor_instances [ \"button\" ] . append ( ImouButton ( self . _api_client , self . _device_id , self . get_name (), \"restartDevice\" , ) ) # add refreshData button self . _sensor_instances [ \"button\" ] . append ( ImouButton ( self . _api_client , self . _device_id , self . get_name (), \"refreshData\" , ) ) except Exception as exception : raise InvalidResponse ( f \" missing parameter or error parsing in { device_data } \" ) from exception _LOGGER . debug ( \"Retrieved device %s \" , self . to_string ()) _LOGGER . debug ( \"Device details: \\n %s \" , self . dump ()) # keep track that we have already asked for the device details self . _initialized = True dump () \u00b6 Return the full description of the object and its attributes. Source code in imouapi/device.py 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 def dump ( self ) -> str : \"\"\"Return the full description of the object and its attributes.\"\"\" data = self . get_diagnostics () dump = ( f \"- Device ID: { data [ 'device' ][ 'device_id' ] } \\n \" + f \" Name: { data [ 'device' ][ 'name' ] } \\n \" + f \" Catalog: { data [ 'device' ][ 'catalog' ] } \\n \" + f \" Model: { data [ 'device' ][ 'model' ] } \\n \" + f \" Firmware: { data [ 'device' ][ 'firmware' ] } \\n \" + f \" Online: { data [ 'device' ][ 'online' ] } \\n \" ) dump = dump + \" Capabilities: \\n \" for capability in data [ 'capabilities' ]: dump = dump + f \" - { capability [ 'description' ] } \\n \" dump = dump + \" Switches: \\n \" for switch in data [ 'switches' ]: dump = dump + f \" - { switch [ 'description' ] } : { switch [ 'state' ] } \\n \" dump = dump + \" Sensors: \\n \" for sensor in data [ 'sensors' ]: dump = dump + f \" - { sensor [ 'description' ] } : { sensor [ 'state' ] } \\n \" dump = dump + \" Binary Sensors: \\n \" for binary_sensor in data [ 'binary_sensors' ]: dump = dump + f \" - { binary_sensor [ 'description' ] } : { binary_sensor [ 'state' ] } \\n \" dump = dump + \" Select: \\n \" for select in data [ 'selects' ]: dump = dump + f \" - { select [ 'description' ] } : { select [ 'current_option' ] } \\n \" dump = dump + \" Buttons: \\n \" for button in data [ 'buttons' ]: dump = dump + f \" - { button [ 'description' ] } \\n \" return dump get_all_sensors () \u00b6 Get all the sensor instances. Source code in imouapi/device.py 82 83 84 85 86 87 88 89 90 91 def get_all_sensors ( self ) -> list [ ImouEntity ]: \"\"\"Get all the sensor instances.\"\"\" sensors = [] for ( platform , # pylint: disable=unused-variable sensor_instances_array , ) in self . _sensor_instances . items (): for sensor_instance in sensor_instances_array : sensors . append ( sensor_instance ) return sensors get_device_id () \u00b6 Get device id. Source code in imouapi/device.py 52 53 54 def get_device_id ( self ) -> str : \"\"\"Get device id.\"\"\" return self . _device_id get_diagnostics () \u00b6 Return diagnostics for the device. Source code in imouapi/device.py 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 def get_diagnostics ( self ) -> dict [ str , Any ]: \"\"\"Return diagnostics for the device.\"\"\" online = \"yes\" if self . _online else \"no\" # prepare capabilities capabilities = [] for capability_name in self . _capabilities : capability = {} description = ( f \" { IMOU_CAPABILITIES [ capability_name ] } ( { capability_name } )\" if capability_name in IMOU_CAPABILITIES else capability_name ) capability [ \"name\" ] = capability_name capability [ \"description\" ] = description capabilities . append ( capability ) # prepare switches switches = [] for sensor_instance in self . _sensor_instances [ \"switch\" ]: sensor = {} sensor_name = sensor_instance . get_name () description = ( f \" { IMOU_SWITCHES [ sensor_name ] } ( { sensor_name } )\" if sensor_name in IMOU_SWITCHES else sensor_name ) sensor [ \"name\" ] = sensor_name sensor [ \"description\" ] = description sensor [ \"state\" ] = sensor_instance . is_on () sensor [ \"is_enabled\" ] = sensor_instance . is_enabled () sensor [ \"is_updated\" ] = sensor_instance . is_updated () switches . append ( sensor ) # prepare sensors sensors = [] for sensor_instance in self . _sensor_instances [ \"sensor\" ]: sensor = {} sensor_name = sensor_instance . get_name () description = f \" { SENSORS [ sensor_name ] } ( { sensor_name } )\" sensor [ \"name\" ] = sensor_name sensor [ \"description\" ] = description sensor [ \"state\" ] = sensor_instance . get_state () sensor [ \"is_enabled\" ] = sensor_instance . is_enabled () sensor [ \"is_updated\" ] = sensor_instance . is_updated () sensors . append ( sensor ) # prepare binary sensors binary_sensors = [] for sensor_instance in self . _sensor_instances [ \"binary_sensor\" ]: sensor = {} sensor_name = sensor_instance . get_name () description = f \" { BINARY_SENSORS [ sensor_name ] } ( { sensor_name } )\" sensor [ \"name\" ] = sensor_name sensor [ \"description\" ] = description sensor [ \"state\" ] = sensor_instance . is_on () sensor [ \"is_enabled\" ] = sensor_instance . is_enabled () sensor [ \"is_updated\" ] = sensor_instance . is_updated () binary_sensors . append ( sensor ) # prepare select selects = [] for sensor_instance in self . _sensor_instances [ \"select\" ]: sensor = {} sensor_name = sensor_instance . get_name () description = f \" { SELECT [ sensor_name ] } ( { sensor_name } )\" sensor [ \"name\" ] = sensor_name sensor [ \"description\" ] = description sensor [ \"current_option\" ] = sensor_instance . get_current_option () sensor [ \"available_options\" ] = sensor_instance . get_available_options () sensor [ \"is_enabled\" ] = sensor_instance . is_enabled () sensor [ \"is_updated\" ] = sensor_instance . is_updated () selects . append ( sensor ) # prepare button buttons = [] for sensor_instance in self . _sensor_instances [ \"button\" ]: sensor = {} sensor_name = sensor_instance . get_name () description = f \" { BUTTONS [ sensor_name ] } ( { sensor_name } )\" sensor [ \"name\" ] = sensor_name sensor [ \"description\" ] = description sensor [ \"is_enabled\" ] = sensor_instance . is_enabled () sensor [ \"is_updated\" ] = sensor_instance . is_updated () buttons . append ( sensor ) # prepare data structure to return data : dict [ str , Any ] = { \"api\" : { \"base_url\" : self . _api_client . get_base_url (), \"timeout\" : self . _api_client . get_timeout (), \"is_connected\" : self . _api_client . is_connected (), }, \"device\" : { \"device_id\" : self . _device_id , \"name\" : self . _name , \"catalog\" : self . _catalog , \"given_name\" : self . _given_name , \"model\" : self . _device_model , \"firmware\" : self . _firmware , \"manufacturer\" : self . _manufacturer , \"online\" : online , }, \"capabilities\" : capabilities , \"switches\" : switches , \"sensors\" : sensors , \"binary_sensors\" : binary_sensors , \"selects\" : selects , \"buttons\" : buttons , } return data get_firmware () \u00b6 Get firmware. Source code in imouapi/device.py 74 75 76 def get_firmware ( self ) -> str : \"\"\"Get firmware.\"\"\" return self . _firmware get_manufacturer () \u00b6 Get manufacturer. Source code in imouapi/device.py 70 71 72 def get_manufacturer ( self ) -> str : \"\"\"Get manufacturer.\"\"\" return self . _manufacturer get_model () \u00b6 Get model. Source code in imouapi/device.py 66 67 68 def get_model ( self ) -> str : \"\"\"Get model.\"\"\" return self . _device_model get_name () \u00b6 Get device name. Source code in imouapi/device.py 56 57 58 59 60 def get_name ( self ) -> str : \"\"\"Get device name.\"\"\" if self . _given_name != \"\" : return self . _given_name return self . _name get_sensor_by_name ( name ) \u00b6 Get sensor instance with a given name. Source code in imouapi/device.py 99 100 101 102 103 104 105 106 107 108 109 110 def get_sensor_by_name ( self , name : str ) -> Union [ ImouSensor , ImouBinarySensor , ImouSwitch , ImouSelect , ImouButton , None ]: \"\"\"Get sensor instance with a given name.\"\"\" for ( platform , # pylint: disable=unused-variable sensor_instances_array , ) in self . _sensor_instances . items (): for sensor_instance in sensor_instances_array : if sensor_instance . get_name () == name : return sensor_instance return None get_sensors_by_platform ( platform ) \u00b6 Get sensor instances associated to a given platform. Source code in imouapi/device.py 93 94 95 96 97 def get_sensors_by_platform ( self , platform : str ) -> list [ ImouEntity ]: \"\"\"Get sensor instances associated to a given platform.\"\"\" if platform not in self . _sensor_instances : return [] return self . _sensor_instances [ platform ] is_enabled () \u00b6 Is enabled. Source code in imouapi/device.py 116 117 118 def is_enabled ( self ) -> bool : \"\"\"Is enabled.\"\"\" return self . _enabled is_online () \u00b6 Get online. Source code in imouapi/device.py 78 79 80 def is_online ( self ) -> bool : \"\"\"Get online.\"\"\" return self . _online set_enabled ( value ) \u00b6 Set enable. Source code in imouapi/device.py 112 113 114 def set_enabled ( self , value : bool ) -> None : \"\"\"Set enable.\"\"\" self . _enabled = value set_name ( given_name ) \u00b6 Set device name. Source code in imouapi/device.py 62 63 64 def set_name ( self , given_name : str ) -> None : \"\"\"Set device name.\"\"\" self . _given_name = given_name to_string () \u00b6 Return the object as a string. Source code in imouapi/device.py 261 262 263 def to_string ( self ) -> str : \"\"\"Return the object as a string.\"\"\" return f \" { self . _name } ( { self . _device_model } , serial { self . _device_id } )\" ImouDiscoverService \u00b6 Class for discovering IMOU devices. Source code in imouapi/device.py 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 419 420 421 422 423 424 425 426 427 428 429 class ImouDiscoverService : \"\"\"Class for discovering IMOU devices.\"\"\" def __init__ ( self , api_client : ImouAPIClient ) -> None : \"\"\" Initialize the instance. Parameters: api_client: an ImouAPIClient instance \"\"\" self . _api_client = api_client async def async_discover_devices ( self ) -> dict : \"\"\"Discover registered devices and return a dict device name -> device object.\"\"\" _LOGGER . debug ( \"Starting discovery\" ) # get the list of devices devices_data = await self . _api_client . async_api_deviceBaseList () if \"deviceList\" not in devices_data or \"count\" not in devices_data : raise InvalidResponse ( f \"deviceList or count not found in { devices_data } \" ) _LOGGER . debug ( \"Discovered %d registered devices\" , devices_data [ \"count\" ]) # extract the device id for each device devices = {} for device_data in devices_data [ \"deviceList\" ]: # create a a device instance from the device id and initialize it device = ImouDevice ( self . _api_client , device_data [ \"deviceId\" ]) await device . async_initialize () _LOGGER . debug ( \" - %s \" , device . to_string ()) devices [ f \" { device . get_name () } \" ] = device # return a dict with device name -> device instance return devices __init__ ( api_client ) \u00b6 Initialize the instance. Parameters: Name Type Description Default api_client ImouAPIClient an ImouAPIClient instance required Source code in imouapi/device.py 403 404 405 406 407 408 409 410 def __init__ ( self , api_client : ImouAPIClient ) -> None : \"\"\" Initialize the instance. Parameters: api_client: an ImouAPIClient instance \"\"\" self . _api_client = api_client async_discover_devices () async \u00b6 Discover registered devices and return a dict device name -> device object. Source code in imouapi/device.py 412 413 414 415 416 417 418 419 420 421 422 423 424 425 426 427 428 429 async def async_discover_devices ( self ) -> dict : \"\"\"Discover registered devices and return a dict device name -> device object.\"\"\" _LOGGER . debug ( \"Starting discovery\" ) # get the list of devices devices_data = await self . _api_client . async_api_deviceBaseList () if \"deviceList\" not in devices_data or \"count\" not in devices_data : raise InvalidResponse ( f \"deviceList or count not found in { devices_data } \" ) _LOGGER . debug ( \"Discovered %d registered devices\" , devices_data [ \"count\" ]) # extract the device id for each device devices = {} for device_data in devices_data [ \"deviceList\" ]: # create a a device instance from the device id and initialize it device = ImouDevice ( self . _api_client , device_data [ \"deviceId\" ]) await device . async_initialize () _LOGGER . debug ( \" - %s \" , device . to_string ()) devices [ f \" { device . get_name () } \" ] = device # return a dict with device name -> device instance return devices","title":"device"},{"location":"modules/device/#imouapi.device.ImouDevice","text":"A representation of an IMOU Device. Source code in imouapi/device.py 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 class ImouDevice : \"\"\"A representation of an IMOU Device.\"\"\" def __init__ ( self , api_client : ImouAPIClient , device_id : str , ) -> None : \"\"\" Initialize the instance. Parameters: api_client: an ImouAPIClient instance device_id: device id \"\"\" self . _api_client = api_client self . _device_id = device_id self . _catalog = \"N.A.\" self . _firmware = \"N.A.\" self . _name = \"N.A.\" self . _given_name = \"\" self . _device_model = \"N.A.\" self . _manufacturer = \"Imou\" self . _online = False self . _capabilities : list [ str ] = [] self . _switches : list [ str ] = [] self . _sensor_instances : dict [ str , list ] = { \"switch\" : [], \"sensor\" : [], \"binary_sensor\" : [], \"select\" : [], \"button\" : [], } self . _initialized = False self . _enabled = True def get_device_id ( self ) -> str : \"\"\"Get device id.\"\"\" return self . _device_id def get_name ( self ) -> str : \"\"\"Get device name.\"\"\" if self . _given_name != \"\" : return self . _given_name return self . _name def set_name ( self , given_name : str ) -> None : \"\"\"Set device name.\"\"\" self . _given_name = given_name def get_model ( self ) -> str : \"\"\"Get model.\"\"\" return self . _device_model def get_manufacturer ( self ) -> str : \"\"\"Get manufacturer.\"\"\" return self . _manufacturer def get_firmware ( self ) -> str : \"\"\"Get firmware.\"\"\" return self . _firmware def is_online ( self ) -> bool : \"\"\"Get online.\"\"\" return self . _online def get_all_sensors ( self ) -> list [ ImouEntity ]: \"\"\"Get all the sensor instances.\"\"\" sensors = [] for ( platform , # pylint: disable=unused-variable sensor_instances_array , ) in self . _sensor_instances . items (): for sensor_instance in sensor_instances_array : sensors . append ( sensor_instance ) return sensors def get_sensors_by_platform ( self , platform : str ) -> list [ ImouEntity ]: \"\"\"Get sensor instances associated to a given platform.\"\"\" if platform not in self . _sensor_instances : return [] return self . _sensor_instances [ platform ] def get_sensor_by_name ( self , name : str ) -> Union [ ImouSensor , ImouBinarySensor , ImouSwitch , ImouSelect , ImouButton , None ]: \"\"\"Get sensor instance with a given name.\"\"\" for ( platform , # pylint: disable=unused-variable sensor_instances_array , ) in self . _sensor_instances . items (): for sensor_instance in sensor_instances_array : if sensor_instance . get_name () == name : return sensor_instance return None def set_enabled ( self , value : bool ) -> None : \"\"\"Set enable.\"\"\" self . _enabled = value def is_enabled ( self ) -> bool : \"\"\"Is enabled.\"\"\" return self . _enabled async def async_initialize ( self ) -> None : \"\"\"Initialize the instance by retrieving the device details and associated sensors.\"\"\" # get the details for this device from the API device_array = await self . _api_client . async_api_deviceBaseDetailList ([ self . _device_id ]) if \"deviceList\" not in device_array or len ( device_array [ \"deviceList\" ]) != 1 : raise InvalidResponse ( f \"deviceList not found in { str ( device_array ) } \" ) # reponse is an array, our data is in the first element device_data = device_array [ \"deviceList\" ][ 0 ] try : # get device details self . _catalog = device_data [ \"catalog\" ] self . _firmware = device_data [ \"version\" ] self . _name = device_data [ \"name\" ] self . _device_model = device_data [ \"deviceModel\" ] self . _online = device_data [ \"status\" ] == \"online\" # get device capabilities self . _capabilities = device_data [ \"ability\" ] . split ( \",\" ) # Add undocumented capabilities or capabilities inherited from other capabilities if \"AlarmMD\" in self . _capabilities : self . _capabilities . append ( \"MotionDetect\" ) if \"WLM\" in self . _capabilities : self . _capabilities . append ( \"Linkagewhitelight\" ) if \"WLAN\" in self . _capabilities : self . _capabilities . append ( \"pushNotifications\" ) switches_keys = IMOU_SWITCHES . keys () # add switches. For each possible switch, check if there is a capability with the same name \\ # (ref. https://open.imoulife.com/book/en/faq/feature.html) for switch_type in switches_keys : for capability in self . _capabilities : capability = capability . lower () capability = re . sub ( \"v \\\\ d$\" , '' , capability ) if switch_type . lower () == capability and switch_type . lower () not in self . _switches : self . _switches . append ( switch_type ) # create an instance and save it switch_instance = ImouSwitch ( self . _api_client , self . _device_id , self . get_name (), switch_type , ) self . _sensor_instances [ \"switch\" ] . append ( switch_instance ) break # add lastAlarm sensor if \"AlarmMD\" in self . _capabilities : self . _sensor_instances [ \"sensor\" ] . append ( ImouSensor ( self . _api_client , self . _device_id , self . get_name (), \"lastAlarm\" , ) ) # add storageUsed sensor if \"LocalStorage\" in self . _capabilities : self . _sensor_instances [ \"sensor\" ] . append ( ImouSensor ( self . _api_client , self . _device_id , self . get_name (), \"storageUsed\" , ) ) # add callbackUrl sensor self . _sensor_instances [ \"sensor\" ] . append ( ImouSensor ( self . _api_client , self . _device_id , self . get_name (), \"callbackUrl\" , ) ) # add online binary sensor if \"WLAN\" in self . _capabilities : self . _sensor_instances [ \"binary_sensor\" ] . append ( ImouBinarySensor ( self . _api_client , self . _device_id , self . get_name (), \"online\" , ) ) # add nightVisionMode select if \"NVM\" in self . _capabilities : self . _sensor_instances [ \"select\" ] . append ( ImouSelect ( self . _api_client , self . _device_id , self . get_name (), \"nightVisionMode\" , ) ) # add restartDevice button self . _sensor_instances [ \"button\" ] . append ( ImouButton ( self . _api_client , self . _device_id , self . get_name (), \"restartDevice\" , ) ) # add refreshData button self . _sensor_instances [ \"button\" ] . append ( ImouButton ( self . _api_client , self . _device_id , self . get_name (), \"refreshData\" , ) ) except Exception as exception : raise InvalidResponse ( f \" missing parameter or error parsing in { device_data } \" ) from exception _LOGGER . debug ( \"Retrieved device %s \" , self . to_string ()) _LOGGER . debug ( \"Device details: \\n %s \" , self . dump ()) # keep track that we have already asked for the device details self . _initialized = True async def async_get_data ( self ) -> bool : \"\"\"Update device properties and its sensors.\"\"\" if not self . _enabled : return False if not self . _initialized : # get the details of the device first await self . async_initialize () # check if the device is online _LOGGER . debug ( \"[ %s ] update requested\" , self . get_name ()) data = await self . _api_client . async_api_deviceOnline ( self . _device_id ) if \"onLine\" not in data : raise InvalidResponse ( f \"onLine not found in { data } \" ) self . _online = data [ \"onLine\" ] == \"1\" # update the status of all the sensors (if the device is online) if self . _online : for ( platform , # pylint: disable=unused-variable sensor_instances_array , ) in self . _sensor_instances . items (): for sensor_instance in sensor_instances_array : await sensor_instance . async_update () return True def to_string ( self ) -> str : \"\"\"Return the object as a string.\"\"\" return f \" { self . _name } ( { self . _device_model } , serial { self . _device_id } )\" def get_diagnostics ( self ) -> dict [ str , Any ]: \"\"\"Return diagnostics for the device.\"\"\" online = \"yes\" if self . _online else \"no\" # prepare capabilities capabilities = [] for capability_name in self . _capabilities : capability = {} description = ( f \" { IMOU_CAPABILITIES [ capability_name ] } ( { capability_name } )\" if capability_name in IMOU_CAPABILITIES else capability_name ) capability [ \"name\" ] = capability_name capability [ \"description\" ] = description capabilities . append ( capability ) # prepare switches switches = [] for sensor_instance in self . _sensor_instances [ \"switch\" ]: sensor = {} sensor_name = sensor_instance . get_name () description = ( f \" { IMOU_SWITCHES [ sensor_name ] } ( { sensor_name } )\" if sensor_name in IMOU_SWITCHES else sensor_name ) sensor [ \"name\" ] = sensor_name sensor [ \"description\" ] = description sensor [ \"state\" ] = sensor_instance . is_on () sensor [ \"is_enabled\" ] = sensor_instance . is_enabled () sensor [ \"is_updated\" ] = sensor_instance . is_updated () switches . append ( sensor ) # prepare sensors sensors = [] for sensor_instance in self . _sensor_instances [ \"sensor\" ]: sensor = {} sensor_name = sensor_instance . get_name () description = f \" { SENSORS [ sensor_name ] } ( { sensor_name } )\" sensor [ \"name\" ] = sensor_name sensor [ \"description\" ] = description sensor [ \"state\" ] = sensor_instance . get_state () sensor [ \"is_enabled\" ] = sensor_instance . is_enabled () sensor [ \"is_updated\" ] = sensor_instance . is_updated () sensors . append ( sensor ) # prepare binary sensors binary_sensors = [] for sensor_instance in self . _sensor_instances [ \"binary_sensor\" ]: sensor = {} sensor_name = sensor_instance . get_name () description = f \" { BINARY_SENSORS [ sensor_name ] } ( { sensor_name } )\" sensor [ \"name\" ] = sensor_name sensor [ \"description\" ] = description sensor [ \"state\" ] = sensor_instance . is_on () sensor [ \"is_enabled\" ] = sensor_instance . is_enabled () sensor [ \"is_updated\" ] = sensor_instance . is_updated () binary_sensors . append ( sensor ) # prepare select selects = [] for sensor_instance in self . _sensor_instances [ \"select\" ]: sensor = {} sensor_name = sensor_instance . get_name () description = f \" { SELECT [ sensor_name ] } ( { sensor_name } )\" sensor [ \"name\" ] = sensor_name sensor [ \"description\" ] = description sensor [ \"current_option\" ] = sensor_instance . get_current_option () sensor [ \"available_options\" ] = sensor_instance . get_available_options () sensor [ \"is_enabled\" ] = sensor_instance . is_enabled () sensor [ \"is_updated\" ] = sensor_instance . is_updated () selects . append ( sensor ) # prepare button buttons = [] for sensor_instance in self . _sensor_instances [ \"button\" ]: sensor = {} sensor_name = sensor_instance . get_name () description = f \" { BUTTONS [ sensor_name ] } ( { sensor_name } )\" sensor [ \"name\" ] = sensor_name sensor [ \"description\" ] = description sensor [ \"is_enabled\" ] = sensor_instance . is_enabled () sensor [ \"is_updated\" ] = sensor_instance . is_updated () buttons . append ( sensor ) # prepare data structure to return data : dict [ str , Any ] = { \"api\" : { \"base_url\" : self . _api_client . get_base_url (), \"timeout\" : self . _api_client . get_timeout (), \"is_connected\" : self . _api_client . is_connected (), }, \"device\" : { \"device_id\" : self . _device_id , \"name\" : self . _name , \"catalog\" : self . _catalog , \"given_name\" : self . _given_name , \"model\" : self . _device_model , \"firmware\" : self . _firmware , \"manufacturer\" : self . _manufacturer , \"online\" : online , }, \"capabilities\" : capabilities , \"switches\" : switches , \"sensors\" : sensors , \"binary_sensors\" : binary_sensors , \"selects\" : selects , \"buttons\" : buttons , } return data def dump ( self ) -> str : \"\"\"Return the full description of the object and its attributes.\"\"\" data = self . get_diagnostics () dump = ( f \"- Device ID: { data [ 'device' ][ 'device_id' ] } \\n \" + f \" Name: { data [ 'device' ][ 'name' ] } \\n \" + f \" Catalog: { data [ 'device' ][ 'catalog' ] } \\n \" + f \" Model: { data [ 'device' ][ 'model' ] } \\n \" + f \" Firmware: { data [ 'device' ][ 'firmware' ] } \\n \" + f \" Online: { data [ 'device' ][ 'online' ] } \\n \" ) dump = dump + \" Capabilities: \\n \" for capability in data [ 'capabilities' ]: dump = dump + f \" - { capability [ 'description' ] } \\n \" dump = dump + \" Switches: \\n \" for switch in data [ 'switches' ]: dump = dump + f \" - { switch [ 'description' ] } : { switch [ 'state' ] } \\n \" dump = dump + \" Sensors: \\n \" for sensor in data [ 'sensors' ]: dump = dump + f \" - { sensor [ 'description' ] } : { sensor [ 'state' ] } \\n \" dump = dump + \" Binary Sensors: \\n \" for binary_sensor in data [ 'binary_sensors' ]: dump = dump + f \" - { binary_sensor [ 'description' ] } : { binary_sensor [ 'state' ] } \\n \" dump = dump + \" Select: \\n \" for select in data [ 'selects' ]: dump = dump + f \" - { select [ 'description' ] } : { select [ 'current_option' ] } \\n \" dump = dump + \" Buttons: \\n \" for button in data [ 'buttons' ]: dump = dump + f \" - { button [ 'description' ] } \\n \" return dump","title":"ImouDevice"},{"location":"modules/device/#imouapi.device.ImouDevice.__init__","text":"Initialize the instance. Parameters: Name Type Description Default api_client ImouAPIClient an ImouAPIClient instance required device_id str device id required Source code in imouapi/device.py 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 def __init__ ( self , api_client : ImouAPIClient , device_id : str , ) -> None : \"\"\" Initialize the instance. Parameters: api_client: an ImouAPIClient instance device_id: device id \"\"\" self . _api_client = api_client self . _device_id = device_id self . _catalog = \"N.A.\" self . _firmware = \"N.A.\" self . _name = \"N.A.\" self . _given_name = \"\" self . _device_model = \"N.A.\" self . _manufacturer = \"Imou\" self . _online = False self . _capabilities : list [ str ] = [] self . _switches : list [ str ] = [] self . _sensor_instances : dict [ str , list ] = { \"switch\" : [], \"sensor\" : [], \"binary_sensor\" : [], \"select\" : [], \"button\" : [], } self . _initialized = False self . _enabled = True","title":"__init__()"},{"location":"modules/device/#imouapi.device.ImouDevice.async_get_data","text":"Update device properties and its sensors. Source code in imouapi/device.py 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 async def async_get_data ( self ) -> bool : \"\"\"Update device properties and its sensors.\"\"\" if not self . _enabled : return False if not self . _initialized : # get the details of the device first await self . async_initialize () # check if the device is online _LOGGER . debug ( \"[ %s ] update requested\" , self . get_name ()) data = await self . _api_client . async_api_deviceOnline ( self . _device_id ) if \"onLine\" not in data : raise InvalidResponse ( f \"onLine not found in { data } \" ) self . _online = data [ \"onLine\" ] == \"1\" # update the status of all the sensors (if the device is online) if self . _online : for ( platform , # pylint: disable=unused-variable sensor_instances_array , ) in self . _sensor_instances . items (): for sensor_instance in sensor_instances_array : await sensor_instance . async_update () return True","title":"async_get_data()"},{"location":"modules/device/#imouapi.device.ImouDevice.async_initialize","text":"Initialize the instance by retrieving the device details and associated sensors. Source code in imouapi/device.py 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 async def async_initialize ( self ) -> None : \"\"\"Initialize the instance by retrieving the device details and associated sensors.\"\"\" # get the details for this device from the API device_array = await self . _api_client . async_api_deviceBaseDetailList ([ self . _device_id ]) if \"deviceList\" not in device_array or len ( device_array [ \"deviceList\" ]) != 1 : raise InvalidResponse ( f \"deviceList not found in { str ( device_array ) } \" ) # reponse is an array, our data is in the first element device_data = device_array [ \"deviceList\" ][ 0 ] try : # get device details self . _catalog = device_data [ \"catalog\" ] self . _firmware = device_data [ \"version\" ] self . _name = device_data [ \"name\" ] self . _device_model = device_data [ \"deviceModel\" ] self . _online = device_data [ \"status\" ] == \"online\" # get device capabilities self . _capabilities = device_data [ \"ability\" ] . split ( \",\" ) # Add undocumented capabilities or capabilities inherited from other capabilities if \"AlarmMD\" in self . _capabilities : self . _capabilities . append ( \"MotionDetect\" ) if \"WLM\" in self . _capabilities : self . _capabilities . append ( \"Linkagewhitelight\" ) if \"WLAN\" in self . _capabilities : self . _capabilities . append ( \"pushNotifications\" ) switches_keys = IMOU_SWITCHES . keys () # add switches. For each possible switch, check if there is a capability with the same name \\ # (ref. https://open.imoulife.com/book/en/faq/feature.html) for switch_type in switches_keys : for capability in self . _capabilities : capability = capability . lower () capability = re . sub ( \"v \\\\ d$\" , '' , capability ) if switch_type . lower () == capability and switch_type . lower () not in self . _switches : self . _switches . append ( switch_type ) # create an instance and save it switch_instance = ImouSwitch ( self . _api_client , self . _device_id , self . get_name (), switch_type , ) self . _sensor_instances [ \"switch\" ] . append ( switch_instance ) break # add lastAlarm sensor if \"AlarmMD\" in self . _capabilities : self . _sensor_instances [ \"sensor\" ] . append ( ImouSensor ( self . _api_client , self . _device_id , self . get_name (), \"lastAlarm\" , ) ) # add storageUsed sensor if \"LocalStorage\" in self . _capabilities : self . _sensor_instances [ \"sensor\" ] . append ( ImouSensor ( self . _api_client , self . _device_id , self . get_name (), \"storageUsed\" , ) ) # add callbackUrl sensor self . _sensor_instances [ \"sensor\" ] . append ( ImouSensor ( self . _api_client , self . _device_id , self . get_name (), \"callbackUrl\" , ) ) # add online binary sensor if \"WLAN\" in self . _capabilities : self . _sensor_instances [ \"binary_sensor\" ] . append ( ImouBinarySensor ( self . _api_client , self . _device_id , self . get_name (), \"online\" , ) ) # add nightVisionMode select if \"NVM\" in self . _capabilities : self . _sensor_instances [ \"select\" ] . append ( ImouSelect ( self . _api_client , self . _device_id , self . get_name (), \"nightVisionMode\" , ) ) # add restartDevice button self . _sensor_instances [ \"button\" ] . append ( ImouButton ( self . _api_client , self . _device_id , self . get_name (), \"restartDevice\" , ) ) # add refreshData button self . _sensor_instances [ \"button\" ] . append ( ImouButton ( self . _api_client , self . _device_id , self . get_name (), \"refreshData\" , ) ) except Exception as exception : raise InvalidResponse ( f \" missing parameter or error parsing in { device_data } \" ) from exception _LOGGER . debug ( \"Retrieved device %s \" , self . to_string ()) _LOGGER . debug ( \"Device details: \\n %s \" , self . dump ()) # keep track that we have already asked for the device details self . _initialized = True","title":"async_initialize()"},{"location":"modules/device/#imouapi.device.ImouDevice.dump","text":"Return the full description of the object and its attributes. Source code in imouapi/device.py 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 def dump ( self ) -> str : \"\"\"Return the full description of the object and its attributes.\"\"\" data = self . get_diagnostics () dump = ( f \"- Device ID: { data [ 'device' ][ 'device_id' ] } \\n \" + f \" Name: { data [ 'device' ][ 'name' ] } \\n \" + f \" Catalog: { data [ 'device' ][ 'catalog' ] } \\n \" + f \" Model: { data [ 'device' ][ 'model' ] } \\n \" + f \" Firmware: { data [ 'device' ][ 'firmware' ] } \\n \" + f \" Online: { data [ 'device' ][ 'online' ] } \\n \" ) dump = dump + \" Capabilities: \\n \" for capability in data [ 'capabilities' ]: dump = dump + f \" - { capability [ 'description' ] } \\n \" dump = dump + \" Switches: \\n \" for switch in data [ 'switches' ]: dump = dump + f \" - { switch [ 'description' ] } : { switch [ 'state' ] } \\n \" dump = dump + \" Sensors: \\n \" for sensor in data [ 'sensors' ]: dump = dump + f \" - { sensor [ 'description' ] } : { sensor [ 'state' ] } \\n \" dump = dump + \" Binary Sensors: \\n \" for binary_sensor in data [ 'binary_sensors' ]: dump = dump + f \" - { binary_sensor [ 'description' ] } : { binary_sensor [ 'state' ] } \\n \" dump = dump + \" Select: \\n \" for select in data [ 'selects' ]: dump = dump + f \" - { select [ 'description' ] } : { select [ 'current_option' ] } \\n \" dump = dump + \" Buttons: \\n \" for button in data [ 'buttons' ]: dump = dump + f \" - { button [ 'description' ] } \\n \" return dump","title":"dump()"},{"location":"modules/device/#imouapi.device.ImouDevice.get_all_sensors","text":"Get all the sensor instances. Source code in imouapi/device.py 82 83 84 85 86 87 88 89 90 91 def get_all_sensors ( self ) -> list [ ImouEntity ]: \"\"\"Get all the sensor instances.\"\"\" sensors = [] for ( platform , # pylint: disable=unused-variable sensor_instances_array , ) in self . _sensor_instances . items (): for sensor_instance in sensor_instances_array : sensors . append ( sensor_instance ) return sensors","title":"get_all_sensors()"},{"location":"modules/device/#imouapi.device.ImouDevice.get_device_id","text":"Get device id. Source code in imouapi/device.py 52 53 54 def get_device_id ( self ) -> str : \"\"\"Get device id.\"\"\" return self . _device_id","title":"get_device_id()"},{"location":"modules/device/#imouapi.device.ImouDevice.get_diagnostics","text":"Return diagnostics for the device. Source code in imouapi/device.py 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 def get_diagnostics ( self ) -> dict [ str , Any ]: \"\"\"Return diagnostics for the device.\"\"\" online = \"yes\" if self . _online else \"no\" # prepare capabilities capabilities = [] for capability_name in self . _capabilities : capability = {} description = ( f \" { IMOU_CAPABILITIES [ capability_name ] } ( { capability_name } )\" if capability_name in IMOU_CAPABILITIES else capability_name ) capability [ \"name\" ] = capability_name capability [ \"description\" ] = description capabilities . append ( capability ) # prepare switches switches = [] for sensor_instance in self . _sensor_instances [ \"switch\" ]: sensor = {} sensor_name = sensor_instance . get_name () description = ( f \" { IMOU_SWITCHES [ sensor_name ] } ( { sensor_name } )\" if sensor_name in IMOU_SWITCHES else sensor_name ) sensor [ \"name\" ] = sensor_name sensor [ \"description\" ] = description sensor [ \"state\" ] = sensor_instance . is_on () sensor [ \"is_enabled\" ] = sensor_instance . is_enabled () sensor [ \"is_updated\" ] = sensor_instance . is_updated () switches . append ( sensor ) # prepare sensors sensors = [] for sensor_instance in self . _sensor_instances [ \"sensor\" ]: sensor = {} sensor_name = sensor_instance . get_name () description = f \" { SENSORS [ sensor_name ] } ( { sensor_name } )\" sensor [ \"name\" ] = sensor_name sensor [ \"description\" ] = description sensor [ \"state\" ] = sensor_instance . get_state () sensor [ \"is_enabled\" ] = sensor_instance . is_enabled () sensor [ \"is_updated\" ] = sensor_instance . is_updated () sensors . append ( sensor ) # prepare binary sensors binary_sensors = [] for sensor_instance in self . _sensor_instances [ \"binary_sensor\" ]: sensor = {} sensor_name = sensor_instance . get_name () description = f \" { BINARY_SENSORS [ sensor_name ] } ( { sensor_name } )\" sensor [ \"name\" ] = sensor_name sensor [ \"description\" ] = description sensor [ \"state\" ] = sensor_instance . is_on () sensor [ \"is_enabled\" ] = sensor_instance . is_enabled () sensor [ \"is_updated\" ] = sensor_instance . is_updated () binary_sensors . append ( sensor ) # prepare select selects = [] for sensor_instance in self . _sensor_instances [ \"select\" ]: sensor = {} sensor_name = sensor_instance . get_name () description = f \" { SELECT [ sensor_name ] } ( { sensor_name } )\" sensor [ \"name\" ] = sensor_name sensor [ \"description\" ] = description sensor [ \"current_option\" ] = sensor_instance . get_current_option () sensor [ \"available_options\" ] = sensor_instance . get_available_options () sensor [ \"is_enabled\" ] = sensor_instance . is_enabled () sensor [ \"is_updated\" ] = sensor_instance . is_updated () selects . append ( sensor ) # prepare button buttons = [] for sensor_instance in self . _sensor_instances [ \"button\" ]: sensor = {} sensor_name = sensor_instance . get_name () description = f \" { BUTTONS [ sensor_name ] } ( { sensor_name } )\" sensor [ \"name\" ] = sensor_name sensor [ \"description\" ] = description sensor [ \"is_enabled\" ] = sensor_instance . is_enabled () sensor [ \"is_updated\" ] = sensor_instance . is_updated () buttons . append ( sensor ) # prepare data structure to return data : dict [ str , Any ] = { \"api\" : { \"base_url\" : self . _api_client . get_base_url (), \"timeout\" : self . _api_client . get_timeout (), \"is_connected\" : self . _api_client . is_connected (), }, \"device\" : { \"device_id\" : self . _device_id , \"name\" : self . _name , \"catalog\" : self . _catalog , \"given_name\" : self . _given_name , \"model\" : self . _device_model , \"firmware\" : self . _firmware , \"manufacturer\" : self . _manufacturer , \"online\" : online , }, \"capabilities\" : capabilities , \"switches\" : switches , \"sensors\" : sensors , \"binary_sensors\" : binary_sensors , \"selects\" : selects , \"buttons\" : buttons , } return data","title":"get_diagnostics()"},{"location":"modules/device/#imouapi.device.ImouDevice.get_firmware","text":"Get firmware. Source code in imouapi/device.py 74 75 76 def get_firmware ( self ) -> str : \"\"\"Get firmware.\"\"\" return self . _firmware","title":"get_firmware()"},{"location":"modules/device/#imouapi.device.ImouDevice.get_manufacturer","text":"Get manufacturer. Source code in imouapi/device.py 70 71 72 def get_manufacturer ( self ) -> str : \"\"\"Get manufacturer.\"\"\" return self . _manufacturer","title":"get_manufacturer()"},{"location":"modules/device/#imouapi.device.ImouDevice.get_model","text":"Get model. Source code in imouapi/device.py 66 67 68 def get_model ( self ) -> str : \"\"\"Get model.\"\"\" return self . _device_model","title":"get_model()"},{"location":"modules/device/#imouapi.device.ImouDevice.get_name","text":"Get device name. Source code in imouapi/device.py 56 57 58 59 60 def get_name ( self ) -> str : \"\"\"Get device name.\"\"\" if self . _given_name != \"\" : return self . _given_name return self . _name","title":"get_name()"},{"location":"modules/device/#imouapi.device.ImouDevice.get_sensor_by_name","text":"Get sensor instance with a given name. Source code in imouapi/device.py 99 100 101 102 103 104 105 106 107 108 109 110 def get_sensor_by_name ( self , name : str ) -> Union [ ImouSensor , ImouBinarySensor , ImouSwitch , ImouSelect , ImouButton , None ]: \"\"\"Get sensor instance with a given name.\"\"\" for ( platform , # pylint: disable=unused-variable sensor_instances_array , ) in self . _sensor_instances . items (): for sensor_instance in sensor_instances_array : if sensor_instance . get_name () == name : return sensor_instance return None","title":"get_sensor_by_name()"},{"location":"modules/device/#imouapi.device.ImouDevice.get_sensors_by_platform","text":"Get sensor instances associated to a given platform. Source code in imouapi/device.py 93 94 95 96 97 def get_sensors_by_platform ( self , platform : str ) -> list [ ImouEntity ]: \"\"\"Get sensor instances associated to a given platform.\"\"\" if platform not in self . _sensor_instances : return [] return self . _sensor_instances [ platform ]","title":"get_sensors_by_platform()"},{"location":"modules/device/#imouapi.device.ImouDevice.is_enabled","text":"Is enabled. Source code in imouapi/device.py 116 117 118 def is_enabled ( self ) -> bool : \"\"\"Is enabled.\"\"\" return self . _enabled","title":"is_enabled()"},{"location":"modules/device/#imouapi.device.ImouDevice.is_online","text":"Get online. Source code in imouapi/device.py 78 79 80 def is_online ( self ) -> bool : \"\"\"Get online.\"\"\" return self . _online","title":"is_online()"},{"location":"modules/device/#imouapi.device.ImouDevice.set_enabled","text":"Set enable. Source code in imouapi/device.py 112 113 114 def set_enabled ( self , value : bool ) -> None : \"\"\"Set enable.\"\"\" self . _enabled = value","title":"set_enabled()"},{"location":"modules/device/#imouapi.device.ImouDevice.set_name","text":"Set device name. Source code in imouapi/device.py 62 63 64 def set_name ( self , given_name : str ) -> None : \"\"\"Set device name.\"\"\" self . _given_name = given_name","title":"set_name()"},{"location":"modules/device/#imouapi.device.ImouDevice.to_string","text":"Return the object as a string. Source code in imouapi/device.py 261 262 263 def to_string ( self ) -> str : \"\"\"Return the object as a string.\"\"\" return f \" { self . _name } ( { self . _device_model } , serial { self . _device_id } )\"","title":"to_string()"},{"location":"modules/device/#imouapi.device.ImouDiscoverService","text":"Class for discovering IMOU devices. Source code in imouapi/device.py 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 419 420 421 422 423 424 425 426 427 428 429 class ImouDiscoverService : \"\"\"Class for discovering IMOU devices.\"\"\" def __init__ ( self , api_client : ImouAPIClient ) -> None : \"\"\" Initialize the instance. Parameters: api_client: an ImouAPIClient instance \"\"\" self . _api_client = api_client async def async_discover_devices ( self ) -> dict : \"\"\"Discover registered devices and return a dict device name -> device object.\"\"\" _LOGGER . debug ( \"Starting discovery\" ) # get the list of devices devices_data = await self . _api_client . async_api_deviceBaseList () if \"deviceList\" not in devices_data or \"count\" not in devices_data : raise InvalidResponse ( f \"deviceList or count not found in { devices_data } \" ) _LOGGER . debug ( \"Discovered %d registered devices\" , devices_data [ \"count\" ]) # extract the device id for each device devices = {} for device_data in devices_data [ \"deviceList\" ]: # create a a device instance from the device id and initialize it device = ImouDevice ( self . _api_client , device_data [ \"deviceId\" ]) await device . async_initialize () _LOGGER . debug ( \" - %s \" , device . to_string ()) devices [ f \" { device . get_name () } \" ] = device # return a dict with device name -> device instance return devices","title":"ImouDiscoverService"},{"location":"modules/device/#imouapi.device.ImouDiscoverService.__init__","text":"Initialize the instance. Parameters: Name Type Description Default api_client ImouAPIClient an ImouAPIClient instance required Source code in imouapi/device.py 403 404 405 406 407 408 409 410 def __init__ ( self , api_client : ImouAPIClient ) -> None : \"\"\" Initialize the instance. Parameters: api_client: an ImouAPIClient instance \"\"\" self . _api_client = api_client","title":"__init__()"},{"location":"modules/device/#imouapi.device.ImouDiscoverService.async_discover_devices","text":"Discover registered devices and return a dict device name -> device object. Source code in imouapi/device.py 412 413 414 415 416 417 418 419 420 421 422 423 424 425 426 427 428 429 async def async_discover_devices ( self ) -> dict : \"\"\"Discover registered devices and return a dict device name -> device object.\"\"\" _LOGGER . debug ( \"Starting discovery\" ) # get the list of devices devices_data = await self . _api_client . async_api_deviceBaseList () if \"deviceList\" not in devices_data or \"count\" not in devices_data : raise InvalidResponse ( f \"deviceList or count not found in { devices_data } \" ) _LOGGER . debug ( \"Discovered %d registered devices\" , devices_data [ \"count\" ]) # extract the device id for each device devices = {} for device_data in devices_data [ \"deviceList\" ]: # create a a device instance from the device id and initialize it device = ImouDevice ( self . _api_client , device_data [ \"deviceId\" ]) await device . async_initialize () _LOGGER . debug ( \" - %s \" , device . to_string ()) devices [ f \" { device . get_name () } \" ] = device # return a dict with device name -> device instance return devices","title":"async_discover_devices()"},{"location":"modules/device_entity/","text":"Classes for representing entities beloging to an Imou device. ImouBinarySensor \u00b6 Bases: ImouEntity A representation of a sensor within an IMOU Device. Source code in imouapi/device_entity.py 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 class ImouBinarySensor ( ImouEntity ): \"\"\"A representation of a sensor within an IMOU Device.\"\"\" def __init__ ( self , api_client : ImouAPIClient , device_id : str , device_name : str , sensor_type : str , ) -> None : \"\"\" Initialize the instance. Parameters: api_client: an instance ofthe API client device_id: the device id device_name: the device name sensor_type: the sensor type from const BINARY_SENSORS \"\"\" super () . __init__ ( api_client , device_id , device_name , sensor_type , BINARY_SENSORS [ sensor_type ]) # keep track of the status of the sensor self . _state = None async def async_update ( self , ** kwargs ): \"\"\"Update the entity.\"\"\" if not self . _enabled : return # online sensor if self . _name == \"online\" : # get the online status data = await self . api_client . async_api_deviceOnline ( self . _device_id ) if \"onLine\" not in data : raise InvalidResponse ( f \"onLine not found in { data } \" ) self . _state = data [ \"onLine\" ] == \"1\" _LOGGER . debug ( \"[ %s ] updating %s , value is %s \" , self . _device_name , self . _description , self . _state , ) if not self . _updated : self . _updated = True def is_on ( self ) -> Optional [ bool ]: \"\"\"Return the status of the switch.\"\"\" return self . _state __init__ ( api_client , device_id , device_name , sensor_type ) \u00b6 Initialize the instance. Parameters: Name Type Description Default api_client ImouAPIClient an instance ofthe API client required device_id str the device id required device_name str the device name required sensor_type str the sensor type from const BINARY_SENSORS required Source code in imouapi/device_entity.py 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 def __init__ ( self , api_client : ImouAPIClient , device_id : str , device_name : str , sensor_type : str , ) -> None : \"\"\" Initialize the instance. Parameters: api_client: an instance ofthe API client device_id: the device id device_name: the device name sensor_type: the sensor type from const BINARY_SENSORS \"\"\" super () . __init__ ( api_client , device_id , device_name , sensor_type , BINARY_SENSORS [ sensor_type ]) # keep track of the status of the sensor self . _state = None async_update ( ** kwargs ) async \u00b6 Update the entity. Source code in imouapi/device_entity.py 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 async def async_update ( self , ** kwargs ): \"\"\"Update the entity.\"\"\" if not self . _enabled : return # online sensor if self . _name == \"online\" : # get the online status data = await self . api_client . async_api_deviceOnline ( self . _device_id ) if \"onLine\" not in data : raise InvalidResponse ( f \"onLine not found in { data } \" ) self . _state = data [ \"onLine\" ] == \"1\" _LOGGER . debug ( \"[ %s ] updating %s , value is %s \" , self . _device_name , self . _description , self . _state , ) if not self . _updated : self . _updated = True is_on () \u00b6 Return the status of the switch. Source code in imouapi/device_entity.py 189 190 191 def is_on ( self ) -> Optional [ bool ]: \"\"\"Return the status of the switch.\"\"\" return self . _state ImouButton \u00b6 Bases: ImouEntity A representation of a button within an IMOU Device. Source code in imouapi/device_entity.py 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 class ImouButton ( ImouEntity ): \"\"\"A representation of a button within an IMOU Device.\"\"\" def __init__ ( self , api_client : ImouAPIClient , device_id : str , device_name : str , sensor_type : str , ) -> None : \"\"\" Initialize the instance. Parameters: api_client: an instance ofthe API client device_id: the device id device_name: the device name sensor_type: the sensor type from const BUTTON \"\"\" super () . __init__ ( api_client , device_id , device_name , sensor_type , BUTTONS [ sensor_type ]) async def async_press ( self ) -> None : \"\"\"Press action.\"\"\" if not self . _enabled : return if self . _name == \"restartDevice\" : # restart the device await self . api_client . async_api_restartDevice ( self . _device_id ) if self . _name == \"refreshData\" : # refresh the data of all the sensors of the device if self . _device_instance is not None : await self . _device_instance . async_get_data () else : _LOGGER . warning ( \"[ %s ] device instance not set for refreshData\" , self . _device_name , ) _LOGGER . debug ( \"[ %s ] pressed button %s \" , self . _device_name , self . _description , ) if not self . _updated : self . _updated = True async def async_update ( self , ** kwargs ): \"\"\"Update the entity.\"\"\" return __init__ ( api_client , device_id , device_name , sensor_type ) \u00b6 Initialize the instance. Parameters: Name Type Description Default api_client ImouAPIClient an instance ofthe API client required device_id str the device id required device_name str the device name required sensor_type str the sensor type from const BUTTON required Source code in imouapi/device_entity.py 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 def __init__ ( self , api_client : ImouAPIClient , device_id : str , device_name : str , sensor_type : str , ) -> None : \"\"\" Initialize the instance. Parameters: api_client: an instance ofthe API client device_id: the device id device_name: the device name sensor_type: the sensor type from const BUTTON \"\"\" super () . __init__ ( api_client , device_id , device_name , sensor_type , BUTTONS [ sensor_type ]) async_press () async \u00b6 Press action. Source code in imouapi/device_entity.py 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 async def async_press ( self ) -> None : \"\"\"Press action.\"\"\" if not self . _enabled : return if self . _name == \"restartDevice\" : # restart the device await self . api_client . async_api_restartDevice ( self . _device_id ) if self . _name == \"refreshData\" : # refresh the data of all the sensors of the device if self . _device_instance is not None : await self . _device_instance . async_get_data () else : _LOGGER . warning ( \"[ %s ] device instance not set for refreshData\" , self . _device_name , ) _LOGGER . debug ( \"[ %s ] pressed button %s \" , self . _device_name , self . _description , ) if not self . _updated : self . _updated = True async_update ( ** kwargs ) async \u00b6 Update the entity. Source code in imouapi/device_entity.py 385 386 387 async def async_update ( self , ** kwargs ): \"\"\"Update the entity.\"\"\" return ImouEntity \u00b6 Bases: ABC A representation of a sensor within an Imou Device. Source code in imouapi/device_entity.py 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 class ImouEntity ( ABC ): \"\"\"A representation of a sensor within an Imou Device.\"\"\" def __init__ ( self , api_client : ImouAPIClient , device_id : str , device_name : str , sensor_type : str , sensor_description : str , ) -> None : \"\"\"Initialize common parameters.\"\"\" self . api_client = api_client self . _device_id = device_id self . _device_name = device_name self . _name = sensor_type self . _description = sensor_description self . _enabled = True self . _updated = False self . _device_instance = None def get_device_id ( self ) -> str : \"\"\"Get device id.\"\"\" return self . _device_id def get_name ( self ) -> str : \"\"\"Get name.\"\"\" return self . _name def get_description ( self ) -> str : \"\"\"Get description.\"\"\" return self . _description def set_enabled ( self , value : bool ) -> None : \"\"\"Set enable.\"\"\" self . _enabled = value def is_enabled ( self ) -> bool : \"\"\"If enabled.\"\"\" return self . _enabled def is_updated ( self ) -> bool : \"\"\"If has been updated at least once.\"\"\" return self . _updated def set_device ( self , device_instance ) -> None : \"\"\"Set the device instance this entity is belonging to.\"\"\" self . _device_instance = device_instance @abstractmethod async def async_update ( self , ** kwargs ): \"\"\"Update the entity.\"\"\" __init__ ( api_client , device_id , device_name , sensor_type , sensor_description ) \u00b6 Initialize common parameters. Source code in imouapi/device_entity.py 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 def __init__ ( self , api_client : ImouAPIClient , device_id : str , device_name : str , sensor_type : str , sensor_description : str , ) -> None : \"\"\"Initialize common parameters.\"\"\" self . api_client = api_client self . _device_id = device_id self . _device_name = device_name self . _name = sensor_type self . _description = sensor_description self . _enabled = True self . _updated = False self . _device_instance = None async_update ( ** kwargs ) abstractmethod async \u00b6 Update the entity. Source code in imouapi/device_entity.py 63 64 65 @abstractmethod async def async_update ( self , ** kwargs ): \"\"\"Update the entity.\"\"\" get_description () \u00b6 Get description. Source code in imouapi/device_entity.py 43 44 45 def get_description ( self ) -> str : \"\"\"Get description.\"\"\" return self . _description get_device_id () \u00b6 Get device id. Source code in imouapi/device_entity.py 35 36 37 def get_device_id ( self ) -> str : \"\"\"Get device id.\"\"\" return self . _device_id get_name () \u00b6 Get name. Source code in imouapi/device_entity.py 39 40 41 def get_name ( self ) -> str : \"\"\"Get name.\"\"\" return self . _name is_enabled () \u00b6 If enabled. Source code in imouapi/device_entity.py 51 52 53 def is_enabled ( self ) -> bool : \"\"\"If enabled.\"\"\" return self . _enabled is_updated () \u00b6 If has been updated at least once. Source code in imouapi/device_entity.py 55 56 57 def is_updated ( self ) -> bool : \"\"\"If has been updated at least once.\"\"\" return self . _updated set_device ( device_instance ) \u00b6 Set the device instance this entity is belonging to. Source code in imouapi/device_entity.py 59 60 61 def set_device ( self , device_instance ) -> None : \"\"\"Set the device instance this entity is belonging to.\"\"\" self . _device_instance = device_instance set_enabled ( value ) \u00b6 Set enable. Source code in imouapi/device_entity.py 47 48 49 def set_enabled ( self , value : bool ) -> None : \"\"\"Set enable.\"\"\" self . _enabled = value ImouSelect \u00b6 Bases: ImouEntity A representation of a select within an IMOU Device. Source code in imouapi/device_entity.py 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 class ImouSelect ( ImouEntity ): \"\"\"A representation of a select within an IMOU Device.\"\"\" def __init__ ( self , api_client : ImouAPIClient , device_id : str , device_name : str , sensor_type : str , ) -> None : \"\"\" Initialize the instance. Parameters: api_client: an instance ofthe API client device_id: the device id device_name: the device name sensor_type: the sensor type from const SELECT \"\"\" super () . __init__ ( api_client , device_id , device_name , sensor_type , SELECT [ sensor_type ]) # keep track of the status of the sensor self . _current_option : Union [ str , None ] = None self . _available_options : list [ str ] = [] async def async_update ( self , ** kwargs ): \"\"\"Update the entity.\"\"\" if not self . _enabled : return if self . _name == \"nightVisionMode\" : # get the night vision mode option selected data = await self . api_client . async_api_getNightVisionMode ( self . _device_id ) if \"mode\" not in data or \"modes\" not in data : raise InvalidResponse ( f \"mode or modes not found in { data } \" ) self . _current_option = data [ \"mode\" ] self . _available_options = data [ \"modes\" ] _LOGGER . debug ( \"[ %s ] updating %s , value is %s \" , self . _device_name , self . _description , self . _current_option , ) if not self . _updated : self . _updated = True def get_current_option ( self ) -> Optional [ str ]: \"\"\"Return the current option.\"\"\" return self . _current_option def get_available_options ( self ) -> list [ str ]: \"\"\"Return the available options.\"\"\" return self . _available_options async def async_select_option ( self , option : str ) -> None : \"\"\"Change the selected option.\"\"\" if not self . _enabled : return _LOGGER . debug ( \"[ %s ] %s setting to %s \" , self . _device_name , self . _description , option ) if self . _name == \"nightVisionMode\" : await self . api_client . async_api_setNightVisionMode ( self . _device_id , option ) self . _current_option = option __init__ ( api_client , device_id , device_name , sensor_type ) \u00b6 Initialize the instance. Parameters: Name Type Description Default api_client ImouAPIClient an instance ofthe API client required device_id str the device id required device_name str the device name required sensor_type str the sensor type from const SELECT required Source code in imouapi/device_entity.py 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 def __init__ ( self , api_client : ImouAPIClient , device_id : str , device_name : str , sensor_type : str , ) -> None : \"\"\" Initialize the instance. Parameters: api_client: an instance ofthe API client device_id: the device id device_name: the device name sensor_type: the sensor type from const SELECT \"\"\" super () . __init__ ( api_client , device_id , device_name , sensor_type , SELECT [ sensor_type ]) # keep track of the status of the sensor self . _current_option : Union [ str , None ] = None self . _available_options : list [ str ] = [] async_select_option ( option ) async \u00b6 Change the selected option. Source code in imouapi/device_entity.py 329 330 331 332 333 334 335 336 async def async_select_option ( self , option : str ) -> None : \"\"\"Change the selected option.\"\"\" if not self . _enabled : return _LOGGER . debug ( \"[ %s ] %s setting to %s \" , self . _device_name , self . _description , option ) if self . _name == \"nightVisionMode\" : await self . api_client . async_api_setNightVisionMode ( self . _device_id , option ) self . _current_option = option async_update ( ** kwargs ) async \u00b6 Update the entity. Source code in imouapi/device_entity.py 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 async def async_update ( self , ** kwargs ): \"\"\"Update the entity.\"\"\" if not self . _enabled : return if self . _name == \"nightVisionMode\" : # get the night vision mode option selected data = await self . api_client . async_api_getNightVisionMode ( self . _device_id ) if \"mode\" not in data or \"modes\" not in data : raise InvalidResponse ( f \"mode or modes not found in { data } \" ) self . _current_option = data [ \"mode\" ] self . _available_options = data [ \"modes\" ] _LOGGER . debug ( \"[ %s ] updating %s , value is %s \" , self . _device_name , self . _description , self . _current_option , ) if not self . _updated : self . _updated = True get_available_options () \u00b6 Return the available options. Source code in imouapi/device_entity.py 325 326 327 def get_available_options ( self ) -> list [ str ]: \"\"\"Return the available options.\"\"\" return self . _available_options get_current_option () \u00b6 Return the current option. Source code in imouapi/device_entity.py 321 322 323 def get_current_option ( self ) -> Optional [ str ]: \"\"\"Return the current option.\"\"\" return self . _current_option ImouSensor \u00b6 Bases: ImouEntity A representation of a sensor within an IMOU Device. Source code in imouapi/device_entity.py 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 class ImouSensor ( ImouEntity ): \"\"\"A representation of a sensor within an IMOU Device.\"\"\" def __init__ ( self , api_client : ImouAPIClient , device_id : str , device_name : str , sensor_type : str , ) -> None : \"\"\" Initialize the instance. Parameters: api_client: an instance ofthe API client device_id: the device id device_name: the device name sensor_type: the sensor type from const SENSORS \"\"\" super () . __init__ ( api_client , device_id , device_name , sensor_type , SENSORS [ sensor_type ]) # keep track of the status of the sensor self . _state = None async def async_update ( self , ** kwargs ): \"\"\"Update the entity.\"\"\" if not self . _enabled : return # lastAlarm sensor if self . _name == \"lastAlarm\" : # get the time of the last alarm data = await self . api_client . async_api_getAlarmMessage ( self . _device_id ) if \"alarms\" not in data : raise InvalidResponse ( f \"alarms not found in { data } \" ) if len ( data [ \"alarms\" ]) > 0 : alarm = data [ \"alarms\" ][ 0 ] if \"time\" not in alarm : raise InvalidResponse ( f \"time not found in { alarm } \" ) # convert it into ISO 8601 and store it iso_time = datetime . utcfromtimestamp ( alarm [ \"time\" ]) . isoformat () self . _state = iso_time # storageUsed sensor elif self . _name == \"storageUsed\" : # get SD card status data = await self . api_client . async_api_deviceSdcardStatus ( self . _device_id ) if \"status\" not in data : raise InvalidResponse ( f \"status not found in { data } \" ) if data [ \"status\" ] == \"normal\" : # get the storage status data = await self . api_client . async_api_deviceStorage ( self . _device_id ) if \"totalBytes\" not in data or \"usedBytes\" not in data : raise InvalidResponse ( f \"totalBytes or usedBytes not found in { data } \" ) percentage_used = int ( data [ \"usedBytes\" ] * 100 / data [ \"totalBytes\" ]) self . _state = percentage_used # callbackUrl sensor elif self . _name == \"callbackUrl\" : # get callback url data = await self . api_client . async_api_getMessageCallback () if \"callbackUrl\" not in data : raise InvalidResponse ( f \"callbackUrl not found in { data } \" ) self . _state = data [ \"callbackUrl\" ] _LOGGER . debug ( \"[ %s ] updating %s , value is %s \" , self . _device_name , self . _description , self . _state , ) if not self . _updated : self . _updated = True def get_state ( self ) -> Optional [ str ]: \"\"\"Return the state.\"\"\" return self . _state __init__ ( api_client , device_id , device_name , sensor_type ) \u00b6 Initialize the instance. Parameters: Name Type Description Default api_client ImouAPIClient an instance ofthe API client required device_id str the device id required device_name str the device name required sensor_type str the sensor type from const SENSORS required Source code in imouapi/device_entity.py 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 def __init__ ( self , api_client : ImouAPIClient , device_id : str , device_name : str , sensor_type : str , ) -> None : \"\"\" Initialize the instance. Parameters: api_client: an instance ofthe API client device_id: the device id device_name: the device name sensor_type: the sensor type from const SENSORS \"\"\" super () . __init__ ( api_client , device_id , device_name , sensor_type , SENSORS [ sensor_type ]) # keep track of the status of the sensor self . _state = None async_update ( ** kwargs ) async \u00b6 Update the entity. Source code in imouapi/device_entity.py 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 async def async_update ( self , ** kwargs ): \"\"\"Update the entity.\"\"\" if not self . _enabled : return # lastAlarm sensor if self . _name == \"lastAlarm\" : # get the time of the last alarm data = await self . api_client . async_api_getAlarmMessage ( self . _device_id ) if \"alarms\" not in data : raise InvalidResponse ( f \"alarms not found in { data } \" ) if len ( data [ \"alarms\" ]) > 0 : alarm = data [ \"alarms\" ][ 0 ] if \"time\" not in alarm : raise InvalidResponse ( f \"time not found in { alarm } \" ) # convert it into ISO 8601 and store it iso_time = datetime . utcfromtimestamp ( alarm [ \"time\" ]) . isoformat () self . _state = iso_time # storageUsed sensor elif self . _name == \"storageUsed\" : # get SD card status data = await self . api_client . async_api_deviceSdcardStatus ( self . _device_id ) if \"status\" not in data : raise InvalidResponse ( f \"status not found in { data } \" ) if data [ \"status\" ] == \"normal\" : # get the storage status data = await self . api_client . async_api_deviceStorage ( self . _device_id ) if \"totalBytes\" not in data or \"usedBytes\" not in data : raise InvalidResponse ( f \"totalBytes or usedBytes not found in { data } \" ) percentage_used = int ( data [ \"usedBytes\" ] * 100 / data [ \"totalBytes\" ]) self . _state = percentage_used # callbackUrl sensor elif self . _name == \"callbackUrl\" : # get callback url data = await self . api_client . async_api_getMessageCallback () if \"callbackUrl\" not in data : raise InvalidResponse ( f \"callbackUrl not found in { data } \" ) self . _state = data [ \"callbackUrl\" ] _LOGGER . debug ( \"[ %s ] updating %s , value is %s \" , self . _device_name , self . _description , self . _state , ) if not self . _updated : self . _updated = True get_state () \u00b6 Return the state. Source code in imouapi/device_entity.py 140 141 142 def get_state ( self ) -> Optional [ str ]: \"\"\"Return the state.\"\"\" return self . _state ImouSwitch \u00b6 Bases: ImouEntity A representation of a switch within an IMOU Device. Source code in imouapi/device_entity.py 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 class ImouSwitch ( ImouEntity ): \"\"\"A representation of a switch within an IMOU Device.\"\"\" def __init__ ( self , api_client : ImouAPIClient , device_id : str , device_name : str , sensor_type : str , ) -> None : \"\"\" Initialize the instance. Parameters: api_client: an instance ofthe API client device_id: the device id device_name: the device name sensor_type: the sensor type (from the SWITCHES constant) \"\"\" super () . __init__ ( api_client , device_id , device_name , sensor_type , IMOU_SWITCHES [ sensor_type ]) self . _state = None async def async_update ( self , ** kwargs ): \"\"\"Update the entity.\"\"\" if not self . _enabled : return # pushNotifications sensor if self . _name == \"pushNotifications\" : data = await self . api_client . async_api_getMessageCallback () # all the other dynamically created sensors else : data = await self . api_client . async_api_getDeviceCameraStatus ( self . _device_id , self . _name ) _LOGGER . debug ( \"[ %s ] updating %s , value is %s \" , self . _device_name , self . _description , data [ \"status\" ] . upper (), ) self . _state = data [ \"status\" ] == \"on\" if not self . _updated : self . _updated = True def is_on ( self ) -> Optional [ bool ]: \"\"\"Return the status of the switch.\"\"\" return self . _state async def async_turn_on ( self , ** kwargs ): \"\"\"Turn the entity on.\"\"\" if not self . _enabled : return _LOGGER . debug ( \"[ %s ] %s requested to turn ON ( %s )\" , self . _device_name , self . _description , kwargs ) # pushNotifications sensor if self . _name == \"pushNotifications\" : if \"url\" not in kwargs : raise APIError ( \"url not provided\" ) await self . api_client . async_api_setMessageCallbackOn ( kwargs . get ( \"url\" )) # all the other dynamically created sensors else : await self . api_client . async_api_setDeviceCameraStatus ( self . _device_id , self . _name , True ) self . _state = True async def async_turn_off ( self , ** kwargs ): \"\"\"Turn the entity off.\"\"\" if not self . _enabled : return _LOGGER . debug ( \"[ %s ] %s requested to turn OFF ( %s )\" , self . _device_name , self . _description , kwargs ) if self . _name == \"pushNotifications\" : await self . api_client . async_api_setMessageCallbackOff () # all the other dynamically created sensors else : await self . api_client . async_api_setDeviceCameraStatus ( self . _device_id , self . _name , False ) self . _state = False async def async_toggle ( self , ** kwargs ): \"\"\"Toggle the entity.\"\"\" if not self . _enabled or not self . _updated : return if self . _state : await self . async_turn_off () else : await self . async_turn_on () __init__ ( api_client , device_id , device_name , sensor_type ) \u00b6 Initialize the instance. Parameters: Name Type Description Default api_client ImouAPIClient an instance ofthe API client required device_id str the device id required device_name str the device name required sensor_type str the sensor type (from the SWITCHES constant) required Source code in imouapi/device_entity.py 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 def __init__ ( self , api_client : ImouAPIClient , device_id : str , device_name : str , sensor_type : str , ) -> None : \"\"\" Initialize the instance. Parameters: api_client: an instance ofthe API client device_id: the device id device_name: the device name sensor_type: the sensor type (from the SWITCHES constant) \"\"\" super () . __init__ ( api_client , device_id , device_name , sensor_type , IMOU_SWITCHES [ sensor_type ]) self . _state = None async_toggle ( ** kwargs ) async \u00b6 Toggle the entity. Source code in imouapi/device_entity.py 267 268 269 270 271 272 273 274 async def async_toggle ( self , ** kwargs ): \"\"\"Toggle the entity.\"\"\" if not self . _enabled or not self . _updated : return if self . _state : await self . async_turn_off () else : await self . async_turn_on () async_turn_off ( ** kwargs ) async \u00b6 Turn the entity off. Source code in imouapi/device_entity.py 255 256 257 258 259 260 261 262 263 264 265 async def async_turn_off ( self , ** kwargs ): \"\"\"Turn the entity off.\"\"\" if not self . _enabled : return _LOGGER . debug ( \"[ %s ] %s requested to turn OFF ( %s )\" , self . _device_name , self . _description , kwargs ) if self . _name == \"pushNotifications\" : await self . api_client . async_api_setMessageCallbackOff () # all the other dynamically created sensors else : await self . api_client . async_api_setDeviceCameraStatus ( self . _device_id , self . _name , False ) self . _state = False async_turn_on ( ** kwargs ) async \u00b6 Turn the entity on. Source code in imouapi/device_entity.py 240 241 242 243 244 245 246 247 248 249 250 251 252 253 async def async_turn_on ( self , ** kwargs ): \"\"\"Turn the entity on.\"\"\" if not self . _enabled : return _LOGGER . debug ( \"[ %s ] %s requested to turn ON ( %s )\" , self . _device_name , self . _description , kwargs ) # pushNotifications sensor if self . _name == \"pushNotifications\" : if \"url\" not in kwargs : raise APIError ( \"url not provided\" ) await self . api_client . async_api_setMessageCallbackOn ( kwargs . get ( \"url\" )) # all the other dynamically created sensors else : await self . api_client . async_api_setDeviceCameraStatus ( self . _device_id , self . _name , True ) self . _state = True async_update ( ** kwargs ) async \u00b6 Update the entity. Source code in imouapi/device_entity.py 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 async def async_update ( self , ** kwargs ): \"\"\"Update the entity.\"\"\" if not self . _enabled : return # pushNotifications sensor if self . _name == \"pushNotifications\" : data = await self . api_client . async_api_getMessageCallback () # all the other dynamically created sensors else : data = await self . api_client . async_api_getDeviceCameraStatus ( self . _device_id , self . _name ) _LOGGER . debug ( \"[ %s ] updating %s , value is %s \" , self . _device_name , self . _description , data [ \"status\" ] . upper (), ) self . _state = data [ \"status\" ] == \"on\" if not self . _updated : self . _updated = True is_on () \u00b6 Return the status of the switch. Source code in imouapi/device_entity.py 236 237 238 def is_on ( self ) -> Optional [ bool ]: \"\"\"Return the status of the switch.\"\"\" return self . _state","title":"device_entity"},{"location":"modules/device_entity/#imouapi.device_entity.ImouBinarySensor","text":"Bases: ImouEntity A representation of a sensor within an IMOU Device. Source code in imouapi/device_entity.py 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 class ImouBinarySensor ( ImouEntity ): \"\"\"A representation of a sensor within an IMOU Device.\"\"\" def __init__ ( self , api_client : ImouAPIClient , device_id : str , device_name : str , sensor_type : str , ) -> None : \"\"\" Initialize the instance. Parameters: api_client: an instance ofthe API client device_id: the device id device_name: the device name sensor_type: the sensor type from const BINARY_SENSORS \"\"\" super () . __init__ ( api_client , device_id , device_name , sensor_type , BINARY_SENSORS [ sensor_type ]) # keep track of the status of the sensor self . _state = None async def async_update ( self , ** kwargs ): \"\"\"Update the entity.\"\"\" if not self . _enabled : return # online sensor if self . _name == \"online\" : # get the online status data = await self . api_client . async_api_deviceOnline ( self . _device_id ) if \"onLine\" not in data : raise InvalidResponse ( f \"onLine not found in { data } \" ) self . _state = data [ \"onLine\" ] == \"1\" _LOGGER . debug ( \"[ %s ] updating %s , value is %s \" , self . _device_name , self . _description , self . _state , ) if not self . _updated : self . _updated = True def is_on ( self ) -> Optional [ bool ]: \"\"\"Return the status of the switch.\"\"\" return self . _state","title":"ImouBinarySensor"},{"location":"modules/device_entity/#imouapi.device_entity.ImouBinarySensor.__init__","text":"Initialize the instance. Parameters: Name Type Description Default api_client ImouAPIClient an instance ofthe API client required device_id str the device id required device_name str the device name required sensor_type str the sensor type from const BINARY_SENSORS required Source code in imouapi/device_entity.py 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 def __init__ ( self , api_client : ImouAPIClient , device_id : str , device_name : str , sensor_type : str , ) -> None : \"\"\" Initialize the instance. Parameters: api_client: an instance ofthe API client device_id: the device id device_name: the device name sensor_type: the sensor type from const BINARY_SENSORS \"\"\" super () . __init__ ( api_client , device_id , device_name , sensor_type , BINARY_SENSORS [ sensor_type ]) # keep track of the status of the sensor self . _state = None","title":"__init__()"},{"location":"modules/device_entity/#imouapi.device_entity.ImouBinarySensor.async_update","text":"Update the entity. Source code in imouapi/device_entity.py 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 async def async_update ( self , ** kwargs ): \"\"\"Update the entity.\"\"\" if not self . _enabled : return # online sensor if self . _name == \"online\" : # get the online status data = await self . api_client . async_api_deviceOnline ( self . _device_id ) if \"onLine\" not in data : raise InvalidResponse ( f \"onLine not found in { data } \" ) self . _state = data [ \"onLine\" ] == \"1\" _LOGGER . debug ( \"[ %s ] updating %s , value is %s \" , self . _device_name , self . _description , self . _state , ) if not self . _updated : self . _updated = True","title":"async_update()"},{"location":"modules/device_entity/#imouapi.device_entity.ImouBinarySensor.is_on","text":"Return the status of the switch. Source code in imouapi/device_entity.py 189 190 191 def is_on ( self ) -> Optional [ bool ]: \"\"\"Return the status of the switch.\"\"\" return self . _state","title":"is_on()"},{"location":"modules/device_entity/#imouapi.device_entity.ImouButton","text":"Bases: ImouEntity A representation of a button within an IMOU Device. Source code in imouapi/device_entity.py 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 class ImouButton ( ImouEntity ): \"\"\"A representation of a button within an IMOU Device.\"\"\" def __init__ ( self , api_client : ImouAPIClient , device_id : str , device_name : str , sensor_type : str , ) -> None : \"\"\" Initialize the instance. Parameters: api_client: an instance ofthe API client device_id: the device id device_name: the device name sensor_type: the sensor type from const BUTTON \"\"\" super () . __init__ ( api_client , device_id , device_name , sensor_type , BUTTONS [ sensor_type ]) async def async_press ( self ) -> None : \"\"\"Press action.\"\"\" if not self . _enabled : return if self . _name == \"restartDevice\" : # restart the device await self . api_client . async_api_restartDevice ( self . _device_id ) if self . _name == \"refreshData\" : # refresh the data of all the sensors of the device if self . _device_instance is not None : await self . _device_instance . async_get_data () else : _LOGGER . warning ( \"[ %s ] device instance not set for refreshData\" , self . _device_name , ) _LOGGER . debug ( \"[ %s ] pressed button %s \" , self . _device_name , self . _description , ) if not self . _updated : self . _updated = True async def async_update ( self , ** kwargs ): \"\"\"Update the entity.\"\"\" return","title":"ImouButton"},{"location":"modules/device_entity/#imouapi.device_entity.ImouButton.__init__","text":"Initialize the instance. Parameters: Name Type Description Default api_client ImouAPIClient an instance ofthe API client required device_id str the device id required device_name str the device name required sensor_type str the sensor type from const BUTTON required Source code in imouapi/device_entity.py 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 def __init__ ( self , api_client : ImouAPIClient , device_id : str , device_name : str , sensor_type : str , ) -> None : \"\"\" Initialize the instance. Parameters: api_client: an instance ofthe API client device_id: the device id device_name: the device name sensor_type: the sensor type from const BUTTON \"\"\" super () . __init__ ( api_client , device_id , device_name , sensor_type , BUTTONS [ sensor_type ])","title":"__init__()"},{"location":"modules/device_entity/#imouapi.device_entity.ImouButton.async_press","text":"Press action. Source code in imouapi/device_entity.py 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 async def async_press ( self ) -> None : \"\"\"Press action.\"\"\" if not self . _enabled : return if self . _name == \"restartDevice\" : # restart the device await self . api_client . async_api_restartDevice ( self . _device_id ) if self . _name == \"refreshData\" : # refresh the data of all the sensors of the device if self . _device_instance is not None : await self . _device_instance . async_get_data () else : _LOGGER . warning ( \"[ %s ] device instance not set for refreshData\" , self . _device_name , ) _LOGGER . debug ( \"[ %s ] pressed button %s \" , self . _device_name , self . _description , ) if not self . _updated : self . _updated = True","title":"async_press()"},{"location":"modules/device_entity/#imouapi.device_entity.ImouButton.async_update","text":"Update the entity. Source code in imouapi/device_entity.py 385 386 387 async def async_update ( self , ** kwargs ): \"\"\"Update the entity.\"\"\" return","title":"async_update()"},{"location":"modules/device_entity/#imouapi.device_entity.ImouEntity","text":"Bases: ABC A representation of a sensor within an Imou Device. Source code in imouapi/device_entity.py 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 class ImouEntity ( ABC ): \"\"\"A representation of a sensor within an Imou Device.\"\"\" def __init__ ( self , api_client : ImouAPIClient , device_id : str , device_name : str , sensor_type : str , sensor_description : str , ) -> None : \"\"\"Initialize common parameters.\"\"\" self . api_client = api_client self . _device_id = device_id self . _device_name = device_name self . _name = sensor_type self . _description = sensor_description self . _enabled = True self . _updated = False self . _device_instance = None def get_device_id ( self ) -> str : \"\"\"Get device id.\"\"\" return self . _device_id def get_name ( self ) -> str : \"\"\"Get name.\"\"\" return self . _name def get_description ( self ) -> str : \"\"\"Get description.\"\"\" return self . _description def set_enabled ( self , value : bool ) -> None : \"\"\"Set enable.\"\"\" self . _enabled = value def is_enabled ( self ) -> bool : \"\"\"If enabled.\"\"\" return self . _enabled def is_updated ( self ) -> bool : \"\"\"If has been updated at least once.\"\"\" return self . _updated def set_device ( self , device_instance ) -> None : \"\"\"Set the device instance this entity is belonging to.\"\"\" self . _device_instance = device_instance @abstractmethod async def async_update ( self , ** kwargs ): \"\"\"Update the entity.\"\"\"","title":"ImouEntity"},{"location":"modules/device_entity/#imouapi.device_entity.ImouEntity.__init__","text":"Initialize common parameters. Source code in imouapi/device_entity.py 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 def __init__ ( self , api_client : ImouAPIClient , device_id : str , device_name : str , sensor_type : str , sensor_description : str , ) -> None : \"\"\"Initialize common parameters.\"\"\" self . api_client = api_client self . _device_id = device_id self . _device_name = device_name self . _name = sensor_type self . _description = sensor_description self . _enabled = True self . _updated = False self . _device_instance = None","title":"__init__()"},{"location":"modules/device_entity/#imouapi.device_entity.ImouEntity.async_update","text":"Update the entity. Source code in imouapi/device_entity.py 63 64 65 @abstractmethod async def async_update ( self , ** kwargs ): \"\"\"Update the entity.\"\"\"","title":"async_update()"},{"location":"modules/device_entity/#imouapi.device_entity.ImouEntity.get_description","text":"Get description. Source code in imouapi/device_entity.py 43 44 45 def get_description ( self ) -> str : \"\"\"Get description.\"\"\" return self . _description","title":"get_description()"},{"location":"modules/device_entity/#imouapi.device_entity.ImouEntity.get_device_id","text":"Get device id. Source code in imouapi/device_entity.py 35 36 37 def get_device_id ( self ) -> str : \"\"\"Get device id.\"\"\" return self . _device_id","title":"get_device_id()"},{"location":"modules/device_entity/#imouapi.device_entity.ImouEntity.get_name","text":"Get name. Source code in imouapi/device_entity.py 39 40 41 def get_name ( self ) -> str : \"\"\"Get name.\"\"\" return self . _name","title":"get_name()"},{"location":"modules/device_entity/#imouapi.device_entity.ImouEntity.is_enabled","text":"If enabled. Source code in imouapi/device_entity.py 51 52 53 def is_enabled ( self ) -> bool : \"\"\"If enabled.\"\"\" return self . _enabled","title":"is_enabled()"},{"location":"modules/device_entity/#imouapi.device_entity.ImouEntity.is_updated","text":"If has been updated at least once. Source code in imouapi/device_entity.py 55 56 57 def is_updated ( self ) -> bool : \"\"\"If has been updated at least once.\"\"\" return self . _updated","title":"is_updated()"},{"location":"modules/device_entity/#imouapi.device_entity.ImouEntity.set_device","text":"Set the device instance this entity is belonging to. Source code in imouapi/device_entity.py 59 60 61 def set_device ( self , device_instance ) -> None : \"\"\"Set the device instance this entity is belonging to.\"\"\" self . _device_instance = device_instance","title":"set_device()"},{"location":"modules/device_entity/#imouapi.device_entity.ImouEntity.set_enabled","text":"Set enable. Source code in imouapi/device_entity.py 47 48 49 def set_enabled ( self , value : bool ) -> None : \"\"\"Set enable.\"\"\" self . _enabled = value","title":"set_enabled()"},{"location":"modules/device_entity/#imouapi.device_entity.ImouSelect","text":"Bases: ImouEntity A representation of a select within an IMOU Device. Source code in imouapi/device_entity.py 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 class ImouSelect ( ImouEntity ): \"\"\"A representation of a select within an IMOU Device.\"\"\" def __init__ ( self , api_client : ImouAPIClient , device_id : str , device_name : str , sensor_type : str , ) -> None : \"\"\" Initialize the instance. Parameters: api_client: an instance ofthe API client device_id: the device id device_name: the device name sensor_type: the sensor type from const SELECT \"\"\" super () . __init__ ( api_client , device_id , device_name , sensor_type , SELECT [ sensor_type ]) # keep track of the status of the sensor self . _current_option : Union [ str , None ] = None self . _available_options : list [ str ] = [] async def async_update ( self , ** kwargs ): \"\"\"Update the entity.\"\"\" if not self . _enabled : return if self . _name == \"nightVisionMode\" : # get the night vision mode option selected data = await self . api_client . async_api_getNightVisionMode ( self . _device_id ) if \"mode\" not in data or \"modes\" not in data : raise InvalidResponse ( f \"mode or modes not found in { data } \" ) self . _current_option = data [ \"mode\" ] self . _available_options = data [ \"modes\" ] _LOGGER . debug ( \"[ %s ] updating %s , value is %s \" , self . _device_name , self . _description , self . _current_option , ) if not self . _updated : self . _updated = True def get_current_option ( self ) -> Optional [ str ]: \"\"\"Return the current option.\"\"\" return self . _current_option def get_available_options ( self ) -> list [ str ]: \"\"\"Return the available options.\"\"\" return self . _available_options async def async_select_option ( self , option : str ) -> None : \"\"\"Change the selected option.\"\"\" if not self . _enabled : return _LOGGER . debug ( \"[ %s ] %s setting to %s \" , self . _device_name , self . _description , option ) if self . _name == \"nightVisionMode\" : await self . api_client . async_api_setNightVisionMode ( self . _device_id , option ) self . _current_option = option","title":"ImouSelect"},{"location":"modules/device_entity/#imouapi.device_entity.ImouSelect.__init__","text":"Initialize the instance. Parameters: Name Type Description Default api_client ImouAPIClient an instance ofthe API client required device_id str the device id required device_name str the device name required sensor_type str the sensor type from const SELECT required Source code in imouapi/device_entity.py 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 def __init__ ( self , api_client : ImouAPIClient , device_id : str , device_name : str , sensor_type : str , ) -> None : \"\"\" Initialize the instance. Parameters: api_client: an instance ofthe API client device_id: the device id device_name: the device name sensor_type: the sensor type from const SELECT \"\"\" super () . __init__ ( api_client , device_id , device_name , sensor_type , SELECT [ sensor_type ]) # keep track of the status of the sensor self . _current_option : Union [ str , None ] = None self . _available_options : list [ str ] = []","title":"__init__()"},{"location":"modules/device_entity/#imouapi.device_entity.ImouSelect.async_select_option","text":"Change the selected option. Source code in imouapi/device_entity.py 329 330 331 332 333 334 335 336 async def async_select_option ( self , option : str ) -> None : \"\"\"Change the selected option.\"\"\" if not self . _enabled : return _LOGGER . debug ( \"[ %s ] %s setting to %s \" , self . _device_name , self . _description , option ) if self . _name == \"nightVisionMode\" : await self . api_client . async_api_setNightVisionMode ( self . _device_id , option ) self . _current_option = option","title":"async_select_option()"},{"location":"modules/device_entity/#imouapi.device_entity.ImouSelect.async_update","text":"Update the entity. Source code in imouapi/device_entity.py 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 async def async_update ( self , ** kwargs ): \"\"\"Update the entity.\"\"\" if not self . _enabled : return if self . _name == \"nightVisionMode\" : # get the night vision mode option selected data = await self . api_client . async_api_getNightVisionMode ( self . _device_id ) if \"mode\" not in data or \"modes\" not in data : raise InvalidResponse ( f \"mode or modes not found in { data } \" ) self . _current_option = data [ \"mode\" ] self . _available_options = data [ \"modes\" ] _LOGGER . debug ( \"[ %s ] updating %s , value is %s \" , self . _device_name , self . _description , self . _current_option , ) if not self . _updated : self . _updated = True","title":"async_update()"},{"location":"modules/device_entity/#imouapi.device_entity.ImouSelect.get_available_options","text":"Return the available options. Source code in imouapi/device_entity.py 325 326 327 def get_available_options ( self ) -> list [ str ]: \"\"\"Return the available options.\"\"\" return self . _available_options","title":"get_available_options()"},{"location":"modules/device_entity/#imouapi.device_entity.ImouSelect.get_current_option","text":"Return the current option. Source code in imouapi/device_entity.py 321 322 323 def get_current_option ( self ) -> Optional [ str ]: \"\"\"Return the current option.\"\"\" return self . _current_option","title":"get_current_option()"},{"location":"modules/device_entity/#imouapi.device_entity.ImouSensor","text":"Bases: ImouEntity A representation of a sensor within an IMOU Device. Source code in imouapi/device_entity.py 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 class ImouSensor ( ImouEntity ): \"\"\"A representation of a sensor within an IMOU Device.\"\"\" def __init__ ( self , api_client : ImouAPIClient , device_id : str , device_name : str , sensor_type : str , ) -> None : \"\"\" Initialize the instance. Parameters: api_client: an instance ofthe API client device_id: the device id device_name: the device name sensor_type: the sensor type from const SENSORS \"\"\" super () . __init__ ( api_client , device_id , device_name , sensor_type , SENSORS [ sensor_type ]) # keep track of the status of the sensor self . _state = None async def async_update ( self , ** kwargs ): \"\"\"Update the entity.\"\"\" if not self . _enabled : return # lastAlarm sensor if self . _name == \"lastAlarm\" : # get the time of the last alarm data = await self . api_client . async_api_getAlarmMessage ( self . _device_id ) if \"alarms\" not in data : raise InvalidResponse ( f \"alarms not found in { data } \" ) if len ( data [ \"alarms\" ]) > 0 : alarm = data [ \"alarms\" ][ 0 ] if \"time\" not in alarm : raise InvalidResponse ( f \"time not found in { alarm } \" ) # convert it into ISO 8601 and store it iso_time = datetime . utcfromtimestamp ( alarm [ \"time\" ]) . isoformat () self . _state = iso_time # storageUsed sensor elif self . _name == \"storageUsed\" : # get SD card status data = await self . api_client . async_api_deviceSdcardStatus ( self . _device_id ) if \"status\" not in data : raise InvalidResponse ( f \"status not found in { data } \" ) if data [ \"status\" ] == \"normal\" : # get the storage status data = await self . api_client . async_api_deviceStorage ( self . _device_id ) if \"totalBytes\" not in data or \"usedBytes\" not in data : raise InvalidResponse ( f \"totalBytes or usedBytes not found in { data } \" ) percentage_used = int ( data [ \"usedBytes\" ] * 100 / data [ \"totalBytes\" ]) self . _state = percentage_used # callbackUrl sensor elif self . _name == \"callbackUrl\" : # get callback url data = await self . api_client . async_api_getMessageCallback () if \"callbackUrl\" not in data : raise InvalidResponse ( f \"callbackUrl not found in { data } \" ) self . _state = data [ \"callbackUrl\" ] _LOGGER . debug ( \"[ %s ] updating %s , value is %s \" , self . _device_name , self . _description , self . _state , ) if not self . _updated : self . _updated = True def get_state ( self ) -> Optional [ str ]: \"\"\"Return the state.\"\"\" return self . _state","title":"ImouSensor"},{"location":"modules/device_entity/#imouapi.device_entity.ImouSensor.__init__","text":"Initialize the instance. Parameters: Name Type Description Default api_client ImouAPIClient an instance ofthe API client required device_id str the device id required device_name str the device name required sensor_type str the sensor type from const SENSORS required Source code in imouapi/device_entity.py 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 def __init__ ( self , api_client : ImouAPIClient , device_id : str , device_name : str , sensor_type : str , ) -> None : \"\"\" Initialize the instance. Parameters: api_client: an instance ofthe API client device_id: the device id device_name: the device name sensor_type: the sensor type from const SENSORS \"\"\" super () . __init__ ( api_client , device_id , device_name , sensor_type , SENSORS [ sensor_type ]) # keep track of the status of the sensor self . _state = None","title":"__init__()"},{"location":"modules/device_entity/#imouapi.device_entity.ImouSensor.async_update","text":"Update the entity. Source code in imouapi/device_entity.py 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 async def async_update ( self , ** kwargs ): \"\"\"Update the entity.\"\"\" if not self . _enabled : return # lastAlarm sensor if self . _name == \"lastAlarm\" : # get the time of the last alarm data = await self . api_client . async_api_getAlarmMessage ( self . _device_id ) if \"alarms\" not in data : raise InvalidResponse ( f \"alarms not found in { data } \" ) if len ( data [ \"alarms\" ]) > 0 : alarm = data [ \"alarms\" ][ 0 ] if \"time\" not in alarm : raise InvalidResponse ( f \"time not found in { alarm } \" ) # convert it into ISO 8601 and store it iso_time = datetime . utcfromtimestamp ( alarm [ \"time\" ]) . isoformat () self . _state = iso_time # storageUsed sensor elif self . _name == \"storageUsed\" : # get SD card status data = await self . api_client . async_api_deviceSdcardStatus ( self . _device_id ) if \"status\" not in data : raise InvalidResponse ( f \"status not found in { data } \" ) if data [ \"status\" ] == \"normal\" : # get the storage status data = await self . api_client . async_api_deviceStorage ( self . _device_id ) if \"totalBytes\" not in data or \"usedBytes\" not in data : raise InvalidResponse ( f \"totalBytes or usedBytes not found in { data } \" ) percentage_used = int ( data [ \"usedBytes\" ] * 100 / data [ \"totalBytes\" ]) self . _state = percentage_used # callbackUrl sensor elif self . _name == \"callbackUrl\" : # get callback url data = await self . api_client . async_api_getMessageCallback () if \"callbackUrl\" not in data : raise InvalidResponse ( f \"callbackUrl not found in { data } \" ) self . _state = data [ \"callbackUrl\" ] _LOGGER . debug ( \"[ %s ] updating %s , value is %s \" , self . _device_name , self . _description , self . _state , ) if not self . _updated : self . _updated = True","title":"async_update()"},{"location":"modules/device_entity/#imouapi.device_entity.ImouSensor.get_state","text":"Return the state. Source code in imouapi/device_entity.py 140 141 142 def get_state ( self ) -> Optional [ str ]: \"\"\"Return the state.\"\"\" return self . _state","title":"get_state()"},{"location":"modules/device_entity/#imouapi.device_entity.ImouSwitch","text":"Bases: ImouEntity A representation of a switch within an IMOU Device. Source code in imouapi/device_entity.py 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 class ImouSwitch ( ImouEntity ): \"\"\"A representation of a switch within an IMOU Device.\"\"\" def __init__ ( self , api_client : ImouAPIClient , device_id : str , device_name : str , sensor_type : str , ) -> None : \"\"\" Initialize the instance. Parameters: api_client: an instance ofthe API client device_id: the device id device_name: the device name sensor_type: the sensor type (from the SWITCHES constant) \"\"\" super () . __init__ ( api_client , device_id , device_name , sensor_type , IMOU_SWITCHES [ sensor_type ]) self . _state = None async def async_update ( self , ** kwargs ): \"\"\"Update the entity.\"\"\" if not self . _enabled : return # pushNotifications sensor if self . _name == \"pushNotifications\" : data = await self . api_client . async_api_getMessageCallback () # all the other dynamically created sensors else : data = await self . api_client . async_api_getDeviceCameraStatus ( self . _device_id , self . _name ) _LOGGER . debug ( \"[ %s ] updating %s , value is %s \" , self . _device_name , self . _description , data [ \"status\" ] . upper (), ) self . _state = data [ \"status\" ] == \"on\" if not self . _updated : self . _updated = True def is_on ( self ) -> Optional [ bool ]: \"\"\"Return the status of the switch.\"\"\" return self . _state async def async_turn_on ( self , ** kwargs ): \"\"\"Turn the entity on.\"\"\" if not self . _enabled : return _LOGGER . debug ( \"[ %s ] %s requested to turn ON ( %s )\" , self . _device_name , self . _description , kwargs ) # pushNotifications sensor if self . _name == \"pushNotifications\" : if \"url\" not in kwargs : raise APIError ( \"url not provided\" ) await self . api_client . async_api_setMessageCallbackOn ( kwargs . get ( \"url\" )) # all the other dynamically created sensors else : await self . api_client . async_api_setDeviceCameraStatus ( self . _device_id , self . _name , True ) self . _state = True async def async_turn_off ( self , ** kwargs ): \"\"\"Turn the entity off.\"\"\" if not self . _enabled : return _LOGGER . debug ( \"[ %s ] %s requested to turn OFF ( %s )\" , self . _device_name , self . _description , kwargs ) if self . _name == \"pushNotifications\" : await self . api_client . async_api_setMessageCallbackOff () # all the other dynamically created sensors else : await self . api_client . async_api_setDeviceCameraStatus ( self . _device_id , self . _name , False ) self . _state = False async def async_toggle ( self , ** kwargs ): \"\"\"Toggle the entity.\"\"\" if not self . _enabled or not self . _updated : return if self . _state : await self . async_turn_off () else : await self . async_turn_on ()","title":"ImouSwitch"},{"location":"modules/device_entity/#imouapi.device_entity.ImouSwitch.__init__","text":"Initialize the instance. Parameters: Name Type Description Default api_client ImouAPIClient an instance ofthe API client required device_id str the device id required device_name str the device name required sensor_type str the sensor type (from the SWITCHES constant) required Source code in imouapi/device_entity.py 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 def __init__ ( self , api_client : ImouAPIClient , device_id : str , device_name : str , sensor_type : str , ) -> None : \"\"\" Initialize the instance. Parameters: api_client: an instance ofthe API client device_id: the device id device_name: the device name sensor_type: the sensor type (from the SWITCHES constant) \"\"\" super () . __init__ ( api_client , device_id , device_name , sensor_type , IMOU_SWITCHES [ sensor_type ]) self . _state = None","title":"__init__()"},{"location":"modules/device_entity/#imouapi.device_entity.ImouSwitch.async_toggle","text":"Toggle the entity. Source code in imouapi/device_entity.py 267 268 269 270 271 272 273 274 async def async_toggle ( self , ** kwargs ): \"\"\"Toggle the entity.\"\"\" if not self . _enabled or not self . _updated : return if self . _state : await self . async_turn_off () else : await self . async_turn_on ()","title":"async_toggle()"},{"location":"modules/device_entity/#imouapi.device_entity.ImouSwitch.async_turn_off","text":"Turn the entity off. Source code in imouapi/device_entity.py 255 256 257 258 259 260 261 262 263 264 265 async def async_turn_off ( self , ** kwargs ): \"\"\"Turn the entity off.\"\"\" if not self . _enabled : return _LOGGER . debug ( \"[ %s ] %s requested to turn OFF ( %s )\" , self . _device_name , self . _description , kwargs ) if self . _name == \"pushNotifications\" : await self . api_client . async_api_setMessageCallbackOff () # all the other dynamically created sensors else : await self . api_client . async_api_setDeviceCameraStatus ( self . _device_id , self . _name , False ) self . _state = False","title":"async_turn_off()"},{"location":"modules/device_entity/#imouapi.device_entity.ImouSwitch.async_turn_on","text":"Turn the entity on. Source code in imouapi/device_entity.py 240 241 242 243 244 245 246 247 248 249 250 251 252 253 async def async_turn_on ( self , ** kwargs ): \"\"\"Turn the entity on.\"\"\" if not self . _enabled : return _LOGGER . debug ( \"[ %s ] %s requested to turn ON ( %s )\" , self . _device_name , self . _description , kwargs ) # pushNotifications sensor if self . _name == \"pushNotifications\" : if \"url\" not in kwargs : raise APIError ( \"url not provided\" ) await self . api_client . async_api_setMessageCallbackOn ( kwargs . get ( \"url\" )) # all the other dynamically created sensors else : await self . api_client . async_api_setDeviceCameraStatus ( self . _device_id , self . _name , True ) self . _state = True","title":"async_turn_on()"},{"location":"modules/device_entity/#imouapi.device_entity.ImouSwitch.async_update","text":"Update the entity. Source code in imouapi/device_entity.py 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 async def async_update ( self , ** kwargs ): \"\"\"Update the entity.\"\"\" if not self . _enabled : return # pushNotifications sensor if self . _name == \"pushNotifications\" : data = await self . api_client . async_api_getMessageCallback () # all the other dynamically created sensors else : data = await self . api_client . async_api_getDeviceCameraStatus ( self . _device_id , self . _name ) _LOGGER . debug ( \"[ %s ] updating %s , value is %s \" , self . _device_name , self . _description , data [ \"status\" ] . upper (), ) self . _state = data [ \"status\" ] == \"on\" if not self . _updated : self . _updated = True","title":"async_update()"},{"location":"modules/device_entity/#imouapi.device_entity.ImouSwitch.is_on","text":"Return the status of the switch. Source code in imouapi/device_entity.py 236 237 238 def is_on ( self ) -> Optional [ bool ]: \"\"\"Return the status of the switch.\"\"\" return self . _state","title":"is_on()"},{"location":"modules/exceptions/","text":"Library exceptions. APIError \u00b6 Bases: ImouException Remote API error. Source code in imouapi/exceptions.py 60 61 62 63 64 65 class APIError ( ImouException ): \"\"\"Remote API error.\"\"\" def get_title ( self ) -> str : \"\"\"Return the title of the exception which will be then translated.\"\"\" return \"api_error\" get_title () \u00b6 Return the title of the exception which will be then translated. Source code in imouapi/exceptions.py 63 64 65 def get_title ( self ) -> str : \"\"\"Return the title of the exception which will be then translated.\"\"\" return \"api_error\" ConnectionFailed \u00b6 Bases: ImouException Failed to connect to the API. Source code in imouapi/exceptions.py 36 37 38 39 40 41 class ConnectionFailed ( ImouException ): \"\"\"Failed to connect to the API.\"\"\" def get_title ( self ) -> str : \"\"\"Return the title of the exception which will be then translated.\"\"\" return \"connection_failed\" get_title () \u00b6 Return the title of the exception which will be then translated. Source code in imouapi/exceptions.py 39 40 41 def get_title ( self ) -> str : \"\"\"Return the title of the exception which will be then translated.\"\"\" return \"connection_failed\" DeviceOffline \u00b6 Bases: ImouException Device is offline. Source code in imouapi/exceptions.py 76 77 78 79 80 81 class DeviceOffline ( ImouException ): \"\"\"Device is offline.\"\"\" def get_title ( self ) -> str : \"\"\"Return the title of the exception which will be then translated.\"\"\" return \"device_offline\" get_title () \u00b6 Return the title of the exception which will be then translated. Source code in imouapi/exceptions.py 79 80 81 def get_title ( self ) -> str : \"\"\"Return the title of the exception which will be then translated.\"\"\" return \"device_offline\" ImouException \u00b6 Bases: Exception Base exception. Source code in imouapi/exceptions.py 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 class ImouException ( Exception ): \"\"\"Base exception.\"\"\" def __init__ ( self , message : str = \"\" ) -> None : \"\"\"Initialize.\"\"\" self . message = message super () . __init__ ( self . message ) def to_string ( self ) -> str : \"\"\"Return the exception as a string.\"\"\" return f \" { self . __class__ . __name__ } : { self . message } \\n \" + self . traceback () def traceback ( self ) -> str : \"\"\"Return the traceback as a string.\"\"\" etype , value , trace = sys . exc_info () return \"\" . join ( traceback . format_exception ( etype , value , trace , None )) def get_title ( self ) -> str : \"\"\"Return the title of the exception which will be then translated.\"\"\" return \"generic_error\" __init__ ( message = '' ) \u00b6 Initialize. Source code in imouapi/exceptions.py 9 10 11 12 def __init__ ( self , message : str = \"\" ) -> None : \"\"\"Initialize.\"\"\" self . message = message super () . __init__ ( self . message ) get_title () \u00b6 Return the title of the exception which will be then translated. Source code in imouapi/exceptions.py 23 24 25 def get_title ( self ) -> str : \"\"\"Return the title of the exception which will be then translated.\"\"\" return \"generic_error\" to_string () \u00b6 Return the exception as a string. Source code in imouapi/exceptions.py 14 15 16 def to_string ( self ) -> str : \"\"\"Return the exception as a string.\"\"\" return f \" { self . __class__ . __name__ } : { self . message } \\n \" + self . traceback () traceback () \u00b6 Return the traceback as a string. Source code in imouapi/exceptions.py 18 19 20 21 def traceback ( self ) -> str : \"\"\"Return the traceback as a string.\"\"\" etype , value , trace = sys . exc_info () return \"\" . join ( traceback . format_exception ( etype , value , trace , None )) InvalidConfiguration \u00b6 Bases: ImouException Invalid App Id or App Secret provided. Source code in imouapi/exceptions.py 44 45 46 47 48 49 class InvalidConfiguration ( ImouException ): \"\"\"Invalid App Id or App Secret provided.\"\"\" def get_title ( self ) -> str : \"\"\"Return the title of the exception which will be then translated.\"\"\" return \"invalid_configuration\" get_title () \u00b6 Return the title of the exception which will be then translated. Source code in imouapi/exceptions.py 47 48 49 def get_title ( self ) -> str : \"\"\"Return the title of the exception which will be then translated.\"\"\" return \"invalid_configuration\" InvalidResponse \u00b6 Bases: ImouException Malformed or unexpected API response. Source code in imouapi/exceptions.py 68 69 70 71 72 73 class InvalidResponse ( ImouException ): \"\"\"Malformed or unexpected API response.\"\"\" def get_title ( self ) -> str : \"\"\"Return the title of the exception which will be then translated.\"\"\" return \"invalid_reponse\" get_title () \u00b6 Return the title of the exception which will be then translated. Source code in imouapi/exceptions.py 71 72 73 def get_title ( self ) -> str : \"\"\"Return the title of the exception which will be then translated.\"\"\" return \"invalid_reponse\" NotAuthorized \u00b6 Bases: ImouException Not authorized to operate on the device or invalid device id. Source code in imouapi/exceptions.py 52 53 54 55 56 57 class NotAuthorized ( ImouException ): \"\"\"Not authorized to operate on the device or invalid device id.\"\"\" def get_title ( self ) -> str : \"\"\"Return the title of the exception which will be then translated.\"\"\" return \"not_authorized\" get_title () \u00b6 Return the title of the exception which will be then translated. Source code in imouapi/exceptions.py 55 56 57 def get_title ( self ) -> str : \"\"\"Return the title of the exception which will be then translated.\"\"\" return \"not_authorized\" NotConnected \u00b6 Bases: ImouException Action requested but not yet connected to the API. Source code in imouapi/exceptions.py 28 29 30 31 32 33 class NotConnected ( ImouException ): \"\"\"Action requested but not yet connected to the API.\"\"\" def get_title ( self ) -> str : \"\"\"Return the title of the exception which will be then translated.\"\"\" return \"not_connected\" get_title () \u00b6 Return the title of the exception which will be then translated. Source code in imouapi/exceptions.py 31 32 33 def get_title ( self ) -> str : \"\"\"Return the title of the exception which will be then translated.\"\"\" return \"not_connected\"","title":"exceptions"},{"location":"modules/exceptions/#imouapi.exceptions.APIError","text":"Bases: ImouException Remote API error. Source code in imouapi/exceptions.py 60 61 62 63 64 65 class APIError ( ImouException ): \"\"\"Remote API error.\"\"\" def get_title ( self ) -> str : \"\"\"Return the title of the exception which will be then translated.\"\"\" return \"api_error\"","title":"APIError"},{"location":"modules/exceptions/#imouapi.exceptions.APIError.get_title","text":"Return the title of the exception which will be then translated. Source code in imouapi/exceptions.py 63 64 65 def get_title ( self ) -> str : \"\"\"Return the title of the exception which will be then translated.\"\"\" return \"api_error\"","title":"get_title()"},{"location":"modules/exceptions/#imouapi.exceptions.ConnectionFailed","text":"Bases: ImouException Failed to connect to the API. Source code in imouapi/exceptions.py 36 37 38 39 40 41 class ConnectionFailed ( ImouException ): \"\"\"Failed to connect to the API.\"\"\" def get_title ( self ) -> str : \"\"\"Return the title of the exception which will be then translated.\"\"\" return \"connection_failed\"","title":"ConnectionFailed"},{"location":"modules/exceptions/#imouapi.exceptions.ConnectionFailed.get_title","text":"Return the title of the exception which will be then translated. Source code in imouapi/exceptions.py 39 40 41 def get_title ( self ) -> str : \"\"\"Return the title of the exception which will be then translated.\"\"\" return \"connection_failed\"","title":"get_title()"},{"location":"modules/exceptions/#imouapi.exceptions.DeviceOffline","text":"Bases: ImouException Device is offline. Source code in imouapi/exceptions.py 76 77 78 79 80 81 class DeviceOffline ( ImouException ): \"\"\"Device is offline.\"\"\" def get_title ( self ) -> str : \"\"\"Return the title of the exception which will be then translated.\"\"\" return \"device_offline\"","title":"DeviceOffline"},{"location":"modules/exceptions/#imouapi.exceptions.DeviceOffline.get_title","text":"Return the title of the exception which will be then translated. Source code in imouapi/exceptions.py 79 80 81 def get_title ( self ) -> str : \"\"\"Return the title of the exception which will be then translated.\"\"\" return \"device_offline\"","title":"get_title()"},{"location":"modules/exceptions/#imouapi.exceptions.ImouException","text":"Bases: Exception Base exception. Source code in imouapi/exceptions.py 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 class ImouException ( Exception ): \"\"\"Base exception.\"\"\" def __init__ ( self , message : str = \"\" ) -> None : \"\"\"Initialize.\"\"\" self . message = message super () . __init__ ( self . message ) def to_string ( self ) -> str : \"\"\"Return the exception as a string.\"\"\" return f \" { self . __class__ . __name__ } : { self . message } \\n \" + self . traceback () def traceback ( self ) -> str : \"\"\"Return the traceback as a string.\"\"\" etype , value , trace = sys . exc_info () return \"\" . join ( traceback . format_exception ( etype , value , trace , None )) def get_title ( self ) -> str : \"\"\"Return the title of the exception which will be then translated.\"\"\" return \"generic_error\"","title":"ImouException"},{"location":"modules/exceptions/#imouapi.exceptions.ImouException.__init__","text":"Initialize. Source code in imouapi/exceptions.py 9 10 11 12 def __init__ ( self , message : str = \"\" ) -> None : \"\"\"Initialize.\"\"\" self . message = message super () . __init__ ( self . message )","title":"__init__()"},{"location":"modules/exceptions/#imouapi.exceptions.ImouException.get_title","text":"Return the title of the exception which will be then translated. Source code in imouapi/exceptions.py 23 24 25 def get_title ( self ) -> str : \"\"\"Return the title of the exception which will be then translated.\"\"\" return \"generic_error\"","title":"get_title()"},{"location":"modules/exceptions/#imouapi.exceptions.ImouException.to_string","text":"Return the exception as a string. Source code in imouapi/exceptions.py 14 15 16 def to_string ( self ) -> str : \"\"\"Return the exception as a string.\"\"\" return f \" { self . __class__ . __name__ } : { self . message } \\n \" + self . traceback ()","title":"to_string()"},{"location":"modules/exceptions/#imouapi.exceptions.ImouException.traceback","text":"Return the traceback as a string. Source code in imouapi/exceptions.py 18 19 20 21 def traceback ( self ) -> str : \"\"\"Return the traceback as a string.\"\"\" etype , value , trace = sys . exc_info () return \"\" . join ( traceback . format_exception ( etype , value , trace , None ))","title":"traceback()"},{"location":"modules/exceptions/#imouapi.exceptions.InvalidConfiguration","text":"Bases: ImouException Invalid App Id or App Secret provided. Source code in imouapi/exceptions.py 44 45 46 47 48 49 class InvalidConfiguration ( ImouException ): \"\"\"Invalid App Id or App Secret provided.\"\"\" def get_title ( self ) -> str : \"\"\"Return the title of the exception which will be then translated.\"\"\" return \"invalid_configuration\"","title":"InvalidConfiguration"},{"location":"modules/exceptions/#imouapi.exceptions.InvalidConfiguration.get_title","text":"Return the title of the exception which will be then translated. Source code in imouapi/exceptions.py 47 48 49 def get_title ( self ) -> str : \"\"\"Return the title of the exception which will be then translated.\"\"\" return \"invalid_configuration\"","title":"get_title()"},{"location":"modules/exceptions/#imouapi.exceptions.InvalidResponse","text":"Bases: ImouException Malformed or unexpected API response. Source code in imouapi/exceptions.py 68 69 70 71 72 73 class InvalidResponse ( ImouException ): \"\"\"Malformed or unexpected API response.\"\"\" def get_title ( self ) -> str : \"\"\"Return the title of the exception which will be then translated.\"\"\" return \"invalid_reponse\"","title":"InvalidResponse"},{"location":"modules/exceptions/#imouapi.exceptions.InvalidResponse.get_title","text":"Return the title of the exception which will be then translated. Source code in imouapi/exceptions.py 71 72 73 def get_title ( self ) -> str : \"\"\"Return the title of the exception which will be then translated.\"\"\" return \"invalid_reponse\"","title":"get_title()"},{"location":"modules/exceptions/#imouapi.exceptions.NotAuthorized","text":"Bases: ImouException Not authorized to operate on the device or invalid device id. Source code in imouapi/exceptions.py 52 53 54 55 56 57 class NotAuthorized ( ImouException ): \"\"\"Not authorized to operate on the device or invalid device id.\"\"\" def get_title ( self ) -> str : \"\"\"Return the title of the exception which will be then translated.\"\"\" return \"not_authorized\"","title":"NotAuthorized"},{"location":"modules/exceptions/#imouapi.exceptions.NotAuthorized.get_title","text":"Return the title of the exception which will be then translated. Source code in imouapi/exceptions.py 55 56 57 def get_title ( self ) -> str : \"\"\"Return the title of the exception which will be then translated.\"\"\" return \"not_authorized\"","title":"get_title()"},{"location":"modules/exceptions/#imouapi.exceptions.NotConnected","text":"Bases: ImouException Action requested but not yet connected to the API. Source code in imouapi/exceptions.py 28 29 30 31 32 33 class NotConnected ( ImouException ): \"\"\"Action requested but not yet connected to the API.\"\"\" def get_title ( self ) -> str : \"\"\"Return the title of the exception which will be then translated.\"\"\" return \"not_connected\"","title":"NotConnected"},{"location":"modules/exceptions/#imouapi.exceptions.NotConnected.get_title","text":"Return the title of the exception which will be then translated. Source code in imouapi/exceptions.py 31 32 33 def get_title ( self ) -> str : \"\"\"Return the title of the exception which will be then translated.\"\"\" return \"not_connected\"","title":"get_title()"}]}